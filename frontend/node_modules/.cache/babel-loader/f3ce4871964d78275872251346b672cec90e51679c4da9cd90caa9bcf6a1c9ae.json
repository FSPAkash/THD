{"ast":null,"code":"import _objectSpread from\"C:/Users/AkashPatil/THD-Dashboard/frontend/node_modules/@babel/runtime/helpers/esm/objectSpread2.js\";import{useState,useRef,useCallback,useEffect}from'react';import{LineChart,Line,AreaChart,Area,BarChart,Bar,XAxis,YAxis,CartesianGrid,Tooltip,ResponsiveContainer,ReferenceLine,Legend}from'recharts';import{useAuth}from'../context/AuthContext';import'./KPIChart.css';import{jsx as _jsx,jsxs as _jsxs,Fragment as _Fragment}from\"react/jsx-runtime\";const PRESET_TAGS=[{id:'thanksgiving',name:'Thanksgiving',color:'#F96302'},{id:'july4th',name:'4th of July',color:'#FF3B30'},{id:'tier1',name:'Tier 1 Event',color:'#5856D6'},{id:'promo',name:'Promo',color:'#34C759'},{id:'outage',name:'Outage/Issue',color:'#FF2D55'}];const CHART_MARGINS={top:20,right:20,left:10,bottom:20};const Y_AXIS_WIDTH=60;const CHART_HEIGHT=320;const PLOT_AREA_HEIGHT=CHART_HEIGHT-CHART_MARGINS.top-CHART_MARGINS.bottom-54;function hexToRgba(hex,alpha){const r=parseInt(hex.slice(1,3),16);const g=parseInt(hex.slice(3,5),16);const b=parseInt(hex.slice(5,7),16);return\"rgba(\".concat(r,\",\").concat(g,\",\").concat(b,\",\").concat(alpha,\")\");}function KPIChart(_ref){let{data,kpi,chartType,format,launchDate,comparisonData,chartTags,onTagsChange,displayMode='both',events=[],showSuggestedEvents=false}=_ref;const{isBetaMode}=useAuth();const isBeta=isBetaMode();const chartContainerRef=useRef(null);const[showTagPanel,setShowTagPanel]=useState(false);const[customTagName,setCustomTagName]=useState('');const[customTagOwner,setCustomTagOwner]=useState('');const[customTagDescription,setCustomTagDescription]=useState('');const[draggedTag,setDraggedTag]=useState(null);const[showCustomForm,setShowCustomForm]=useState(false);const[dragPreview,setDragPreview]=useState(null);const[containerWidth,setContainerWidth]=useState(0);const[editingTagId,setEditingTagId]=useState(null);const[editingTagData,setEditingTagData]=useState(null);const[dismissedEvents,setDismissedEvents]=useState(()=>{try{const stored=sessionStorage.getItem('dismissedEvents');return stored?JSON.parse(stored):[];}catch(_unused){return[];}});const[editingEvent,setEditingEvent]=useState(null);const rawChartData=comparisonData&&comparisonData.length>0?comparisonData:data;const hasComparison=comparisonData&&comparisonData.length>0;const chartData=(rawChartData===null||rawChartData===void 0?void 0:rawChartData.map(d=>_objectSpread(_objectSpread({},d),{},{displayDate:displayMode==='ly'&&d.date_ly?d.date_ly:d.date})))||[];useEffect(()=>{const updateWidth=()=>{if(chartContainerRef.current){const width=chartContainerRef.current.offsetWidth;if(width>0){setContainerWidth(width);}}};updateWidth();const initialTimeout=setTimeout(updateWidth,100);const secondTimeout=setTimeout(updateWidth,300);window.addEventListener('resize',updateWidth);const resizeObserver=new ResizeObserver(()=>{requestAnimationFrame(updateWidth);});if(chartContainerRef.current){resizeObserver.observe(chartContainerRef.current);}return()=>{clearTimeout(initialTimeout);clearTimeout(secondTimeout);window.removeEventListener('resize',updateWidth);resizeObserver.disconnect();};},[]);useEffect(()=>{if(chartTags&&chartTags.length>0&&chartContainerRef.current){const width=chartContainerRef.current.offsetWidth;if(width>0&&containerWidth!==width){setContainerWidth(width);}}},[chartTags,containerWidth]);useEffect(()=>{if(!editingTagId&&!editingEvent)return;const handleClickOutside=e=>{const clickedElement=e.target;const isInsidePopover=clickedElement.closest('.tag-edit-popover');const isInsideEventEdit=clickedElement.closest('.event-span-edit');const isTagLabel=clickedElement.closest('.tag-label');const isSpanLabel=clickedElement.closest('.event-span-label');const isActivePill=clickedElement.closest('.active-tag-pill');const isButton=clickedElement.closest('button');const isInput=clickedElement.closest('input');if(isInsidePopover||isInsideEventEdit||isTagLabel||isSpanLabel||isActivePill||isButton||isInput){return;}setEditingTagId(null);setEditingTagData(null);setEditingEvent(null);};const timeoutId=setTimeout(()=>{document.addEventListener('click',handleClickOutside,true);},50);return()=>{clearTimeout(timeoutId);document.removeEventListener('click',handleClickOutside,true);};},[editingTagId,editingEvent]);const formatValue=val=>{if(val===null||val===undefined||isNaN(val))return'-';if(format==='currency'){if(Math.abs(val)>=1000000){return\"$\".concat((val/1000000).toFixed(1),\"M\");}if(Math.abs(val)>=1000){return\"$\".concat((val/1000).toFixed(0),\"K\");}return\"$\".concat(val.toFixed(2));}if(format==='percentage'){return\"\".concat((val*100).toFixed(2),\"%\");}if(Math.abs(val)>=1000000){return\"\".concat((val/1000000).toFixed(1),\"M\");}if(Math.abs(val)>=1000){return\"\".concat((val/1000).toFixed(0),\"K\");}return val.toLocaleString();};const formatAxisDate=dateStr=>{const date=new Date(dateStr);return date.toLocaleDateString('en-US',{month:'short',day:'numeric'});};const formatFullDate=dateStr=>{const date=new Date(dateStr);return date.toLocaleDateString('en-US',{weekday:'short',month:'short',day:'numeric',year:'numeric'});};const formatShortDate=dateStr=>{if(!dateStr)return'-';const date=new Date(dateStr);return date.toLocaleDateString('en-US',{month:'short',day:'numeric'});};const getContainerRect=useCallback(()=>{if(!chartContainerRef.current)return null;return chartContainerRef.current.getBoundingClientRect();},[]);const getDateIndexFromX=useCallback(clientX=>{if(!chartData||chartData.length===0)return-1;const rect=getContainerRect();if(!rect)return-1;const chartAreaLeft=Y_AXIS_WIDTH+CHART_MARGINS.left;const chartAreaWidth=rect.width-chartAreaLeft-CHART_MARGINS.right;const relativeX=clientX-rect.left-chartAreaLeft;const percentage=Math.max(0,Math.min(1,relativeX/chartAreaWidth));const dataIndex=Math.round(percentage*(chartData.length-1));return Math.max(0,Math.min(dataIndex,chartData.length-1));},[chartData,getContainerRect]);const getXPositionForIndex=useCallback(index=>{var _chartContainerRef$cu;if(!chartData||chartData.length===0||index<0)return 0;const width=containerWidth||((_chartContainerRef$cu=chartContainerRef.current)===null||_chartContainerRef$cu===void 0?void 0:_chartContainerRef$cu.offsetWidth)||0;if(width===0)return 0;const chartAreaLeft=Y_AXIS_WIDTH+CHART_MARGINS.left;const chartAreaWidth=width-chartAreaLeft-CHART_MARGINS.right;if(chartData.length===1){return chartAreaLeft+chartAreaWidth/2;}const percentage=index/(chartData.length-1);return chartAreaLeft+percentage*chartAreaWidth;},[chartData,containerWidth]);const getDateFromIndex=useCallback(index=>{var _chartData$index;if(!chartData||chartData.length===0||index<0||index>=chartData.length)return null;return((_chartData$index=chartData[index])===null||_chartData$index===void 0?void 0:_chartData$index.date)||null;},[chartData]);const getIndexFromDate=useCallback(dateStr=>{if(!chartData||chartData.length===0||!dateStr)return-1;return chartData.findIndex(d=>d.date===dateStr);},[chartData]);const CustomTooltip=_ref2=>{let{active,payload,label}=_ref2;if(active&&payload&&payload.length){const dataPoint=chartData===null||chartData===void 0?void 0:chartData.find(d=>d.displayDate===label);const formatDate=dateStr=>new Date(dateStr).toLocaleDateString('en-US',{weekday:'short',month:'short',day:'numeric',year:'numeric'});const dateTag=chartTags===null||chartTags===void 0?void 0:chartTags.find(t=>t.date===label||t.date===(dataPoint===null||dataPoint===void 0?void 0:dataPoint.date));return/*#__PURE__*/_jsxs(\"div\",{className:\"chart-tooltip\",children:[displayMode==='ly'?/*#__PURE__*/_jsx(\"p\",{className:\"tooltip-date\",children:formatDate((dataPoint===null||dataPoint===void 0?void 0:dataPoint.date_ly)||label)}):displayMode==='both'&&dataPoint!==null&&dataPoint!==void 0&&dataPoint.date&&dataPoint!==null&&dataPoint!==void 0&&dataPoint.date_ly?/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsxs(\"p\",{className:\"tooltip-date\",children:[\"TY: \",formatDate(dataPoint.date)]}),/*#__PURE__*/_jsxs(\"p\",{className:\"tooltip-date tooltip-date-ly\",children:[\"LY: \",formatDate(dataPoint.date_ly)]})]}):/*#__PURE__*/_jsx(\"p\",{className:\"tooltip-date\",children:formatDate((dataPoint===null||dataPoint===void 0?void 0:dataPoint.date)||label)}),dateTag&&/*#__PURE__*/_jsxs(\"p\",{className:\"tooltip-tag\",children:[/*#__PURE__*/_jsx(\"span\",{className:\"tooltip-tag-marker\",style:{background:dateTag.color}}),dateTag.name]}),payload.map((entry,index)=>/*#__PURE__*/_jsxs(\"p\",{className:\"tooltip-value\",style:{color:entry.color},children:[/*#__PURE__*/_jsxs(\"span\",{className:\"tooltip-label\",children:[entry.name,\": \"]}),formatValue(entry.value)]},index))]});}return null;};const handleDragStart=(e,tag)=>{const tagForDrag=_objectSpread(_objectSpread({},tag),{},{id:tag.id.startsWith('custom-')?tag.id:tag.id});setDraggedTag(tagForDrag);e.dataTransfer.effectAllowed='copy';const img=new Image();img.src='data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7';e.dataTransfer.setDragImage(img,0,0);};const handleDragOver=e=>{var _chartData$dateIndex;e.preventDefault();e.dataTransfer.dropEffect='copy';if(!draggedTag||!chartData||chartData.length===0)return;const rect=getContainerRect();if(!rect)return;const dateIndex=getDateIndexFromX(e.clientX);const targetDate=(_chartData$dateIndex=chartData[dateIndex])===null||_chartData$dateIndex===void 0?void 0:_chartData$dateIndex.date;const xPosition=getXPositionForIndex(dateIndex);if(targetDate&&dateIndex>=0){setDragPreview({date:targetDate,formattedDate:formatFullDate(targetDate),x:xPosition,index:dateIndex,tag:draggedTag});}};const handleDragLeave=e=>{var _chartContainerRef$cu2;const rect=(_chartContainerRef$cu2=chartContainerRef.current)===null||_chartContainerRef$cu2===void 0?void 0:_chartContainerRef$cu2.getBoundingClientRect();if(rect){const{clientX,clientY}=e;if(clientX<rect.left||clientX>rect.right||clientY<rect.top||clientY>rect.bottom){setDragPreview(null);}}};const handleDrop=e=>{var _chartData$dateIndex2;e.preventDefault();if(!draggedTag||!chartData||chartData.length===0)return;const dateIndex=getDateIndexFromX(e.clientX);const targetDate=(_chartData$dateIndex2=chartData[dateIndex])===null||_chartData$dateIndex2===void 0?void 0:_chartData$dateIndex2.date;if(targetDate){const uniqueId=\"\".concat(draggedTag.id,\"-\").concat(Date.now(),\"-\").concat(Math.random().toString(36).substr(2,9));const newTag=_objectSpread(_objectSpread({},draggedTag),{},{id:uniqueId,date:targetDate,startDate:targetDate,endDate:targetDate,dateIndex:dateIndex,startIndex:dateIndex,endIndex:dateIndex,isSpan:false,isManual:true,createdAt:new Date().toISOString()});if(onTagsChange){onTagsChange([...(chartTags||[]),newTag]);}setTimeout(()=>{setEditingTagId(uniqueId);setEditingTagData({name:newTag.name,owner:newTag.owner||'',description:newTag.description||'',startDate:targetDate,endDate:targetDate,startIndex:dateIndex,endIndex:dateIndex});},50);}setDraggedTag(null);setDragPreview(null);};const handleDragEnd=()=>{setDragPreview(null);setDraggedTag(null);};const handleAddCustomTag=()=>{if(!customTagName.trim()||!customTagOwner.trim())return;const newTag={id:\"custom-\".concat(Date.now()),name:customTagName.trim(),owner:customTagOwner.trim(),description:customTagDescription.trim()||'',color:'#6e6e73',isCustom:true};setDraggedTag(newTag);setCustomTagName('');setCustomTagOwner('');setCustomTagDescription('');setShowCustomForm(false);};const openTagEditor=useCallback((tagId,tag)=>{const tagIndex=tag.startIndex!==undefined?tag.startIndex:tag.dateIndex!==undefined?tag.dateIndex:getIndexFromDate(tag.date);const endIndex=tag.endIndex!==undefined?tag.endIndex:tagIndex;setEditingTagId(tagId);setEditingTagData({name:tag.name||'',owner:tag.owner||'',description:tag.description||'',startDate:tag.startDate||tag.date,endDate:tag.endDate||tag.date,startIndex:tagIndex,endIndex:endIndex});},[getIndexFromDate]);const closeTagEditor=useCallback(()=>{setEditingTagId(null);setEditingTagData(null);},[]);const handleTagLabelClick=useCallback((e,tagId,tag)=>{e.preventDefault();e.stopPropagation();if(editingTagId===tagId){return;}openTagEditor(tagId,tag);},[editingTagId,openTagEditor]);const handleEditingDataChange=useCallback((field,value)=>{setEditingTagData(prev=>prev?_objectSpread(_objectSpread({},prev),{},{[field]:value}):null);},[]);const handleStartDateChange=useCallback(newIndex=>{if(!editingTagData||newIndex<0||newIndex>=chartData.length)return;const newStartDate=getDateFromIndex(newIndex);if(!newStartDate)return;let endIndex=editingTagData.endIndex;if(newIndex>endIndex){endIndex=newIndex;}setEditingTagData(prev=>prev?_objectSpread(_objectSpread({},prev),{},{startDate:newStartDate,startIndex:newIndex,endDate:getDateFromIndex(endIndex)||prev.endDate,endIndex:endIndex}):null);},[editingTagData,chartData.length,getDateFromIndex]);const handleEndDateChange=useCallback(newIndex=>{if(!editingTagData||newIndex<0||newIndex>=chartData.length)return;const newEndDate=getDateFromIndex(newIndex);if(!newEndDate)return;let startIndex=editingTagData.startIndex;if(newIndex<startIndex){startIndex=newIndex;}setEditingTagData(prev=>prev?_objectSpread(_objectSpread({},prev),{},{endDate:newEndDate,endIndex:newIndex,startDate:getDateFromIndex(startIndex)||prev.startDate,startIndex:startIndex}):null);},[editingTagData,chartData.length,getDateFromIndex]);const handleSaveTagEdit=useCallback(()=>{if(!editingTagId||!editingTagData)return;const isSpan=editingTagData.startIndex!==editingTagData.endIndex;const updatedTags=(chartTags||[]).map(tag=>{if(tag.id===editingTagId){return _objectSpread(_objectSpread({},tag),{},{name:editingTagData.name,owner:editingTagData.owner,description:editingTagData.description,startDate:editingTagData.startDate,endDate:editingTagData.endDate,date:editingTagData.startDate,startIndex:editingTagData.startIndex,endIndex:editingTagData.endIndex,dateIndex:editingTagData.startIndex,isSpan:isSpan,adjustedStart:new Date(editingTagData.startDate+'T00:00:00').toISOString(),adjustedEnd:new Date(editingTagData.endDate+'T00:00:00').toISOString(),yearLabel:displayMode==='ly'?'LY':'TY',updatedAt:new Date().toISOString()});}return tag;});if(onTagsChange){onTagsChange(updatedTags);}closeTagEditor();},[editingTagId,editingTagData,chartTags,displayMode,onTagsChange,closeTagEditor]);const handleConvertToSpan=useCallback(e=>{if(e){e.preventDefault();e.stopPropagation();}if(!editingTagData)return;const currentIndex=editingTagData.startIndex;const defaultSpanDays=3;const newEndIndex=Math.min(currentIndex+defaultSpanDays,chartData.length-1);const newEndDate=getDateFromIndex(newEndIndex);setEditingTagData(prev=>prev?_objectSpread(_objectSpread({},prev),{},{endDate:newEndDate||prev.endDate,endIndex:newEndIndex}):null);},[editingTagData,chartData.length,getDateFromIndex]);const handleConvertToPoint=useCallback(e=>{if(e){e.preventDefault();e.stopPropagation();}if(!editingTagData)return;const startDate=editingTagData.startDate;const startIndex=editingTagData.startIndex;setEditingTagData(prev=>prev?_objectSpread(_objectSpread({},prev),{},{endDate:startDate,endIndex:startIndex}):null);},[editingTagData]);const handleRemoveTag=useCallback((tagId,e)=>{if(e){e.preventDefault();e.stopPropagation();}if(onTagsChange){onTagsChange((chartTags||[]).filter(t=>t.id!==tagId));}if(editingTagId===tagId){closeTagEditor();}},[chartTags,editingTagId,onTagsChange,closeTagEditor]);useEffect(()=>{try{sessionStorage.setItem('dismissedEvents',JSON.stringify(dismissedEvents));}catch(_unused2){}},[dismissedEvents]);const handleDismissEvent=eventId=>{setDismissedEvents(prev=>[...prev,eventId]);};const handleResetDismissed=()=>{setDismissedEvents([]);};const pinnedEventIds=(chartTags||[]).filter(tag=>tag.sourceEventId).map(tag=>tag.sourceEventId);const getFilteredEvents=useCallback(()=>{var _chartData$,_chartData;if(!events||events.length===0||!chartData||chartData.length===0)return[];const chartStartDate=(_chartData$=chartData[0])===null||_chartData$===void 0?void 0:_chartData$.date;const chartEndDate=(_chartData=chartData[chartData.length-1])===null||_chartData===void 0?void 0:_chartData.date;if(!chartStartDate||!chartEndDate)return[];const chartStart=new Date(chartStartDate+'T00:00:00');const chartEnd=new Date(chartEndDate+'T00:00:00');const yearLabel=displayMode==='ly'?'LY':'TY';return events.filter(ev=>!dismissedEvents.includes(ev.id)).filter(ev=>!pinnedEventIds.includes(ev.id)).map(ev=>{let evStart=new Date(ev.startDate+'T00:00:00');let evEnd=new Date(ev.endDate+'T00:00:00');if(displayMode==='ly'){evStart=new Date(evStart.getTime()-365*24*60*60*1000);evEnd=new Date(evEnd.getTime()-365*24*60*60*1000);}return _objectSpread(_objectSpread({},ev),{},{adjustedStart:evStart,adjustedEnd:evEnd,yearLabel});}).filter(ev=>ev.adjustedStart<=chartEnd&&ev.adjustedEnd>=chartStart);},[events,chartData,displayMode,dismissedEvents,pinnedEventIds]);const getIndexForDate=useCallback(targetDate=>{if(!chartData||chartData.length===0)return-1;let bestIdx=0;let bestDiff=Infinity;for(let i=0;i<chartData.length;i++){const d=new Date(chartData[i].date+'T00:00:00');const diff=Math.abs(d.getTime()-targetDate.getTime());if(diff<bestDiff){bestDiff=diff;bestIdx=i;}}return bestIdx;},[chartData]);const renderCompactEditPopover=function(tag){let isInSpanLayer=arguments.length>1&&arguments[1]!==undefined?arguments[1]:false;if(editingTagId!==tag.id||!editingTagData)return null;const isSpan=editingTagData.startIndex!==editingTagData.endIndex;const dayCount=editingTagData.endIndex-editingTagData.startIndex+1;const handlePopoverClick=e=>{e.preventDefault();e.stopPropagation();};const handlePopoverMouseMove=e=>{e.stopPropagation();};return/*#__PURE__*/_jsxs(\"div\",{className:\"tag-edit-popover compact \".concat(isInSpanLayer?'in-span-layer':''),style:{borderColor:tag.color},onClick:handlePopoverClick,onMouseDown:handlePopoverClick,onMouseMove:handlePopoverMouseMove,onMouseEnter:handlePopoverClick,children:[/*#__PURE__*/_jsxs(\"div\",{className:\"edit-popover-header\",children:[/*#__PURE__*/_jsx(\"input\",{type:\"text\",className:\"edit-name-input\",value:editingTagData.name,onChange:e=>handleEditingDataChange('name',e.target.value),placeholder:\"Event name\",onClick:handlePopoverClick,onMouseDown:handlePopoverClick}),/*#__PURE__*/_jsx(\"button\",{className:\"edit-popover-close\",onClick:e=>{e.preventDefault();e.stopPropagation();closeTagEditor();},children:/*#__PURE__*/_jsxs(\"svg\",{width:\"14\",height:\"14\",viewBox:\"0 0 24 24\",fill:\"none\",stroke:\"currentColor\",strokeWidth:\"2\",children:[/*#__PURE__*/_jsx(\"line\",{x1:\"18\",y1:\"6\",x2:\"6\",y2:\"18\"}),/*#__PURE__*/_jsx(\"line\",{x1:\"6\",y1:\"6\",x2:\"18\",y2:\"18\"})]})})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"edit-row\",children:[/*#__PURE__*/_jsx(\"input\",{type:\"text\",className:\"edit-field-small\",value:editingTagData.owner,onChange:e=>handleEditingDataChange('owner',e.target.value),placeholder:\"Owner\",onClick:handlePopoverClick,onMouseDown:handlePopoverClick}),/*#__PURE__*/_jsx(\"input\",{type:\"text\",className:\"edit-field-small\",value:editingTagData.description,onChange:e=>handleEditingDataChange('description',e.target.value),placeholder:\"Note\",onClick:handlePopoverClick,onMouseDown:handlePopoverClick})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"edit-date-row\",onClick:handlePopoverClick,onMouseDown:handlePopoverClick,children:[/*#__PURE__*/_jsxs(\"div\",{className:\"date-control\",children:[/*#__PURE__*/_jsx(\"button\",{className:\"date-btn\",onClick:e=>{e.preventDefault();e.stopPropagation();handleStartDateChange(editingTagData.startIndex-1);},disabled:editingTagData.startIndex<=0,children:\"-\"}),/*#__PURE__*/_jsx(\"span\",{className:\"date-value\",children:formatShortDate(editingTagData.startDate)}),/*#__PURE__*/_jsx(\"button\",{className:\"date-btn\",onClick:e=>{e.preventDefault();e.stopPropagation();handleStartDateChange(editingTagData.startIndex+1);},disabled:editingTagData.startIndex>=chartData.length-1,children:\"+\"})]}),/*#__PURE__*/_jsx(\"span\",{className:\"date-separator\",children:\"to\"}),/*#__PURE__*/_jsxs(\"div\",{className:\"date-control\",children:[/*#__PURE__*/_jsx(\"button\",{className:\"date-btn\",onClick:e=>{e.preventDefault();e.stopPropagation();handleEndDateChange(editingTagData.endIndex-1);},disabled:editingTagData.endIndex<=0,children:\"-\"}),/*#__PURE__*/_jsx(\"span\",{className:\"date-value\",children:formatShortDate(editingTagData.endDate)}),/*#__PURE__*/_jsx(\"button\",{className:\"date-btn\",onClick:e=>{e.preventDefault();e.stopPropagation();handleEndDateChange(editingTagData.endIndex+1);},disabled:editingTagData.endIndex>=chartData.length-1,children:\"+\"})]}),/*#__PURE__*/_jsxs(\"span\",{className:\"day-count\",children:[dayCount,\"d\"]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"edit-actions-row\",onClick:handlePopoverClick,onMouseDown:handlePopoverClick,children:[!isSpan?/*#__PURE__*/_jsx(\"button\",{className:\"action-btn secondary\",onClick:e=>handleConvertToSpan(e),children:\"Make Span\"}):/*#__PURE__*/_jsx(\"button\",{className:\"action-btn secondary\",onClick:e=>handleConvertToPoint(e),children:\"Single Day\"}),/*#__PURE__*/_jsx(\"button\",{className:\"action-btn danger\",onClick:e=>handleRemoveTag(tag.id,e),children:\"Delete\"}),/*#__PURE__*/_jsx(\"button\",{className:\"action-btn primary\",onClick:e=>{e.preventDefault();e.stopPropagation();handleSaveTagEdit();},children:\"Save\"})]})]});};const renderSingleSpan=function(ev){var _chartContainerRef$cu3;let isPinned=arguments.length>1&&arguments[1]!==undefined?arguments[1]:false;let isManualSpan=arguments.length>2&&arguments[2]!==undefined?arguments[2]:false;const currentWidth=containerWidth||((_chartContainerRef$cu3=chartContainerRef.current)===null||_chartContainerRef$cu3===void 0?void 0:_chartContainerRef$cu3.offsetWidth)||0;if(currentWidth===0)return null;const chartAreaLeft=Y_AXIS_WIDTH+CHART_MARGINS.left;const chartAreaWidth=currentWidth-chartAreaLeft-CHART_MARGINS.right;let evStart,evEnd;if(isManualSpan){evStart=new Date(ev.startDate+'T00:00:00');evEnd=new Date(ev.endDate+'T00:00:00');}else{evStart=isPinned?new Date(ev.adjustedStart):ev.adjustedStart;evEnd=isPinned?new Date(ev.adjustedEnd):ev.adjustedEnd;}const startIdx=isManualSpan?ev.startIndex:getIndexForDate(evStart);const endIdx=isManualSpan?ev.endIndex:getIndexForDate(evEnd);const clampedStart=Math.max(0,startIdx);const clampedEnd=Math.min(chartData.length-1,endIdx);const startPct=chartData.length===1?0.5:clampedStart/(chartData.length-1);const endPct=chartData.length===1?0.5:clampedEnd/(chartData.length-1);const leftPx=chartAreaLeft+startPct*chartAreaWidth;const rightPx=chartAreaLeft+endPct*chartAreaWidth;const widthPx=Math.max(rightPx-leftPx,4);const centerPx=leftPx+widthPx/2;const fillColor=hexToRgba(ev.color,0.12);const borderColor=hexToRgba(ev.color,0.5);const isBeingEdited=editingTagId===ev.id;const spanLabel=ev.name||ev.label;const yearLabel=ev.yearLabel||(displayMode==='ly'?'LY':'TY');const handleSpanClick=e=>{e.preventDefault();e.stopPropagation();};return/*#__PURE__*/_jsxs(\"div\",{className:\"event-span \".concat(isPinned||isManualSpan?'pinned':'',\" \").concat(isBeingEdited?'editing':''),style:{left:\"\".concat(leftPx,\"px\"),width:\"\".concat(widthPx,\"px\"),background:fillColor,borderLeft:\"2px solid \".concat(borderColor),borderRight:\"2px solid \".concat(borderColor)},children:[/*#__PURE__*/_jsxs(\"div\",{className:\"event-span-label\",style:{left:\"\".concat(centerPx-leftPx,\"px\"),background:ev.color},onClick:e=>{e.preventDefault();e.stopPropagation();if(isManualSpan){if(editingTagId!==ev.id){openTagEditor(ev.id,ev);}}else if(!isPinned){setEditingEvent((editingEvent===null||editingEvent===void 0?void 0:editingEvent.id)===ev.id?null:ev);}},onMouseDown:handleSpanClick,children:[/*#__PURE__*/_jsxs(\"span\",{className:\"event-span-label-text\",children:[spanLabel,\" (\",yearLabel,\")\"]}),/*#__PURE__*/_jsx(\"button\",{className:\"event-span-dismiss\",onClick:e=>{e.preventDefault();e.stopPropagation();if(isPinned||isManualSpan){handleRemoveTag(ev.id,e);}else{handleDismissEvent(ev.id);}},title:isPinned||isManualSpan?\"Remove\":\"Dismiss\",children:\"x\"})]}),isManualSpan&&isBeingEdited&&renderCompactEditPopover(ev,true),!isPinned&&!isManualSpan&&(editingEvent===null||editingEvent===void 0?void 0:editingEvent.id)===ev.id&&/*#__PURE__*/_jsxs(\"div\",{className:\"event-span-edit\",style:{left:\"\".concat(centerPx-leftPx,\"px\")},onClick:handleSpanClick,onMouseDown:handleSpanClick,onMouseMove:handleSpanClick,onMouseEnter:handleSpanClick,children:[/*#__PURE__*/_jsxs(\"div\",{className:\"event-span-edit-header\",children:[/*#__PURE__*/_jsx(\"strong\",{children:ev.label}),/*#__PURE__*/_jsx(\"button\",{className:\"event-span-edit-close\",onClick:e=>{e.preventDefault();e.stopPropagation();setEditingEvent(null);},children:\"x\"})]}),/*#__PURE__*/_jsxs(\"p\",{className:\"event-span-edit-dates\",children:[new Date(ev.adjustedStart).toLocaleDateString('en-US',{month:'short',day:'numeric'}),' - ',new Date(ev.adjustedEnd).toLocaleDateString('en-US',{month:'short',day:'numeric'})]}),/*#__PURE__*/_jsx(\"p\",{className:\"event-span-edit-tier\",children:ev.tier?'Tier 1 Event':'Tracked Event'}),/*#__PURE__*/_jsx(\"button\",{className:\"event-span-pin-btn\",onClick:e=>{e.preventDefault();e.stopPropagation();if(onTagsChange){onTagsChange([...(chartTags||[]),{id:\"pinned-\".concat(ev.id,\"-\").concat(Date.now()),name:ev.label,color:ev.color,sourceEventId:ev.id,isSpan:true,startDate:ev.startDate,endDate:ev.endDate,adjustedStart:ev.adjustedStart.toISOString(),adjustedEnd:ev.adjustedEnd.toISOString(),yearLabel:ev.yearLabel,tier:ev.tier,source:'suggested'}]);}setEditingEvent(null);},children:\"Pin to chart\"})]})]},ev.id);};const getPinnedSpans=useCallback(()=>{var _chartData$2,_chartData2;if(!chartTags||!chartData||chartData.length===0)return[];const chartStartDate=(_chartData$2=chartData[0])===null||_chartData$2===void 0?void 0:_chartData$2.date;const chartEndDate=(_chartData2=chartData[chartData.length-1])===null||_chartData2===void 0?void 0:_chartData2.date;if(!chartStartDate||!chartEndDate)return[];const chartStart=new Date(chartStartDate+'T00:00:00');const chartEnd=new Date(chartEndDate+'T00:00:00');return chartTags.filter(tag=>tag.isSpan&&!tag.isManual).filter(tag=>{const tagStart=new Date(tag.adjustedStart);const tagEnd=new Date(tag.adjustedEnd);return tagStart<=chartEnd&&tagEnd>=chartStart;});},[chartTags,chartData]);const getManualSpans=useCallback(()=>{if(!chartTags||!chartData||chartData.length===0)return[];return chartTags.filter(tag=>tag.isSpan&&tag.isManual);},[chartTags,chartData]);const renderEventSpans=()=>{var _chartContainerRef$cu4;const currentWidth=containerWidth||((_chartContainerRef$cu4=chartContainerRef.current)===null||_chartContainerRef$cu4===void 0?void 0:_chartContainerRef$cu4.offsetWidth)||0;if(currentWidth===0)return null;const pinnedSpans=getPinnedSpans();const manualSpans=getManualSpans();const suggestedEvents=showSuggestedEvents?getFilteredEvents():[];if(pinnedSpans.length===0&&suggestedEvents.length===0&&manualSpans.length===0)return null;return/*#__PURE__*/_jsxs(_Fragment,{children:[pinnedSpans.map(span=>renderSingleSpan(span,true,false)),manualSpans.map(span=>renderSingleSpan(span,false,true)),suggestedEvents.map(ev=>renderSingleSpan(ev,false,false))]});};const commonProps={data:chartData,margin:CHART_MARGINS};const axisStyle={fontSize:11,fill:'#86868b',fontWeight:500};const calculateTickInterval=()=>{if(!chartData||chartData.length<=1)return 0;const dataPoints=chartData.length;const targetTicks=7;const interval=Math.max(0,Math.floor((dataPoints-1)/(targetTicks-1))-1);return interval;};const tickInterval=calculateTickInterval();const tyDataKey=hasComparison?\"\".concat(kpi,\"_ty\"):kpi;const lyDataKey=hasComparison?\"\".concat(kpi,\"_ly\"):null;const showTY=displayMode==='both'||displayMode==='ty';const showLY=displayMode==='both'||displayMode==='ly';const renderPlacedTags=()=>{var _chartContainerRef$cu5;if(!chartTags||chartTags.length===0||!chartData||chartData.length===0)return null;const pointTags=chartTags.filter(t=>!t.isSpan);if(pointTags.length===0)return null;const currentWidth=containerWidth||((_chartContainerRef$cu5=chartContainerRef.current)===null||_chartContainerRef$cu5===void 0?void 0:_chartContainerRef$cu5.offsetWidth)||0;if(currentWidth===0)return null;const poleHeight=CHART_HEIGHT-CHART_MARGINS.bottom-40;return pointTags.map(tag=>{let dateIndex=tag.dateIndex;if(dateIndex===undefined||dateIndex<0||dateIndex>=chartData.length){dateIndex=chartData.findIndex(d=>d.date===tag.date);}if(dateIndex===-1||dateIndex>=chartData.length)return null;const xPos=getXPositionForIndex(dateIndex);if(xPos===0&&dateIndex!==0)return null;const isEditing=editingTagId===tag.id;return/*#__PURE__*/_jsxs(\"div\",{className:\"placed-tag-container \".concat(isEditing?'editing':''),style:{left:\"\".concat(xPos,\"px\")},children:[/*#__PURE__*/_jsxs(\"div\",{className:\"tag-label clickable\",style:{background:tag.color},onClick:e=>handleTagLabelClick(e,tag.id,tag),onMouseDown:e=>{e.preventDefault();e.stopPropagation();},children:[/*#__PURE__*/_jsx(\"span\",{className:\"tag-label-text\",children:tag.name}),/*#__PURE__*/_jsx(\"button\",{className:\"tag-label-remove\",onClick:e=>handleRemoveTag(tag.id,e),title:\"Remove tag\",children:\"x\"})]}),isEditing&&renderCompactEditPopover(tag,false),/*#__PURE__*/_jsx(\"div\",{className:\"tag-pole\",style:{background:tag.color,height:poleHeight}}),/*#__PURE__*/_jsx(\"div\",{className:\"tag-date\",style:{color:tag.color},children:formatAxisDate(tag.date)})]},tag.id);});};const renderDragPreview=()=>{if(!dragPreview||dragPreview.x===0)return null;const poleHeight=CHART_HEIGHT-CHART_MARGINS.bottom-40;return/*#__PURE__*/_jsxs(\"div\",{className:\"drag-preview-container\",style:{left:\"\".concat(dragPreview.x,\"px\")},children:[/*#__PURE__*/_jsx(\"div\",{className:\"tag-label preview\",style:{background:dragPreview.tag.color},children:/*#__PURE__*/_jsx(\"span\",{className:\"tag-label-text\",children:dragPreview.tag.name})}),/*#__PURE__*/_jsx(\"div\",{className:\"tag-pole preview\",style:{borderColor:dragPreview.tag.color,height:poleHeight}}),/*#__PURE__*/_jsx(\"div\",{className:\"tag-date preview\",style:{color:dragPreview.tag.color},children:dragPreview.formattedDate})]});};const renderChart=()=>{switch(chartType){case'area':return/*#__PURE__*/_jsxs(AreaChart,_objectSpread(_objectSpread({},commonProps),{},{children:[/*#__PURE__*/_jsxs(\"defs\",{children:[/*#__PURE__*/_jsxs(\"linearGradient\",{id:\"areaGradientTY\",x1:\"0\",y1:\"0\",x2:\"0\",y2:\"1\",children:[/*#__PURE__*/_jsx(\"stop\",{offset:\"0%\",stopColor:\"#F96302\",stopOpacity:0.25}),/*#__PURE__*/_jsx(\"stop\",{offset:\"100%\",stopColor:\"#F96302\",stopOpacity:0})]}),/*#__PURE__*/_jsxs(\"linearGradient\",{id:\"areaGradientLY\",x1:\"0\",y1:\"0\",x2:\"0\",y2:\"1\",children:[/*#__PURE__*/_jsx(\"stop\",{offset:\"0%\",stopColor:\"#86868b\",stopOpacity:0.15}),/*#__PURE__*/_jsx(\"stop\",{offset:\"100%\",stopColor:\"#86868b\",stopOpacity:0})]})]}),/*#__PURE__*/_jsx(CartesianGrid,{strokeDasharray:\"3 3\",stroke:\"rgba(0,0,0,0.04)\",vertical:false}),/*#__PURE__*/_jsx(XAxis,{dataKey:\"displayDate\",tick:axisStyle,tickLine:false,axisLine:{stroke:'rgba(0,0,0,0.08)'},tickFormatter:formatAxisDate,interval:tickInterval}),/*#__PURE__*/_jsx(YAxis,{tick:axisStyle,tickLine:false,axisLine:false,tickFormatter:formatValue,width:Y_AXIS_WIDTH}),/*#__PURE__*/_jsx(Tooltip,{content:/*#__PURE__*/_jsx(CustomTooltip,{})}),hasComparison&&/*#__PURE__*/_jsx(Legend,{}),launchDate&&showTY&&/*#__PURE__*/_jsx(ReferenceLine,{x:launchDate,stroke:\"#F96302\",strokeDasharray:\"4 4\",strokeWidth:2,label:{value:'Launch',position:'top',fill:'#F96302',fontSize:11,fontWeight:600}}),hasComparison&&lyDataKey&&showLY&&/*#__PURE__*/_jsx(Area,{type:\"monotone\",dataKey:lyDataKey,name:\"Last Year\",stroke:\"#86868b\",strokeWidth:1.5,strokeDasharray:\"4 4\",fill:\"url(#areaGradientLY)\",dot:false,activeDot:{r:4,fill:'#86868b',stroke:'#fff',strokeWidth:2}}),showTY&&/*#__PURE__*/_jsx(Area,{type:\"monotone\",dataKey:tyDataKey,name:hasComparison?\"This Year\":kpi,stroke:\"#F96302\",strokeWidth:2,fill:\"url(#areaGradientTY)\",dot:false,activeDot:{r:5,fill:'#F96302',stroke:'#fff',strokeWidth:2}})]}));case'bar':return/*#__PURE__*/_jsxs(BarChart,_objectSpread(_objectSpread({},commonProps),{},{children:[/*#__PURE__*/_jsx(CartesianGrid,{strokeDasharray:\"3 3\",stroke:\"rgba(0,0,0,0.04)\",vertical:false}),/*#__PURE__*/_jsx(XAxis,{dataKey:\"displayDate\",tick:axisStyle,tickLine:false,axisLine:{stroke:'rgba(0,0,0,0.08)'},tickFormatter:formatAxisDate,interval:tickInterval}),/*#__PURE__*/_jsx(YAxis,{tick:axisStyle,tickLine:false,axisLine:false,tickFormatter:formatValue,width:Y_AXIS_WIDTH}),/*#__PURE__*/_jsx(Tooltip,{content:/*#__PURE__*/_jsx(CustomTooltip,{})}),hasComparison&&/*#__PURE__*/_jsx(Legend,{}),launchDate&&showTY&&/*#__PURE__*/_jsx(ReferenceLine,{x:launchDate,stroke:\"#F96302\",strokeDasharray:\"4 4\",strokeWidth:2}),hasComparison&&lyDataKey&&showLY&&/*#__PURE__*/_jsx(Bar,{dataKey:lyDataKey,name:\"Last Year\",fill:\"#d1d1d6\",radius:[4,4,0,0],maxBarSize:20}),showTY&&/*#__PURE__*/_jsx(Bar,{dataKey:tyDataKey,name:hasComparison?\"This Year\":kpi,fill:\"#F96302\",radius:[4,4,0,0],maxBarSize:hasComparison?20:40})]}));default:return/*#__PURE__*/_jsxs(LineChart,_objectSpread(_objectSpread({},commonProps),{},{children:[/*#__PURE__*/_jsx(CartesianGrid,{strokeDasharray:\"3 3\",stroke:\"rgba(0,0,0,0.04)\",vertical:false}),/*#__PURE__*/_jsx(XAxis,{dataKey:\"displayDate\",tick:axisStyle,tickLine:false,axisLine:{stroke:'rgba(0,0,0,0.08)'},tickFormatter:formatAxisDate,interval:tickInterval}),/*#__PURE__*/_jsx(YAxis,{tick:axisStyle,tickLine:false,axisLine:false,tickFormatter:formatValue,width:Y_AXIS_WIDTH}),/*#__PURE__*/_jsx(Tooltip,{content:/*#__PURE__*/_jsx(CustomTooltip,{})}),hasComparison&&/*#__PURE__*/_jsx(Legend,{}),launchDate&&showTY&&/*#__PURE__*/_jsx(ReferenceLine,{x:launchDate,stroke:\"#F96302\",strokeDasharray:\"4 4\",strokeWidth:2,label:{value:'Launch',position:'top',fill:'#F96302',fontSize:11,fontWeight:600}}),hasComparison&&lyDataKey&&showLY&&/*#__PURE__*/_jsx(Line,{type:\"monotone\",dataKey:lyDataKey,name:\"Last Year\",stroke:\"#86868b\",strokeWidth:1.5,strokeDasharray:\"4 4\",dot:false,activeDot:{r:4,fill:'#86868b',stroke:'#fff',strokeWidth:2}}),showTY&&/*#__PURE__*/_jsx(Line,{type:\"monotone\",dataKey:tyDataKey,name:hasComparison?\"This Year\":kpi,stroke:\"#F96302\",strokeWidth:2,dot:false,activeDot:{r:5,fill:'#F96302',stroke:'#fff',strokeWidth:2}})]}));}};if(!chartData||chartData.length===0){return/*#__PURE__*/_jsx(\"div\",{className:\"chart-empty\",children:/*#__PURE__*/_jsx(\"p\",{children:\"No data available for the selected period\"})});}if(isBeta){return/*#__PURE__*/_jsxs(\"div\",{className:\"kpi-chart beta-restricted\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"chart-blur-wrapper\",children:/*#__PURE__*/_jsx(ResponsiveContainer,{width:\"100%\",height:320,children:renderChart()})}),/*#__PURE__*/_jsx(\"div\",{className:\"beta-overlay\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"beta-overlay-content\",children:[/*#__PURE__*/_jsx(\"h3\",{children:\"Place holder\"}),/*#__PURE__*/_jsx(\"p\",{children:\"Chart visualization\"})]})})]});}const isEditingActive=editingTagId||editingEvent;return/*#__PURE__*/_jsxs(\"div\",{className:\"kpi-chart-wrapper\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"kpi-chart \".concat(draggedTag?'drop-active':'',\" \").concat(isEditingActive?'editing-active':''),ref:chartContainerRef,onDragOver:handleDragOver,onDragLeave:handleDragLeave,onDrop:handleDrop,children:[/*#__PURE__*/_jsxs(\"div\",{className:\"tag-area\",children:[renderPlacedTags(),dragPreview&&renderDragPreview()]}),/*#__PURE__*/_jsx(\"div\",{className:\"event-spans-layer \".concat(isEditingActive?'has-editing':''),style:{height:\"\".concat(PLOT_AREA_HEIGHT,\"px\")},children:renderEventSpans()}),isEditingActive&&/*#__PURE__*/_jsx(\"div\",{className:\"chart-interaction-blocker\",onClick:e=>{e.stopPropagation();},onMouseMove:e=>{e.stopPropagation();}}),/*#__PURE__*/_jsx(ResponsiveContainer,{width:\"100%\",height:320,children:renderChart()})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"chart-tag-controls\",children:[/*#__PURE__*/_jsxs(\"button\",{className:\"tag-panel-toggle \".concat(showTagPanel?'active':''),onClick:()=>setShowTagPanel(!showTagPanel),children:[/*#__PURE__*/_jsxs(\"svg\",{width:\"16\",height:\"16\",viewBox:\"0 0 24 24\",fill:\"none\",stroke:\"currentColor\",strokeWidth:\"2\",strokeLinecap:\"round\",strokeLinejoin:\"round\",children:[/*#__PURE__*/_jsx(\"path\",{d:\"M20.59 13.41l-7.17 7.17a2 2 0 0 1-2.83 0L2 12V2h10l8.59 8.59a2 2 0 0 1 0 2.82z\"}),/*#__PURE__*/_jsx(\"line\",{x1:\"7\",y1:\"7\",x2:\"7.01\",y2:\"7\"})]}),/*#__PURE__*/_jsx(\"span\",{children:\"Add Tag\"})]}),chartTags&&chartTags.length>0&&(()=>{const pinnedEvents=chartTags.filter(tag=>tag.source==='suggested');const manualTags=chartTags.filter(tag=>tag.source!=='suggested');const renderPill=tag=>/*#__PURE__*/_jsxs(\"span\",{className:\"active-tag-pill \".concat(editingTagId===tag.id?'editing':''),style:{'--tag-color':tag.color},onClick:e=>{e.preventDefault();e.stopPropagation();openTagEditor(tag.id,tag);},children:[/*#__PURE__*/_jsx(\"span\",{className:\"pill-dot\",style:{background:tag.color}}),/*#__PURE__*/_jsx(\"span\",{className:\"pill-name\",children:tag.name}),tag.isSpan&&/*#__PURE__*/_jsxs(\"span\",{className:\"pill-range\",children:[formatShortDate(tag.startDate),\"-\",formatShortDate(tag.endDate)]}),!tag.isSpan&&/*#__PURE__*/_jsx(\"span\",{className:\"pill-date\",children:formatShortDate(tag.date)}),/*#__PURE__*/_jsx(\"button\",{className:\"pill-remove\",onClick:e=>handleRemoveTag(tag.id,e),children:/*#__PURE__*/_jsxs(\"svg\",{width:\"10\",height:\"10\",viewBox:\"0 0 24 24\",fill:\"none\",stroke:\"currentColor\",strokeWidth:\"3\",children:[/*#__PURE__*/_jsx(\"line\",{x1:\"18\",y1:\"6\",x2:\"6\",y2:\"18\"}),/*#__PURE__*/_jsx(\"line\",{x1:\"6\",y1:\"6\",x2:\"18\",y2:\"18\"})]})})]},tag.id);return/*#__PURE__*/_jsxs(\"div\",{className:\"active-tags-list\",children:[pinnedEvents.length>0&&/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsx(\"span\",{className:\"tags-section-label pinned\",children:\"Pinned\"}),pinnedEvents.map(renderPill)]}),pinnedEvents.length>0&&manualTags.length>0&&/*#__PURE__*/_jsx(\"span\",{className:\"tags-separator\"}),manualTags.length>0&&/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsx(\"span\",{className:\"tags-section-label manual\",children:\"Manual\"}),manualTags.map(renderPill)]})]});})()]}),showTagPanel&&/*#__PURE__*/_jsxs(\"div\",{className:\"tag-panel\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"tag-panel-header\",children:[/*#__PURE__*/_jsx(\"h4\",{children:\"Add Event Tag\"}),/*#__PURE__*/_jsx(\"button\",{className:\"tag-panel-close\",onClick:()=>setShowTagPanel(false),children:/*#__PURE__*/_jsxs(\"svg\",{width:\"16\",height:\"16\",viewBox:\"0 0 24 24\",fill:\"none\",stroke:\"currentColor\",strokeWidth:\"2\",children:[/*#__PURE__*/_jsx(\"line\",{x1:\"18\",y1:\"6\",x2:\"6\",y2:\"18\"}),/*#__PURE__*/_jsx(\"line\",{x1:\"6\",y1:\"6\",x2:\"18\",y2:\"18\"})]})})]}),/*#__PURE__*/_jsx(\"p\",{className:\"tag-panel-hint\",children:\"Drag a tag onto the chart. Click to edit dates and convert to a span.\"}),dismissedEvents.length>0&&/*#__PURE__*/_jsxs(\"button\",{className:\"reset-dismissed-btn\",onClick:handleResetDismissed,children:[\"Restore \",dismissedEvents.length,\" dismissed\"]}),/*#__PURE__*/_jsx(\"div\",{className:\"preset-tags\",children:PRESET_TAGS.map(tag=>/*#__PURE__*/_jsxs(\"div\",{className:\"draggable-tag\",draggable:true,onDragStart:e=>handleDragStart(e,tag),onDragEnd:handleDragEnd,style:{borderColor:tag.color},children:[/*#__PURE__*/_jsx(\"span\",{className:\"tag-marker\",style:{background:tag.color}}),tag.name]},tag.id))}),/*#__PURE__*/_jsx(\"div\",{className:\"custom-tag-section\",children:!showCustomForm?/*#__PURE__*/_jsxs(\"button\",{className:\"add-custom-tag-btn\",onClick:()=>setShowCustomForm(true),children:[/*#__PURE__*/_jsxs(\"svg\",{width:\"14\",height:\"14\",viewBox:\"0 0 24 24\",fill:\"none\",stroke:\"currentColor\",strokeWidth:\"2\",children:[/*#__PURE__*/_jsx(\"line\",{x1:\"12\",y1:\"5\",x2:\"12\",y2:\"19\"}),/*#__PURE__*/_jsx(\"line\",{x1:\"5\",y1:\"12\",x2:\"19\",y2:\"12\"})]}),\"Custom Tag\"]}):/*#__PURE__*/_jsxs(\"div\",{className:\"custom-tag-form\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"custom-form-row\",children:[/*#__PURE__*/_jsx(\"input\",{type:\"text\",placeholder:\"Tag name\",value:customTagName,onChange:e=>setCustomTagName(e.target.value),className:\"custom-tag-input\"}),/*#__PURE__*/_jsx(\"input\",{type:\"text\",placeholder:\"Owner\",value:customTagOwner,onChange:e=>setCustomTagOwner(e.target.value),className:\"custom-tag-input\"})]}),/*#__PURE__*/_jsx(\"input\",{type:\"text\",placeholder:\"Description (optional)\",value:customTagDescription,onChange:e=>setCustomTagDescription(e.target.value),className:\"custom-tag-input full\"}),/*#__PURE__*/_jsxs(\"div\",{className:\"custom-tag-actions\",children:[/*#__PURE__*/_jsx(\"button\",{className:\"custom-tag-cancel\",onClick:()=>{setShowCustomForm(false);setCustomTagName('');setCustomTagOwner('');setCustomTagDescription('');},children:\"Cancel\"}),/*#__PURE__*/_jsx(\"button\",{className:\"custom-tag-create\",onClick:handleAddCustomTag,disabled:!customTagName.trim()||!customTagOwner.trim(),children:\"Create\"})]})]})}),draggedTag&&draggedTag.isCustom&&/*#__PURE__*/_jsxs(\"div\",{className:\"drag-instruction\",children:[/*#__PURE__*/_jsxs(\"p\",{children:[\"Drag \\\"\",draggedTag.name,\"\\\" onto the chart:\"]}),/*#__PURE__*/_jsxs(\"div\",{className:\"draggable-tag custom\",draggable:true,onDragStart:e=>handleDragStart(e,draggedTag),onDragEnd:handleDragEnd,children:[/*#__PURE__*/_jsx(\"span\",{className:\"tag-marker\",style:{background:draggedTag.color}}),draggedTag.name]})]})]})]});}export default KPIChart;","map":{"version":3,"names":["useState","useRef","useCallback","useEffect","LineChart","Line","AreaChart","Area","BarChart","Bar","XAxis","YAxis","CartesianGrid","Tooltip","ResponsiveContainer","ReferenceLine","Legend","useAuth","jsx","_jsx","jsxs","_jsxs","Fragment","_Fragment","PRESET_TAGS","id","name","color","CHART_MARGINS","top","right","left","bottom","Y_AXIS_WIDTH","CHART_HEIGHT","PLOT_AREA_HEIGHT","hexToRgba","hex","alpha","r","parseInt","slice","g","b","concat","KPIChart","_ref","data","kpi","chartType","format","launchDate","comparisonData","chartTags","onTagsChange","displayMode","events","showSuggestedEvents","isBetaMode","isBeta","chartContainerRef","showTagPanel","setShowTagPanel","customTagName","setCustomTagName","customTagOwner","setCustomTagOwner","customTagDescription","setCustomTagDescription","draggedTag","setDraggedTag","showCustomForm","setShowCustomForm","dragPreview","setDragPreview","containerWidth","setContainerWidth","editingTagId","setEditingTagId","editingTagData","setEditingTagData","dismissedEvents","setDismissedEvents","stored","sessionStorage","getItem","JSON","parse","_unused","editingEvent","setEditingEvent","rawChartData","length","hasComparison","chartData","map","d","_objectSpread","displayDate","date_ly","date","updateWidth","current","width","offsetWidth","initialTimeout","setTimeout","secondTimeout","window","addEventListener","resizeObserver","ResizeObserver","requestAnimationFrame","observe","clearTimeout","removeEventListener","disconnect","handleClickOutside","e","clickedElement","target","isInsidePopover","closest","isInsideEventEdit","isTagLabel","isSpanLabel","isActivePill","isButton","isInput","timeoutId","document","formatValue","val","undefined","isNaN","Math","abs","toFixed","toLocaleString","formatAxisDate","dateStr","Date","toLocaleDateString","month","day","formatFullDate","weekday","year","formatShortDate","getContainerRect","getBoundingClientRect","getDateIndexFromX","clientX","rect","chartAreaLeft","chartAreaWidth","relativeX","percentage","max","min","dataIndex","round","getXPositionForIndex","index","_chartContainerRef$cu","getDateFromIndex","_chartData$index","getIndexFromDate","findIndex","CustomTooltip","_ref2","active","payload","label","dataPoint","find","formatDate","dateTag","t","className","children","style","background","entry","value","handleDragStart","tag","tagForDrag","startsWith","dataTransfer","effectAllowed","img","Image","src","setDragImage","handleDragOver","_chartData$dateIndex","preventDefault","dropEffect","dateIndex","targetDate","xPosition","formattedDate","x","handleDragLeave","_chartContainerRef$cu2","clientY","handleDrop","_chartData$dateIndex2","uniqueId","now","random","toString","substr","newTag","startDate","endDate","startIndex","endIndex","isSpan","isManual","createdAt","toISOString","owner","description","handleDragEnd","handleAddCustomTag","trim","isCustom","openTagEditor","tagId","tagIndex","closeTagEditor","handleTagLabelClick","stopPropagation","handleEditingDataChange","field","prev","handleStartDateChange","newIndex","newStartDate","handleEndDateChange","newEndDate","handleSaveTagEdit","updatedTags","adjustedStart","adjustedEnd","yearLabel","updatedAt","handleConvertToSpan","currentIndex","defaultSpanDays","newEndIndex","handleConvertToPoint","handleRemoveTag","filter","setItem","stringify","_unused2","handleDismissEvent","eventId","handleResetDismissed","pinnedEventIds","sourceEventId","getFilteredEvents","_chartData$","_chartData","chartStartDate","chartEndDate","chartStart","chartEnd","ev","includes","evStart","evEnd","getTime","getIndexForDate","bestIdx","bestDiff","Infinity","i","diff","renderCompactEditPopover","isInSpanLayer","arguments","dayCount","handlePopoverClick","handlePopoverMouseMove","borderColor","onClick","onMouseDown","onMouseMove","onMouseEnter","type","onChange","placeholder","height","viewBox","fill","stroke","strokeWidth","x1","y1","x2","y2","disabled","renderSingleSpan","_chartContainerRef$cu3","isPinned","isManualSpan","currentWidth","startIdx","endIdx","clampedStart","clampedEnd","startPct","endPct","leftPx","rightPx","widthPx","centerPx","fillColor","isBeingEdited","spanLabel","handleSpanClick","borderLeft","borderRight","title","tier","source","getPinnedSpans","_chartData$2","_chartData2","tagStart","tagEnd","getManualSpans","renderEventSpans","_chartContainerRef$cu4","pinnedSpans","manualSpans","suggestedEvents","span","commonProps","margin","axisStyle","fontSize","fontWeight","calculateTickInterval","dataPoints","targetTicks","interval","floor","tickInterval","tyDataKey","lyDataKey","showTY","showLY","renderPlacedTags","_chartContainerRef$cu5","pointTags","poleHeight","xPos","isEditing","renderDragPreview","renderChart","offset","stopColor","stopOpacity","strokeDasharray","vertical","dataKey","tick","tickLine","axisLine","tickFormatter","content","position","dot","activeDot","radius","maxBarSize","isEditingActive","ref","onDragOver","onDragLeave","onDrop","strokeLinecap","strokeLinejoin","pinnedEvents","manualTags","renderPill","draggable","onDragStart","onDragEnd"],"sources":["C:/Users/AkashPatil/THD-Dashboard/frontend/src/components/KPIChart.js"],"sourcesContent":["import { useState, useRef, useCallback, useEffect } from 'react';\r\nimport {\r\n  LineChart, Line, AreaChart, Area, BarChart, Bar,\r\n  XAxis, YAxis, CartesianGrid, Tooltip, ResponsiveContainer,\r\n  ReferenceLine, Legend\r\n} from 'recharts';\r\nimport { useAuth } from '../context/AuthContext';\r\nimport './KPIChart.css';\r\n\r\nconst PRESET_TAGS = [\r\n  { id: 'thanksgiving', name: 'Thanksgiving', color: '#F96302' },\r\n  { id: 'july4th', name: '4th of July', color: '#FF3B30' },\r\n  { id: 'tier1', name: 'Tier 1 Event', color: '#5856D6' },\r\n  { id: 'promo', name: 'Promo', color: '#34C759' },\r\n  { id: 'outage', name: 'Outage/Issue', color: '#FF2D55' }\r\n];\r\n\r\nconst CHART_MARGINS = { top: 20, right: 20, left: 10, bottom: 20 };\r\nconst Y_AXIS_WIDTH = 60;\r\nconst CHART_HEIGHT = 320;\r\nconst PLOT_AREA_HEIGHT = CHART_HEIGHT - CHART_MARGINS.top - CHART_MARGINS.bottom - 54;\r\n\r\nfunction hexToRgba(hex, alpha) {\r\n  const r = parseInt(hex.slice(1, 3), 16);\r\n  const g = parseInt(hex.slice(3, 5), 16);\r\n  const b = parseInt(hex.slice(5, 7), 16);\r\n  return `rgba(${r},${g},${b},${alpha})`;\r\n}\r\n\r\nfunction KPIChart({ data, kpi, chartType, format, launchDate, comparisonData, chartTags, onTagsChange, displayMode = 'both', events = [], showSuggestedEvents = false }) {\r\n  const { isBetaMode } = useAuth();\r\n  const isBeta = isBetaMode();\r\n  const chartContainerRef = useRef(null);\r\n  const [showTagPanel, setShowTagPanel] = useState(false);\r\n  const [customTagName, setCustomTagName] = useState('');\r\n  const [customTagOwner, setCustomTagOwner] = useState('');\r\n  const [customTagDescription, setCustomTagDescription] = useState('');\r\n  const [draggedTag, setDraggedTag] = useState(null);\r\n  const [showCustomForm, setShowCustomForm] = useState(false);\r\n  const [dragPreview, setDragPreview] = useState(null);\r\n  const [containerWidth, setContainerWidth] = useState(0);\r\n  const [editingTagId, setEditingTagId] = useState(null);\r\n  const [editingTagData, setEditingTagData] = useState(null);\r\n  const [dismissedEvents, setDismissedEvents] = useState(() => {\r\n    try {\r\n      const stored = sessionStorage.getItem('dismissedEvents');\r\n      return stored ? JSON.parse(stored) : [];\r\n    } catch { return []; }\r\n  });\r\n  const [editingEvent, setEditingEvent] = useState(null);\r\n\r\n  const rawChartData = comparisonData && comparisonData.length > 0 ? comparisonData : data;\r\n  const hasComparison = comparisonData && comparisonData.length > 0;\r\n\r\n  const chartData = rawChartData?.map(d => ({\r\n    ...d,\r\n    displayDate: displayMode === 'ly' && d.date_ly ? d.date_ly : d.date\r\n  })) || [];\r\n\r\n  useEffect(() => {\r\n    const updateWidth = () => {\r\n      if (chartContainerRef.current) {\r\n        const width = chartContainerRef.current.offsetWidth;\r\n        if (width > 0) {\r\n          setContainerWidth(width);\r\n        }\r\n      }\r\n    };\r\n\r\n    updateWidth();\r\n    const initialTimeout = setTimeout(updateWidth, 100);\r\n    const secondTimeout = setTimeout(updateWidth, 300);\r\n\r\n    window.addEventListener('resize', updateWidth);\r\n\r\n    const resizeObserver = new ResizeObserver(() => {\r\n      requestAnimationFrame(updateWidth);\r\n    });\r\n    if (chartContainerRef.current) {\r\n      resizeObserver.observe(chartContainerRef.current);\r\n    }\r\n\r\n    return () => {\r\n      clearTimeout(initialTimeout);\r\n      clearTimeout(secondTimeout);\r\n      window.removeEventListener('resize', updateWidth);\r\n      resizeObserver.disconnect();\r\n    };\r\n  }, []);\r\n\r\n  useEffect(() => {\r\n    if (chartTags && chartTags.length > 0 && chartContainerRef.current) {\r\n      const width = chartContainerRef.current.offsetWidth;\r\n      if (width > 0 && containerWidth !== width) {\r\n        setContainerWidth(width);\r\n      }\r\n    }\r\n  }, [chartTags, containerWidth]);\r\n\r\n  useEffect(() => {\r\n    if (!editingTagId && !editingEvent) return;\r\n\r\n    const handleClickOutside = (e) => {\r\n      const clickedElement = e.target;\r\n      \r\n      const isInsidePopover = clickedElement.closest('.tag-edit-popover');\r\n      const isInsideEventEdit = clickedElement.closest('.event-span-edit');\r\n      const isTagLabel = clickedElement.closest('.tag-label');\r\n      const isSpanLabel = clickedElement.closest('.event-span-label');\r\n      const isActivePill = clickedElement.closest('.active-tag-pill');\r\n      const isButton = clickedElement.closest('button');\r\n      const isInput = clickedElement.closest('input');\r\n      \r\n      if (isInsidePopover || isInsideEventEdit || isTagLabel || isSpanLabel || isActivePill || isButton || isInput) {\r\n        return;\r\n      }\r\n\r\n      setEditingTagId(null);\r\n      setEditingTagData(null);\r\n      setEditingEvent(null);\r\n    };\r\n\r\n    const timeoutId = setTimeout(() => {\r\n      document.addEventListener('click', handleClickOutside, true);\r\n    }, 50);\r\n\r\n    return () => {\r\n      clearTimeout(timeoutId);\r\n      document.removeEventListener('click', handleClickOutside, true);\r\n    };\r\n  }, [editingTagId, editingEvent]);\r\n\r\n  const formatValue = (val) => {\r\n    if (val === null || val === undefined || isNaN(val)) return '-';\r\n\r\n    if (format === 'currency') {\r\n      if (Math.abs(val) >= 1000000) {\r\n        return `$${(val / 1000000).toFixed(1)}M`;\r\n      }\r\n      if (Math.abs(val) >= 1000) {\r\n        return `$${(val / 1000).toFixed(0)}K`;\r\n      }\r\n      return `$${val.toFixed(2)}`;\r\n    }\r\n    if (format === 'percentage') {\r\n      return `${(val * 100).toFixed(2)}%`;\r\n    }\r\n    if (Math.abs(val) >= 1000000) {\r\n      return `${(val / 1000000).toFixed(1)}M`;\r\n    }\r\n    if (Math.abs(val) >= 1000) {\r\n      return `${(val / 1000).toFixed(0)}K`;\r\n    }\r\n    return val.toLocaleString();\r\n  };\r\n\r\n  const formatAxisDate = (dateStr) => {\r\n    const date = new Date(dateStr);\r\n    return date.toLocaleDateString('en-US', { month: 'short', day: 'numeric' });\r\n  };\r\n\r\n  const formatFullDate = (dateStr) => {\r\n    const date = new Date(dateStr);\r\n    return date.toLocaleDateString('en-US', {\r\n      weekday: 'short',\r\n      month: 'short',\r\n      day: 'numeric',\r\n      year: 'numeric'\r\n    });\r\n  };\r\n\r\n  const formatShortDate = (dateStr) => {\r\n    if (!dateStr) return '-';\r\n    const date = new Date(dateStr);\r\n    return date.toLocaleDateString('en-US', { month: 'short', day: 'numeric' });\r\n  };\r\n\r\n  const getContainerRect = useCallback(() => {\r\n    if (!chartContainerRef.current) return null;\r\n    return chartContainerRef.current.getBoundingClientRect();\r\n  }, []);\r\n\r\n  const getDateIndexFromX = useCallback((clientX) => {\r\n    if (!chartData || chartData.length === 0) return -1;\r\n    const rect = getContainerRect();\r\n    if (!rect) return -1;\r\n\r\n    const chartAreaLeft = Y_AXIS_WIDTH + CHART_MARGINS.left;\r\n    const chartAreaWidth = rect.width - chartAreaLeft - CHART_MARGINS.right;\r\n\r\n    const relativeX = clientX - rect.left - chartAreaLeft;\r\n    const percentage = Math.max(0, Math.min(1, relativeX / chartAreaWidth));\r\n\r\n    const dataIndex = Math.round(percentage * (chartData.length - 1));\r\n    return Math.max(0, Math.min(dataIndex, chartData.length - 1));\r\n  }, [chartData, getContainerRect]);\r\n\r\n  const getXPositionForIndex = useCallback((index) => {\r\n    if (!chartData || chartData.length === 0 || index < 0) return 0;\r\n\r\n    const width = containerWidth || (chartContainerRef.current?.offsetWidth || 0);\r\n    if (width === 0) return 0;\r\n\r\n    const chartAreaLeft = Y_AXIS_WIDTH + CHART_MARGINS.left;\r\n    const chartAreaWidth = width - chartAreaLeft - CHART_MARGINS.right;\r\n\r\n    if (chartData.length === 1) {\r\n      return chartAreaLeft + chartAreaWidth / 2;\r\n    }\r\n\r\n    const percentage = index / (chartData.length - 1);\r\n    return chartAreaLeft + (percentage * chartAreaWidth);\r\n  }, [chartData, containerWidth]);\r\n\r\n  const getDateFromIndex = useCallback((index) => {\r\n    if (!chartData || chartData.length === 0 || index < 0 || index >= chartData.length) return null;\r\n    return chartData[index]?.date || null;\r\n  }, [chartData]);\r\n\r\n  const getIndexFromDate = useCallback((dateStr) => {\r\n    if (!chartData || chartData.length === 0 || !dateStr) return -1;\r\n    return chartData.findIndex(d => d.date === dateStr);\r\n  }, [chartData]);\r\n\r\n  const CustomTooltip = ({ active, payload, label }) => {\r\n    if (active && payload && payload.length) {\r\n      const dataPoint = chartData?.find(d => d.displayDate === label);\r\n\r\n      const formatDate = (dateStr) => new Date(dateStr).toLocaleDateString('en-US', {\r\n        weekday: 'short',\r\n        month: 'short',\r\n        day: 'numeric',\r\n        year: 'numeric'\r\n      });\r\n\r\n      const dateTag = chartTags?.find(t => t.date === label || t.date === dataPoint?.date);\r\n\r\n      return (\r\n        <div className=\"chart-tooltip\">\r\n          {displayMode === 'ly' ? (\r\n            <p className=\"tooltip-date\">{formatDate(dataPoint?.date_ly || label)}</p>\r\n          ) : displayMode === 'both' && dataPoint?.date && dataPoint?.date_ly ? (\r\n            <>\r\n              <p className=\"tooltip-date\">TY: {formatDate(dataPoint.date)}</p>\r\n              <p className=\"tooltip-date tooltip-date-ly\">LY: {formatDate(dataPoint.date_ly)}</p>\r\n            </>\r\n          ) : (\r\n            <p className=\"tooltip-date\">{formatDate(dataPoint?.date || label)}</p>\r\n          )}\r\n          {dateTag && (\r\n            <p className=\"tooltip-tag\">\r\n              <span className=\"tooltip-tag-marker\" style={{ background: dateTag.color }}></span>\r\n              {dateTag.name}\r\n            </p>\r\n          )}\r\n          {payload.map((entry, index) => (\r\n            <p key={index} className=\"tooltip-value\" style={{ color: entry.color }}>\r\n              <span className=\"tooltip-label\">{entry.name}: </span>\r\n              {formatValue(entry.value)}\r\n            </p>\r\n          ))}\r\n        </div>\r\n      );\r\n    }\r\n    return null;\r\n  };\r\n\r\n  const handleDragStart = (e, tag) => {\r\n    const tagForDrag = {\r\n      ...tag,\r\n      id: tag.id.startsWith('custom-') ? tag.id : tag.id\r\n    };\r\n    setDraggedTag(tagForDrag);\r\n    e.dataTransfer.effectAllowed = 'copy';\r\n    const img = new Image();\r\n    img.src = 'data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7';\r\n    e.dataTransfer.setDragImage(img, 0, 0);\r\n  };\r\n\r\n  const handleDragOver = (e) => {\r\n    e.preventDefault();\r\n    e.dataTransfer.dropEffect = 'copy';\r\n\r\n    if (!draggedTag || !chartData || chartData.length === 0) return;\r\n\r\n    const rect = getContainerRect();\r\n    if (!rect) return;\r\n\r\n    const dateIndex = getDateIndexFromX(e.clientX);\r\n    const targetDate = chartData[dateIndex]?.date;\r\n\r\n    const xPosition = getXPositionForIndex(dateIndex);\r\n\r\n    if (targetDate && dateIndex >= 0) {\r\n      setDragPreview({\r\n        date: targetDate,\r\n        formattedDate: formatFullDate(targetDate),\r\n        x: xPosition,\r\n        index: dateIndex,\r\n        tag: draggedTag\r\n      });\r\n    }\r\n  };\r\n\r\n  const handleDragLeave = (e) => {\r\n    const rect = chartContainerRef.current?.getBoundingClientRect();\r\n    if (rect) {\r\n      const { clientX, clientY } = e;\r\n      if (clientX < rect.left || clientX > rect.right ||\r\n          clientY < rect.top || clientY > rect.bottom) {\r\n        setDragPreview(null);\r\n      }\r\n    }\r\n  };\r\n\r\n  const handleDrop = (e) => {\r\n    e.preventDefault();\r\n    if (!draggedTag || !chartData || chartData.length === 0) return;\r\n\r\n    const dateIndex = getDateIndexFromX(e.clientX);\r\n    const targetDate = chartData[dateIndex]?.date;\r\n\r\n    if (targetDate) {\r\n      const uniqueId = `${draggedTag.id}-${Date.now()}-${Math.random().toString(36).substr(2, 9)}`;\r\n      \r\n      const newTag = {\r\n        ...draggedTag,\r\n        id: uniqueId,\r\n        date: targetDate,\r\n        startDate: targetDate,\r\n        endDate: targetDate,\r\n        dateIndex: dateIndex,\r\n        startIndex: dateIndex,\r\n        endIndex: dateIndex,\r\n        isSpan: false,\r\n        isManual: true,\r\n        createdAt: new Date().toISOString()\r\n      };\r\n\r\n      if (onTagsChange) {\r\n        onTagsChange([...(chartTags || []), newTag]);\r\n      }\r\n\r\n      setTimeout(() => {\r\n        setEditingTagId(uniqueId);\r\n        setEditingTagData({\r\n          name: newTag.name,\r\n          owner: newTag.owner || '',\r\n          description: newTag.description || '',\r\n          startDate: targetDate,\r\n          endDate: targetDate,\r\n          startIndex: dateIndex,\r\n          endIndex: dateIndex\r\n        });\r\n      }, 50);\r\n    }\r\n\r\n    setDraggedTag(null);\r\n    setDragPreview(null);\r\n  };\r\n\r\n  const handleDragEnd = () => {\r\n    setDragPreview(null);\r\n    setDraggedTag(null);\r\n  };\r\n\r\n  const handleAddCustomTag = () => {\r\n    if (!customTagName.trim() || !customTagOwner.trim()) return;\r\n\r\n    const newTag = {\r\n      id: `custom-${Date.now()}`,\r\n      name: customTagName.trim(),\r\n      owner: customTagOwner.trim(),\r\n      description: customTagDescription.trim() || '',\r\n      color: '#6e6e73',\r\n      isCustom: true\r\n    };\r\n\r\n    setDraggedTag(newTag);\r\n    setCustomTagName('');\r\n    setCustomTagOwner('');\r\n    setCustomTagDescription('');\r\n    setShowCustomForm(false);\r\n  };\r\n\r\n  const openTagEditor = useCallback((tagId, tag) => {\r\n    const tagIndex = tag.startIndex !== undefined ? tag.startIndex : \r\n                     (tag.dateIndex !== undefined ? tag.dateIndex : getIndexFromDate(tag.date));\r\n    const endIndex = tag.endIndex !== undefined ? tag.endIndex : tagIndex;\r\n    \r\n    setEditingTagId(tagId);\r\n    setEditingTagData({\r\n      name: tag.name || '',\r\n      owner: tag.owner || '',\r\n      description: tag.description || '',\r\n      startDate: tag.startDate || tag.date,\r\n      endDate: tag.endDate || tag.date,\r\n      startIndex: tagIndex,\r\n      endIndex: endIndex\r\n    });\r\n  }, [getIndexFromDate]);\r\n\r\n  const closeTagEditor = useCallback(() => {\r\n    setEditingTagId(null);\r\n    setEditingTagData(null);\r\n  }, []);\r\n\r\n  const handleTagLabelClick = useCallback((e, tagId, tag) => {\r\n    e.preventDefault();\r\n    e.stopPropagation();\r\n    \r\n    if (editingTagId === tagId) {\r\n      return;\r\n    }\r\n    \r\n    openTagEditor(tagId, tag);\r\n  }, [editingTagId, openTagEditor]);\r\n\r\n  const handleEditingDataChange = useCallback((field, value) => {\r\n    setEditingTagData(prev => prev ? { ...prev, [field]: value } : null);\r\n  }, []);\r\n\r\n  const handleStartDateChange = useCallback((newIndex) => {\r\n    if (!editingTagData || newIndex < 0 || newIndex >= chartData.length) return;\r\n    \r\n    const newStartDate = getDateFromIndex(newIndex);\r\n    if (!newStartDate) return;\r\n\r\n    let endIndex = editingTagData.endIndex;\r\n    if (newIndex > endIndex) {\r\n      endIndex = newIndex;\r\n    }\r\n\r\n    setEditingTagData(prev => prev ? {\r\n      ...prev,\r\n      startDate: newStartDate,\r\n      startIndex: newIndex,\r\n      endDate: getDateFromIndex(endIndex) || prev.endDate,\r\n      endIndex: endIndex\r\n    } : null);\r\n  }, [editingTagData, chartData.length, getDateFromIndex]);\r\n\r\n  const handleEndDateChange = useCallback((newIndex) => {\r\n    if (!editingTagData || newIndex < 0 || newIndex >= chartData.length) return;\r\n    \r\n    const newEndDate = getDateFromIndex(newIndex);\r\n    if (!newEndDate) return;\r\n\r\n    let startIndex = editingTagData.startIndex;\r\n    if (newIndex < startIndex) {\r\n      startIndex = newIndex;\r\n    }\r\n\r\n    setEditingTagData(prev => prev ? {\r\n      ...prev,\r\n      endDate: newEndDate,\r\n      endIndex: newIndex,\r\n      startDate: getDateFromIndex(startIndex) || prev.startDate,\r\n      startIndex: startIndex\r\n    } : null);\r\n  }, [editingTagData, chartData.length, getDateFromIndex]);\r\n\r\n  const handleSaveTagEdit = useCallback(() => {\r\n    if (!editingTagId || !editingTagData) return;\r\n\r\n    const isSpan = editingTagData.startIndex !== editingTagData.endIndex;\r\n\r\n    const updatedTags = (chartTags || []).map(tag => {\r\n      if (tag.id === editingTagId) {\r\n        return {\r\n          ...tag,\r\n          name: editingTagData.name,\r\n          owner: editingTagData.owner,\r\n          description: editingTagData.description,\r\n          startDate: editingTagData.startDate,\r\n          endDate: editingTagData.endDate,\r\n          date: editingTagData.startDate,\r\n          startIndex: editingTagData.startIndex,\r\n          endIndex: editingTagData.endIndex,\r\n          dateIndex: editingTagData.startIndex,\r\n          isSpan: isSpan,\r\n          adjustedStart: new Date(editingTagData.startDate + 'T00:00:00').toISOString(),\r\n          adjustedEnd: new Date(editingTagData.endDate + 'T00:00:00').toISOString(),\r\n          yearLabel: displayMode === 'ly' ? 'LY' : 'TY',\r\n          updatedAt: new Date().toISOString()\r\n        };\r\n      }\r\n      return tag;\r\n    });\r\n\r\n    if (onTagsChange) {\r\n      onTagsChange(updatedTags);\r\n    }\r\n\r\n    closeTagEditor();\r\n  }, [editingTagId, editingTagData, chartTags, displayMode, onTagsChange, closeTagEditor]);\r\n\r\n  const handleConvertToSpan = useCallback((e) => {\r\n    if (e) {\r\n      e.preventDefault();\r\n      e.stopPropagation();\r\n    }\r\n    if (!editingTagData) return;\r\n\r\n    const currentIndex = editingTagData.startIndex;\r\n    const defaultSpanDays = 3;\r\n    const newEndIndex = Math.min(currentIndex + defaultSpanDays, chartData.length - 1);\r\n    const newEndDate = getDateFromIndex(newEndIndex);\r\n\r\n    setEditingTagData(prev => prev ? {\r\n      ...prev,\r\n      endDate: newEndDate || prev.endDate,\r\n      endIndex: newEndIndex\r\n    } : null);\r\n  }, [editingTagData, chartData.length, getDateFromIndex]);\r\n\r\n  const handleConvertToPoint = useCallback((e) => {\r\n    if (e) {\r\n      e.preventDefault();\r\n      e.stopPropagation();\r\n    }\r\n    if (!editingTagData) return;\r\n\r\n    const startDate = editingTagData.startDate;\r\n    const startIndex = editingTagData.startIndex;\r\n\r\n    setEditingTagData(prev => prev ? {\r\n      ...prev,\r\n      endDate: startDate,\r\n      endIndex: startIndex\r\n    } : null);\r\n  }, [editingTagData]);\r\n\r\n  const handleRemoveTag = useCallback((tagId, e) => {\r\n    if (e) {\r\n      e.preventDefault();\r\n      e.stopPropagation();\r\n    }\r\n    \r\n    if (onTagsChange) {\r\n      onTagsChange((chartTags || []).filter(t => t.id !== tagId));\r\n    }\r\n    if (editingTagId === tagId) {\r\n      closeTagEditor();\r\n    }\r\n  }, [chartTags, editingTagId, onTagsChange, closeTagEditor]);\r\n\r\n  useEffect(() => {\r\n    try {\r\n      sessionStorage.setItem('dismissedEvents', JSON.stringify(dismissedEvents));\r\n    } catch { }\r\n  }, [dismissedEvents]);\r\n\r\n  const handleDismissEvent = (eventId) => {\r\n    setDismissedEvents(prev => [...prev, eventId]);\r\n  };\r\n\r\n  const handleResetDismissed = () => {\r\n    setDismissedEvents([]);\r\n  };\r\n\r\n  const pinnedEventIds = (chartTags || [])\r\n    .filter(tag => tag.sourceEventId)\r\n    .map(tag => tag.sourceEventId);\r\n\r\n  const getFilteredEvents = useCallback(() => {\r\n    if (!events || events.length === 0 || !chartData || chartData.length === 0) return [];\r\n\r\n    const chartStartDate = chartData[0]?.date;\r\n    const chartEndDate = chartData[chartData.length - 1]?.date;\r\n    if (!chartStartDate || !chartEndDate) return [];\r\n\r\n    const chartStart = new Date(chartStartDate + 'T00:00:00');\r\n    const chartEnd = new Date(chartEndDate + 'T00:00:00');\r\n\r\n    const yearLabel = displayMode === 'ly' ? 'LY' : 'TY';\r\n\r\n    return events\r\n      .filter(ev => !dismissedEvents.includes(ev.id))\r\n      .filter(ev => !pinnedEventIds.includes(ev.id))\r\n      .map(ev => {\r\n        let evStart = new Date(ev.startDate + 'T00:00:00');\r\n        let evEnd = new Date(ev.endDate + 'T00:00:00');\r\n\r\n        if (displayMode === 'ly') {\r\n          evStart = new Date(evStart.getTime() - 365 * 24 * 60 * 60 * 1000);\r\n          evEnd = new Date(evEnd.getTime() - 365 * 24 * 60 * 60 * 1000);\r\n        }\r\n\r\n        return { ...ev, adjustedStart: evStart, adjustedEnd: evEnd, yearLabel };\r\n      })\r\n      .filter(ev => ev.adjustedStart <= chartEnd && ev.adjustedEnd >= chartStart);\r\n  }, [events, chartData, displayMode, dismissedEvents, pinnedEventIds]);\r\n\r\n  const getIndexForDate = useCallback((targetDate) => {\r\n    if (!chartData || chartData.length === 0) return -1;\r\n    let bestIdx = 0;\r\n    let bestDiff = Infinity;\r\n    for (let i = 0; i < chartData.length; i++) {\r\n      const d = new Date(chartData[i].date + 'T00:00:00');\r\n      const diff = Math.abs(d.getTime() - targetDate.getTime());\r\n      if (diff < bestDiff) {\r\n        bestDiff = diff;\r\n        bestIdx = i;\r\n      }\r\n    }\r\n    return bestIdx;\r\n  }, [chartData]);\r\n\r\n  const renderCompactEditPopover = (tag, isInSpanLayer = false) => {\r\n    if (editingTagId !== tag.id || !editingTagData) return null;\r\n\r\n    const isSpan = editingTagData.startIndex !== editingTagData.endIndex;\r\n    const dayCount = editingTagData.endIndex - editingTagData.startIndex + 1;\r\n\r\n    const handlePopoverClick = (e) => {\r\n      e.preventDefault();\r\n      e.stopPropagation();\r\n    };\r\n\r\n    const handlePopoverMouseMove = (e) => {\r\n      e.stopPropagation();\r\n    };\r\n\r\n    return (\r\n      <div\r\n        className={`tag-edit-popover compact ${isInSpanLayer ? 'in-span-layer' : ''}`}\r\n        style={{ borderColor: tag.color }}\r\n        onClick={handlePopoverClick}\r\n        onMouseDown={handlePopoverClick}\r\n        onMouseMove={handlePopoverMouseMove}\r\n        onMouseEnter={handlePopoverClick}\r\n      >\r\n        <div className=\"edit-popover-header\">\r\n          <input\r\n            type=\"text\"\r\n            className=\"edit-name-input\"\r\n            value={editingTagData.name}\r\n            onChange={(e) => handleEditingDataChange('name', e.target.value)}\r\n            placeholder=\"Event name\"\r\n            onClick={handlePopoverClick}\r\n            onMouseDown={handlePopoverClick}\r\n          />\r\n          <button \r\n            className=\"edit-popover-close\" \r\n            onClick={(e) => { \r\n              e.preventDefault();\r\n              e.stopPropagation(); \r\n              closeTagEditor(); \r\n            }}\r\n          >\r\n            <svg width=\"14\" height=\"14\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" strokeWidth=\"2\">\r\n              <line x1=\"18\" y1=\"6\" x2=\"6\" y2=\"18\"></line>\r\n              <line x1=\"6\" y1=\"6\" x2=\"18\" y2=\"18\"></line>\r\n            </svg>\r\n          </button>\r\n        </div>\r\n\r\n        <div className=\"edit-row\">\r\n          <input\r\n            type=\"text\"\r\n            className=\"edit-field-small\"\r\n            value={editingTagData.owner}\r\n            onChange={(e) => handleEditingDataChange('owner', e.target.value)}\r\n            placeholder=\"Owner\"\r\n            onClick={handlePopoverClick}\r\n            onMouseDown={handlePopoverClick}\r\n          />\r\n          <input\r\n            type=\"text\"\r\n            className=\"edit-field-small\"\r\n            value={editingTagData.description}\r\n            onChange={(e) => handleEditingDataChange('description', e.target.value)}\r\n            placeholder=\"Note\"\r\n            onClick={handlePopoverClick}\r\n            onMouseDown={handlePopoverClick}\r\n          />\r\n        </div>\r\n\r\n        <div className=\"edit-date-row\" onClick={handlePopoverClick} onMouseDown={handlePopoverClick}>\r\n          <div className=\"date-control\">\r\n            <button \r\n              className=\"date-btn\"\r\n              onClick={(e) => { \r\n                e.preventDefault();\r\n                e.stopPropagation(); \r\n                handleStartDateChange(editingTagData.startIndex - 1); \r\n              }}\r\n              disabled={editingTagData.startIndex <= 0}\r\n            >-</button>\r\n            <span className=\"date-value\">{formatShortDate(editingTagData.startDate)}</span>\r\n            <button \r\n              className=\"date-btn\"\r\n              onClick={(e) => { \r\n                e.preventDefault();\r\n                e.stopPropagation(); \r\n                handleStartDateChange(editingTagData.startIndex + 1); \r\n              }}\r\n              disabled={editingTagData.startIndex >= chartData.length - 1}\r\n            >+</button>\r\n          </div>\r\n          \r\n          <span className=\"date-separator\">to</span>\r\n          \r\n          <div className=\"date-control\">\r\n            <button \r\n              className=\"date-btn\"\r\n              onClick={(e) => { \r\n                e.preventDefault();\r\n                e.stopPropagation(); \r\n                handleEndDateChange(editingTagData.endIndex - 1); \r\n              }}\r\n              disabled={editingTagData.endIndex <= 0}\r\n            >-</button>\r\n            <span className=\"date-value\">{formatShortDate(editingTagData.endDate)}</span>\r\n            <button \r\n              className=\"date-btn\"\r\n              onClick={(e) => { \r\n                e.preventDefault();\r\n                e.stopPropagation(); \r\n                handleEndDateChange(editingTagData.endIndex + 1); \r\n              }}\r\n              disabled={editingTagData.endIndex >= chartData.length - 1}\r\n            >+</button>\r\n          </div>\r\n          \r\n          <span className=\"day-count\">{dayCount}d</span>\r\n        </div>\r\n\r\n        <div className=\"edit-actions-row\" onClick={handlePopoverClick} onMouseDown={handlePopoverClick}>\r\n          {!isSpan ? (\r\n            <button \r\n              className=\"action-btn secondary\"\r\n              onClick={(e) => handleConvertToSpan(e)}\r\n            >\r\n              Make Span\r\n            </button>\r\n          ) : (\r\n            <button \r\n              className=\"action-btn secondary\"\r\n              onClick={(e) => handleConvertToPoint(e)}\r\n            >\r\n              Single Day\r\n            </button>\r\n          )}\r\n          <button \r\n            className=\"action-btn danger\"\r\n            onClick={(e) => handleRemoveTag(tag.id, e)}\r\n          >\r\n            Delete\r\n          </button>\r\n          <button \r\n            className=\"action-btn primary\"\r\n            onClick={(e) => { \r\n              e.preventDefault();\r\n              e.stopPropagation(); \r\n              handleSaveTagEdit(); \r\n            }}\r\n          >\r\n            Save\r\n          </button>\r\n        </div>\r\n      </div>\r\n    );\r\n  };\r\n\r\n  const renderSingleSpan = (ev, isPinned = false, isManualSpan = false) => {\r\n    const currentWidth = containerWidth || (chartContainerRef.current?.offsetWidth || 0);\r\n    if (currentWidth === 0) return null;\r\n\r\n    const chartAreaLeft = Y_AXIS_WIDTH + CHART_MARGINS.left;\r\n    const chartAreaWidth = currentWidth - chartAreaLeft - CHART_MARGINS.right;\r\n\r\n    let evStart, evEnd;\r\n    \r\n    if (isManualSpan) {\r\n      evStart = new Date(ev.startDate + 'T00:00:00');\r\n      evEnd = new Date(ev.endDate + 'T00:00:00');\r\n    } else {\r\n      evStart = isPinned ? new Date(ev.adjustedStart) : ev.adjustedStart;\r\n      evEnd = isPinned ? new Date(ev.adjustedEnd) : ev.adjustedEnd;\r\n    }\r\n\r\n    const startIdx = isManualSpan ? ev.startIndex : getIndexForDate(evStart);\r\n    const endIdx = isManualSpan ? ev.endIndex : getIndexForDate(evEnd);\r\n\r\n    const clampedStart = Math.max(0, startIdx);\r\n    const clampedEnd = Math.min(chartData.length - 1, endIdx);\r\n\r\n    const startPct = chartData.length === 1 ? 0.5 : clampedStart / (chartData.length - 1);\r\n    const endPct = chartData.length === 1 ? 0.5 : clampedEnd / (chartData.length - 1);\r\n\r\n    const leftPx = chartAreaLeft + startPct * chartAreaWidth;\r\n    const rightPx = chartAreaLeft + endPct * chartAreaWidth;\r\n    const widthPx = Math.max(rightPx - leftPx, 4);\r\n    const centerPx = leftPx + widthPx / 2;\r\n\r\n    const fillColor = hexToRgba(ev.color, 0.12);\r\n    const borderColor = hexToRgba(ev.color, 0.5);\r\n\r\n    const isBeingEdited = editingTagId === ev.id;\r\n    const spanLabel = ev.name || ev.label;\r\n    const yearLabel = ev.yearLabel || (displayMode === 'ly' ? 'LY' : 'TY');\r\n\r\n    const handleSpanClick = (e) => {\r\n      e.preventDefault();\r\n      e.stopPropagation();\r\n    };\r\n\r\n    return (\r\n      <div\r\n        key={ev.id}\r\n        className={`event-span ${isPinned || isManualSpan ? 'pinned' : ''} ${isBeingEdited ? 'editing' : ''}`}\r\n        style={{\r\n          left: `${leftPx}px`,\r\n          width: `${widthPx}px`,\r\n          background: fillColor,\r\n          borderLeft: `2px solid ${borderColor}`,\r\n          borderRight: `2px solid ${borderColor}`,\r\n        }}\r\n      >\r\n        <div\r\n          className=\"event-span-label\"\r\n          style={{ left: `${centerPx - leftPx}px`, background: ev.color }}\r\n          onClick={(e) => {\r\n            e.preventDefault();\r\n            e.stopPropagation();\r\n            if (isManualSpan) {\r\n              if (editingTagId !== ev.id) {\r\n                openTagEditor(ev.id, ev);\r\n              }\r\n            } else if (!isPinned) {\r\n              setEditingEvent(editingEvent?.id === ev.id ? null : ev);\r\n            }\r\n          }}\r\n          onMouseDown={handleSpanClick}\r\n        >\r\n          <span className=\"event-span-label-text\">\r\n            {spanLabel} ({yearLabel})\r\n          </span>\r\n          <button\r\n            className=\"event-span-dismiss\"\r\n            onClick={(e) => { \r\n              e.preventDefault();\r\n              e.stopPropagation(); \r\n              if (isPinned || isManualSpan) {\r\n                handleRemoveTag(ev.id, e);\r\n              } else {\r\n                handleDismissEvent(ev.id);\r\n              }\r\n            }}\r\n            title={isPinned || isManualSpan ? \"Remove\" : \"Dismiss\"}\r\n          >\r\n            x\r\n          </button>\r\n        </div>\r\n\r\n        {isManualSpan && isBeingEdited && renderCompactEditPopover(ev, true)}\r\n\r\n        {!isPinned && !isManualSpan && editingEvent?.id === ev.id && (\r\n          <div\r\n            className=\"event-span-edit\"\r\n            style={{ left: `${centerPx - leftPx}px` }}\r\n            onClick={handleSpanClick}\r\n            onMouseDown={handleSpanClick}\r\n            onMouseMove={handleSpanClick}\r\n            onMouseEnter={handleSpanClick}\r\n          >\r\n            <div className=\"event-span-edit-header\">\r\n              <strong>{ev.label}</strong>\r\n              <button \r\n                className=\"event-span-edit-close\" \r\n                onClick={(e) => { \r\n                  e.preventDefault();\r\n                  e.stopPropagation();\r\n                  setEditingEvent(null); \r\n                }}\r\n              >\r\n                x\r\n              </button>\r\n            </div>\r\n            <p className=\"event-span-edit-dates\">\r\n              {new Date(ev.adjustedStart).toLocaleDateString('en-US', { month: 'short', day: 'numeric' })}\r\n              {' - '}\r\n              {new Date(ev.adjustedEnd).toLocaleDateString('en-US', { month: 'short', day: 'numeric' })}\r\n            </p>\r\n            <p className=\"event-span-edit-tier\">\r\n              {ev.tier ? 'Tier 1 Event' : 'Tracked Event'}\r\n            </p>\r\n            <button\r\n              className=\"event-span-pin-btn\"\r\n              onClick={(e) => {\r\n                e.preventDefault();\r\n                e.stopPropagation();\r\n                if (onTagsChange) {\r\n                  onTagsChange([...(chartTags || []), {\r\n                    id: `pinned-${ev.id}-${Date.now()}`,\r\n                    name: ev.label,\r\n                    color: ev.color,\r\n                    sourceEventId: ev.id,\r\n                    isSpan: true,\r\n                    startDate: ev.startDate,\r\n                    endDate: ev.endDate,\r\n                    adjustedStart: ev.adjustedStart.toISOString(),\r\n                    adjustedEnd: ev.adjustedEnd.toISOString(),\r\n                    yearLabel: ev.yearLabel,\r\n                    tier: ev.tier,\r\n                    source: 'suggested'\r\n                  }]);\r\n                }\r\n                setEditingEvent(null);\r\n              }}\r\n            >\r\n              Pin to chart\r\n            </button>\r\n          </div>\r\n        )}\r\n      </div>\r\n    );\r\n  };\r\n\r\n  const getPinnedSpans = useCallback(() => {\r\n    if (!chartTags || !chartData || chartData.length === 0) return [];\r\n\r\n    const chartStartDate = chartData[0]?.date;\r\n    const chartEndDate = chartData[chartData.length - 1]?.date;\r\n    if (!chartStartDate || !chartEndDate) return [];\r\n\r\n    const chartStart = new Date(chartStartDate + 'T00:00:00');\r\n    const chartEnd = new Date(chartEndDate + 'T00:00:00');\r\n\r\n    return chartTags\r\n      .filter(tag => tag.isSpan && !tag.isManual)\r\n      .filter(tag => {\r\n        const tagStart = new Date(tag.adjustedStart);\r\n        const tagEnd = new Date(tag.adjustedEnd);\r\n        return tagStart <= chartEnd && tagEnd >= chartStart;\r\n      });\r\n  }, [chartTags, chartData]);\r\n\r\n  const getManualSpans = useCallback(() => {\r\n    if (!chartTags || !chartData || chartData.length === 0) return [];\r\n    return chartTags.filter(tag => tag.isSpan && tag.isManual);\r\n  }, [chartTags, chartData]);\r\n\r\n  const renderEventSpans = () => {\r\n    const currentWidth = containerWidth || (chartContainerRef.current?.offsetWidth || 0);\r\n    if (currentWidth === 0) return null;\r\n\r\n    const pinnedSpans = getPinnedSpans();\r\n    const manualSpans = getManualSpans();\r\n    const suggestedEvents = showSuggestedEvents ? getFilteredEvents() : [];\r\n\r\n    if (pinnedSpans.length === 0 && suggestedEvents.length === 0 && manualSpans.length === 0) return null;\r\n\r\n    return (\r\n      <>\r\n        {pinnedSpans.map(span => renderSingleSpan(span, true, false))}\r\n        {manualSpans.map(span => renderSingleSpan(span, false, true))}\r\n        {suggestedEvents.map(ev => renderSingleSpan(ev, false, false))}\r\n      </>\r\n    );\r\n  };\r\n\r\n  const commonProps = {\r\n    data: chartData,\r\n    margin: CHART_MARGINS\r\n  };\r\n\r\n  const axisStyle = {\r\n    fontSize: 11,\r\n    fill: '#86868b',\r\n    fontWeight: 500\r\n  };\r\n\r\n  const calculateTickInterval = () => {\r\n    if (!chartData || chartData.length <= 1) return 0;\r\n    const dataPoints = chartData.length;\r\n    const targetTicks = 7;\r\n    const interval = Math.max(0, Math.floor((dataPoints - 1) / (targetTicks - 1)) - 1);\r\n    return interval;\r\n  };\r\n\r\n  const tickInterval = calculateTickInterval();\r\n\r\n  const tyDataKey = hasComparison ? `${kpi}_ty` : kpi;\r\n  const lyDataKey = hasComparison ? `${kpi}_ly` : null;\r\n\r\n  const showTY = displayMode === 'both' || displayMode === 'ty';\r\n  const showLY = displayMode === 'both' || displayMode === 'ly';\r\n\r\n  const renderPlacedTags = () => {\r\n    if (!chartTags || chartTags.length === 0 || !chartData || chartData.length === 0) return null;\r\n\r\n    const pointTags = chartTags.filter(t => !t.isSpan);\r\n    if (pointTags.length === 0) return null;\r\n\r\n    const currentWidth = containerWidth || (chartContainerRef.current?.offsetWidth || 0);\r\n    if (currentWidth === 0) return null;\r\n\r\n    const poleHeight = CHART_HEIGHT - CHART_MARGINS.bottom - 40;\r\n\r\n    return pointTags.map((tag) => {\r\n      let dateIndex = tag.dateIndex;\r\n      if (dateIndex === undefined || dateIndex < 0 || dateIndex >= chartData.length) {\r\n        dateIndex = chartData.findIndex(d => d.date === tag.date);\r\n      }\r\n\r\n      if (dateIndex === -1 || dateIndex >= chartData.length) return null;\r\n\r\n      const xPos = getXPositionForIndex(dateIndex);\r\n      if (xPos === 0 && dateIndex !== 0) return null;\r\n\r\n      const isEditing = editingTagId === tag.id;\r\n\r\n      return (\r\n        <div\r\n          key={tag.id}\r\n          className={`placed-tag-container ${isEditing ? 'editing' : ''}`}\r\n          style={{ left: `${xPos}px` }}\r\n        >\r\n          <div\r\n            className=\"tag-label clickable\"\r\n            style={{ background: tag.color }}\r\n            onClick={(e) => handleTagLabelClick(e, tag.id, tag)}\r\n            onMouseDown={(e) => { e.preventDefault(); e.stopPropagation(); }}\r\n          >\r\n            <span className=\"tag-label-text\">{tag.name}</span>\r\n            <button\r\n              className=\"tag-label-remove\"\r\n              onClick={(e) => handleRemoveTag(tag.id, e)}\r\n              title=\"Remove tag\"\r\n            >\r\n              x\r\n            </button>\r\n          </div>\r\n\r\n          {isEditing && renderCompactEditPopover(tag, false)}\r\n\r\n          <div\r\n            className=\"tag-pole\"\r\n            style={{\r\n              background: tag.color,\r\n              height: poleHeight\r\n            }}\r\n          ></div>\r\n          <div className=\"tag-date\" style={{ color: tag.color }}>\r\n            {formatAxisDate(tag.date)}\r\n          </div>\r\n        </div>\r\n      );\r\n    });\r\n  };\r\n\r\n  const renderDragPreview = () => {\r\n    if (!dragPreview || dragPreview.x === 0) return null;\r\n\r\n    const poleHeight = CHART_HEIGHT - CHART_MARGINS.bottom - 40;\r\n\r\n    return (\r\n      <div\r\n        className=\"drag-preview-container\"\r\n        style={{ left: `${dragPreview.x}px` }}\r\n      >\r\n        <div className=\"tag-label preview\" style={{ background: dragPreview.tag.color }}>\r\n          <span className=\"tag-label-text\">{dragPreview.tag.name}</span>\r\n        </div>\r\n        <div\r\n          className=\"tag-pole preview\"\r\n          style={{\r\n            borderColor: dragPreview.tag.color,\r\n            height: poleHeight\r\n          }}\r\n        ></div>\r\n        <div className=\"tag-date preview\" style={{ color: dragPreview.tag.color }}>\r\n          {dragPreview.formattedDate}\r\n        </div>\r\n      </div>\r\n    );\r\n  };\r\n\r\n  const renderChart = () => {\r\n    switch (chartType) {\r\n      case 'area':\r\n        return (\r\n          <AreaChart {...commonProps}>\r\n            <defs>\r\n              <linearGradient id=\"areaGradientTY\" x1=\"0\" y1=\"0\" x2=\"0\" y2=\"1\">\r\n                <stop offset=\"0%\" stopColor=\"#F96302\" stopOpacity={0.25}/>\r\n                <stop offset=\"100%\" stopColor=\"#F96302\" stopOpacity={0}/>\r\n              </linearGradient>\r\n              <linearGradient id=\"areaGradientLY\" x1=\"0\" y1=\"0\" x2=\"0\" y2=\"1\">\r\n                <stop offset=\"0%\" stopColor=\"#86868b\" stopOpacity={0.15}/>\r\n                <stop offset=\"100%\" stopColor=\"#86868b\" stopOpacity={0}/>\r\n              </linearGradient>\r\n            </defs>\r\n            <CartesianGrid strokeDasharray=\"3 3\" stroke=\"rgba(0,0,0,0.04)\" vertical={false} />\r\n            <XAxis\r\n              dataKey=\"displayDate\"\r\n              tick={axisStyle}\r\n              tickLine={false}\r\n              axisLine={{ stroke: 'rgba(0,0,0,0.08)' }}\r\n              tickFormatter={formatAxisDate}\r\n              interval={tickInterval}\r\n            />\r\n            <YAxis\r\n              tick={axisStyle}\r\n              tickLine={false}\r\n              axisLine={false}\r\n              tickFormatter={formatValue}\r\n              width={Y_AXIS_WIDTH}\r\n            />\r\n            <Tooltip content={<CustomTooltip />} />\r\n            {hasComparison && <Legend />}\r\n            {launchDate && showTY && (\r\n              <ReferenceLine\r\n                x={launchDate}\r\n                stroke=\"#F96302\"\r\n                strokeDasharray=\"4 4\"\r\n                strokeWidth={2}\r\n                label={{\r\n                  value: 'Launch',\r\n                  position: 'top',\r\n                  fill: '#F96302',\r\n                  fontSize: 11,\r\n                  fontWeight: 600\r\n                }}\r\n              />\r\n            )}\r\n            {hasComparison && lyDataKey && showLY && (\r\n              <Area\r\n                type=\"monotone\"\r\n                dataKey={lyDataKey}\r\n                name=\"Last Year\"\r\n                stroke=\"#86868b\"\r\n                strokeWidth={1.5}\r\n                strokeDasharray=\"4 4\"\r\n                fill=\"url(#areaGradientLY)\"\r\n                dot={false}\r\n                activeDot={{ r: 4, fill: '#86868b', stroke: '#fff', strokeWidth: 2 }}\r\n              />\r\n            )}\r\n            {showTY && (\r\n              <Area\r\n                type=\"monotone\"\r\n                dataKey={tyDataKey}\r\n                name={hasComparison ? \"This Year\" : kpi}\r\n                stroke=\"#F96302\"\r\n                strokeWidth={2}\r\n                fill=\"url(#areaGradientTY)\"\r\n                dot={false}\r\n                activeDot={{ r: 5, fill: '#F96302', stroke: '#fff', strokeWidth: 2 }}\r\n              />\r\n            )}\r\n          </AreaChart>\r\n        );\r\n\r\n      case 'bar':\r\n        return (\r\n          <BarChart {...commonProps}>\r\n            <CartesianGrid strokeDasharray=\"3 3\" stroke=\"rgba(0,0,0,0.04)\" vertical={false} />\r\n            <XAxis\r\n              dataKey=\"displayDate\"\r\n              tick={axisStyle}\r\n              tickLine={false}\r\n              axisLine={{ stroke: 'rgba(0,0,0,0.08)' }}\r\n              tickFormatter={formatAxisDate}\r\n              interval={tickInterval}\r\n            />\r\n            <YAxis\r\n              tick={axisStyle}\r\n              tickLine={false}\r\n              axisLine={false}\r\n              tickFormatter={formatValue}\r\n              width={Y_AXIS_WIDTH}\r\n            />\r\n            <Tooltip content={<CustomTooltip />} />\r\n            {hasComparison && <Legend />}\r\n            {launchDate && showTY && (\r\n              <ReferenceLine\r\n                x={launchDate}\r\n                stroke=\"#F96302\"\r\n                strokeDasharray=\"4 4\"\r\n                strokeWidth={2}\r\n              />\r\n            )}\r\n            {hasComparison && lyDataKey && showLY && (\r\n              <Bar\r\n                dataKey={lyDataKey}\r\n                name=\"Last Year\"\r\n                fill=\"#d1d1d6\"\r\n                radius={[4, 4, 0, 0]}\r\n                maxBarSize={20}\r\n              />\r\n            )}\r\n            {showTY && (\r\n              <Bar\r\n                dataKey={tyDataKey}\r\n                name={hasComparison ? \"This Year\" : kpi}\r\n                fill=\"#F96302\"\r\n                radius={[4, 4, 0, 0]}\r\n                maxBarSize={hasComparison ? 20 : 40}\r\n              />\r\n            )}\r\n          </BarChart>\r\n        );\r\n\r\n      default:\r\n        return (\r\n          <LineChart {...commonProps}>\r\n            <CartesianGrid strokeDasharray=\"3 3\" stroke=\"rgba(0,0,0,0.04)\" vertical={false} />\r\n            <XAxis\r\n              dataKey=\"displayDate\"\r\n              tick={axisStyle}\r\n              tickLine={false}\r\n              axisLine={{ stroke: 'rgba(0,0,0,0.08)' }}\r\n              tickFormatter={formatAxisDate}\r\n              interval={tickInterval}\r\n            />\r\n            <YAxis\r\n              tick={axisStyle}\r\n              tickLine={false}\r\n              axisLine={false}\r\n              tickFormatter={formatValue}\r\n              width={Y_AXIS_WIDTH}\r\n            />\r\n            <Tooltip content={<CustomTooltip />} />\r\n            {hasComparison && <Legend />}\r\n            {launchDate && showTY && (\r\n              <ReferenceLine\r\n                x={launchDate}\r\n                stroke=\"#F96302\"\r\n                strokeDasharray=\"4 4\"\r\n                strokeWidth={2}\r\n                label={{\r\n                  value: 'Launch',\r\n                  position: 'top',\r\n                  fill: '#F96302',\r\n                  fontSize: 11,\r\n                  fontWeight: 600\r\n                }}\r\n              />\r\n            )}\r\n            {hasComparison && lyDataKey && showLY && (\r\n              <Line\r\n                type=\"monotone\"\r\n                dataKey={lyDataKey}\r\n                name=\"Last Year\"\r\n                stroke=\"#86868b\"\r\n                strokeWidth={1.5}\r\n                strokeDasharray=\"4 4\"\r\n                dot={false}\r\n                activeDot={{ r: 4, fill: '#86868b', stroke: '#fff', strokeWidth: 2 }}\r\n              />\r\n            )}\r\n            {showTY && (\r\n              <Line\r\n                type=\"monotone\"\r\n                dataKey={tyDataKey}\r\n                name={hasComparison ? \"This Year\" : kpi}\r\n                stroke=\"#F96302\"\r\n                strokeWidth={2}\r\n                dot={false}\r\n                activeDot={{ r: 5, fill: '#F96302', stroke: '#fff', strokeWidth: 2 }}\r\n              />\r\n            )}\r\n          </LineChart>\r\n        );\r\n    }\r\n  };\r\n\r\n  if (!chartData || chartData.length === 0) {\r\n    return (\r\n      <div className=\"chart-empty\">\r\n        <p>No data available for the selected period</p>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  if (isBeta) {\r\n    return (\r\n      <div className=\"kpi-chart beta-restricted\">\r\n        <div className=\"chart-blur-wrapper\">\r\n          <ResponsiveContainer width=\"100%\" height={320}>\r\n            {renderChart()}\r\n          </ResponsiveContainer>\r\n        </div>\r\n        <div className=\"beta-overlay\">\r\n          <div className=\"beta-overlay-content\">\r\n            <h3>Place holder</h3>\r\n            <p>Chart visualization</p>\r\n          </div>\r\n        </div>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  const isEditingActive = editingTagId || editingEvent;\r\n\r\n  return (\r\n    <div className=\"kpi-chart-wrapper\">\r\n      <div\r\n        className={`kpi-chart ${draggedTag ? 'drop-active' : ''} ${isEditingActive ? 'editing-active' : ''}`}\r\n        ref={chartContainerRef}\r\n        onDragOver={handleDragOver}\r\n        onDragLeave={handleDragLeave}\r\n        onDrop={handleDrop}\r\n      >\r\n        <div className=\"tag-area\">\r\n          {renderPlacedTags()}\r\n          {dragPreview && renderDragPreview()}\r\n        </div>\r\n\r\n        <div\r\n          className={`event-spans-layer ${isEditingActive ? 'has-editing' : ''}`}\r\n          style={{ height: `${PLOT_AREA_HEIGHT}px` }}\r\n        >\r\n          {renderEventSpans()}\r\n        </div>\r\n\r\n        {isEditingActive && (\r\n          <div\r\n            className=\"chart-interaction-blocker\"\r\n            onClick={(e) => { e.stopPropagation(); }}\r\n            onMouseMove={(e) => { e.stopPropagation(); }}\r\n          />\r\n        )}\r\n\r\n        <ResponsiveContainer width=\"100%\" height={320}>\r\n          {renderChart()}\r\n        </ResponsiveContainer>\r\n      </div>\r\n\r\n      <div className=\"chart-tag-controls\">\r\n        <button\r\n          className={`tag-panel-toggle ${showTagPanel ? 'active' : ''}`}\r\n          onClick={() => setShowTagPanel(!showTagPanel)}\r\n        >\r\n          <svg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" strokeWidth=\"2\" strokeLinecap=\"round\" strokeLinejoin=\"round\">\r\n            <path d=\"M20.59 13.41l-7.17 7.17a2 2 0 0 1-2.83 0L2 12V2h10l8.59 8.59a2 2 0 0 1 0 2.82z\"></path>\r\n            <line x1=\"7\" y1=\"7\" x2=\"7.01\" y2=\"7\"></line>\r\n          </svg>\r\n          <span>Add Tag</span>\r\n        </button>\r\n\r\n        {chartTags && chartTags.length > 0 && (() => {\r\n          const pinnedEvents = chartTags.filter(tag => tag.source === 'suggested');\r\n          const manualTags = chartTags.filter(tag => tag.source !== 'suggested');\r\n\r\n          const renderPill = (tag) => (\r\n            <span\r\n              key={tag.id}\r\n              className={`active-tag-pill ${editingTagId === tag.id ? 'editing' : ''}`}\r\n              style={{ '--tag-color': tag.color }}\r\n              onClick={(e) => {\r\n                e.preventDefault();\r\n                e.stopPropagation();\r\n                openTagEditor(tag.id, tag);\r\n              }}\r\n            >\r\n              <span className=\"pill-dot\" style={{ background: tag.color }}></span>\r\n              <span className=\"pill-name\">{tag.name}</span>\r\n              {tag.isSpan && (\r\n                <span className=\"pill-range\">\r\n                  {formatShortDate(tag.startDate)}-{formatShortDate(tag.endDate)}\r\n                </span>\r\n              )}\r\n              {!tag.isSpan && (\r\n                <span className=\"pill-date\">{formatShortDate(tag.date)}</span>\r\n              )}\r\n              <button\r\n                className=\"pill-remove\"\r\n                onClick={(e) => handleRemoveTag(tag.id, e)}\r\n              >\r\n                <svg width=\"10\" height=\"10\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" strokeWidth=\"3\">\r\n                  <line x1=\"18\" y1=\"6\" x2=\"6\" y2=\"18\"></line>\r\n                  <line x1=\"6\" y1=\"6\" x2=\"18\" y2=\"18\"></line>\r\n                </svg>\r\n              </button>\r\n            </span>\r\n          );\r\n\r\n          return (\r\n            <div className=\"active-tags-list\">\r\n              {pinnedEvents.length > 0 && (\r\n                <>\r\n                  <span className=\"tags-section-label pinned\">Pinned</span>\r\n                  {pinnedEvents.map(renderPill)}\r\n                </>\r\n              )}\r\n              {pinnedEvents.length > 0 && manualTags.length > 0 && (\r\n                <span className=\"tags-separator\"></span>\r\n              )}\r\n              {manualTags.length > 0 && (\r\n                <>\r\n                  <span className=\"tags-section-label manual\">Manual</span>\r\n                  {manualTags.map(renderPill)}\r\n                </>\r\n              )}\r\n            </div>\r\n          );\r\n        })()}\r\n      </div>\r\n\r\n      {showTagPanel && (\r\n        <div className=\"tag-panel\">\r\n          <div className=\"tag-panel-header\">\r\n            <h4>Add Event Tag</h4>\r\n            <button className=\"tag-panel-close\" onClick={() => setShowTagPanel(false)}>\r\n              <svg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" strokeWidth=\"2\">\r\n                <line x1=\"18\" y1=\"6\" x2=\"6\" y2=\"18\"></line>\r\n                <line x1=\"6\" y1=\"6\" x2=\"18\" y2=\"18\"></line>\r\n              </svg>\r\n            </button>\r\n          </div>\r\n\r\n          <p className=\"tag-panel-hint\">\r\n            Drag a tag onto the chart. Click to edit dates and convert to a span.\r\n          </p>\r\n\r\n          {dismissedEvents.length > 0 && (\r\n            <button className=\"reset-dismissed-btn\" onClick={handleResetDismissed}>\r\n              Restore {dismissedEvents.length} dismissed\r\n            </button>\r\n          )}\r\n\r\n          <div className=\"preset-tags\">\r\n            {PRESET_TAGS.map(tag => (\r\n              <div\r\n                key={tag.id}\r\n                className=\"draggable-tag\"\r\n                draggable\r\n                onDragStart={(e) => handleDragStart(e, tag)}\r\n                onDragEnd={handleDragEnd}\r\n                style={{ borderColor: tag.color }}\r\n              >\r\n                <span className=\"tag-marker\" style={{ background: tag.color }}></span>\r\n                {tag.name}\r\n              </div>\r\n            ))}\r\n          </div>\r\n\r\n          <div className=\"custom-tag-section\">\r\n            {!showCustomForm ? (\r\n              <button\r\n                className=\"add-custom-tag-btn\"\r\n                onClick={() => setShowCustomForm(true)}\r\n              >\r\n                <svg width=\"14\" height=\"14\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" strokeWidth=\"2\">\r\n                  <line x1=\"12\" y1=\"5\" x2=\"12\" y2=\"19\"></line>\r\n                  <line x1=\"5\" y1=\"12\" x2=\"19\" y2=\"12\"></line>\r\n                </svg>\r\n                Custom Tag\r\n              </button>\r\n            ) : (\r\n              <div className=\"custom-tag-form\">\r\n                <div className=\"custom-form-row\">\r\n                  <input\r\n                    type=\"text\"\r\n                    placeholder=\"Tag name\"\r\n                    value={customTagName}\r\n                    onChange={(e) => setCustomTagName(e.target.value)}\r\n                    className=\"custom-tag-input\"\r\n                  />\r\n                  <input\r\n                    type=\"text\"\r\n                    placeholder=\"Owner\"\r\n                    value={customTagOwner}\r\n                    onChange={(e) => setCustomTagOwner(e.target.value)}\r\n                    className=\"custom-tag-input\"\r\n                  />\r\n                </div>\r\n                <input\r\n                  type=\"text\"\r\n                  placeholder=\"Description (optional)\"\r\n                  value={customTagDescription}\r\n                  onChange={(e) => setCustomTagDescription(e.target.value)}\r\n                  className=\"custom-tag-input full\"\r\n                />\r\n                <div className=\"custom-tag-actions\">\r\n                  <button\r\n                    className=\"custom-tag-cancel\"\r\n                    onClick={() => {\r\n                      setShowCustomForm(false);\r\n                      setCustomTagName('');\r\n                      setCustomTagOwner('');\r\n                      setCustomTagDescription('');\r\n                    }}\r\n                  >\r\n                    Cancel\r\n                  </button>\r\n                  <button\r\n                    className=\"custom-tag-create\"\r\n                    onClick={handleAddCustomTag}\r\n                    disabled={!customTagName.trim() || !customTagOwner.trim()}\r\n                  >\r\n                    Create\r\n                  </button>\r\n                </div>\r\n              </div>\r\n            )}\r\n          </div>\r\n\r\n          {draggedTag && draggedTag.isCustom && (\r\n            <div className=\"drag-instruction\">\r\n              <p>Drag \"{draggedTag.name}\" onto the chart:</p>\r\n              <div\r\n                className=\"draggable-tag custom\"\r\n                draggable\r\n                onDragStart={(e) => handleDragStart(e, draggedTag)}\r\n                onDragEnd={handleDragEnd}\r\n              >\r\n                <span className=\"tag-marker\" style={{ background: draggedTag.color }}></span>\r\n                {draggedTag.name}\r\n              </div>\r\n            </div>\r\n          )}\r\n        </div>\r\n      )}\r\n    </div>\r\n  );\r\n}\r\n\r\nexport default KPIChart;\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}