{"ast":null,"code":"var _jsxFileName = \"C:\\\\Users\\\\AkashPatil\\\\THD-Dashboard\\\\frontend\\\\src\\\\components\\\\KPIChart.js\",\n  _s = $RefreshSig$();\nimport { useState, useRef, useCallback, useEffect } from 'react';\nimport { LineChart, Line, AreaChart, Area, BarChart, Bar, XAxis, YAxis, CartesianGrid, Tooltip, ResponsiveContainer, ReferenceLine, Legend } from 'recharts';\nimport { useAuth } from '../context/AuthContext';\nimport './KPIChart.css';\nimport { jsxDEV as _jsxDEV, Fragment as _Fragment } from \"react/jsx-dev-runtime\";\nconst PRESET_TAGS = [{\n  id: 'thanksgiving',\n  name: 'Thanksgiving',\n  color: '#F96302'\n}, {\n  id: 'july4th',\n  name: '4th of July',\n  color: '#FF3B30'\n}, {\n  id: 'tier1',\n  name: 'Tier 1 Event',\n  color: '#5856D6'\n}, {\n  id: 'promo',\n  name: 'Promo',\n  color: '#34C759'\n}, {\n  id: 'outage',\n  name: 'Outage/Issue',\n  color: '#FF2D55'\n}];\nconst CHART_MARGINS = {\n  top: 20,\n  right: 20,\n  left: 10,\n  bottom: 20\n};\nconst Y_AXIS_WIDTH = 60;\nconst CHART_HEIGHT = 320;\nconst PLOT_AREA_HEIGHT = CHART_HEIGHT - CHART_MARGINS.top - CHART_MARGINS.bottom - 54;\nfunction hexToRgba(hex, alpha) {\n  const r = parseInt(hex.slice(1, 3), 16);\n  const g = parseInt(hex.slice(3, 5), 16);\n  const b = parseInt(hex.slice(5, 7), 16);\n  return `rgba(${r},${g},${b},${alpha})`;\n}\nfunction KPIChart({\n  data,\n  kpi,\n  chartType,\n  format,\n  launchDate,\n  comparisonData,\n  chartTags,\n  onTagsChange,\n  displayMode = 'both',\n  events = [],\n  showSuggestedEvents = false\n}) {\n  _s();\n  const {\n    isBetaMode\n  } = useAuth();\n  const isBeta = isBetaMode();\n  const chartContainerRef = useRef(null);\n  const [showTagPanel, setShowTagPanel] = useState(false);\n  const [customTagName, setCustomTagName] = useState('');\n  const [customTagOwner, setCustomTagOwner] = useState('');\n  const [customTagDescription, setCustomTagDescription] = useState('');\n  const [draggedTag, setDraggedTag] = useState(null);\n  const [showCustomForm, setShowCustomForm] = useState(false);\n  const [dragPreview, setDragPreview] = useState(null);\n  const [containerWidth, setContainerWidth] = useState(0);\n  const [editingTagId, setEditingTagId] = useState(null);\n  const [editingTagData, setEditingTagData] = useState(null);\n  const [dismissedEvents, setDismissedEvents] = useState(() => {\n    try {\n      const stored = sessionStorage.getItem('dismissedEvents');\n      return stored ? JSON.parse(stored) : [];\n    } catch {\n      return [];\n    }\n  });\n  const [editingEvent, setEditingEvent] = useState(null);\n  const rawChartData = comparisonData && comparisonData.length > 0 ? comparisonData : data;\n  const hasComparison = comparisonData && comparisonData.length > 0;\n  const chartData = (rawChartData === null || rawChartData === void 0 ? void 0 : rawChartData.map(d => ({\n    ...d,\n    displayDate: displayMode === 'ly' && d.date_ly ? d.date_ly : d.date\n  }))) || [];\n  useEffect(() => {\n    const updateWidth = () => {\n      if (chartContainerRef.current) {\n        const width = chartContainerRef.current.offsetWidth;\n        if (width > 0) {\n          setContainerWidth(width);\n        }\n      }\n    };\n    updateWidth();\n    const initialTimeout = setTimeout(updateWidth, 100);\n    const secondTimeout = setTimeout(updateWidth, 300);\n    window.addEventListener('resize', updateWidth);\n    const resizeObserver = new ResizeObserver(() => {\n      requestAnimationFrame(updateWidth);\n    });\n    if (chartContainerRef.current) {\n      resizeObserver.observe(chartContainerRef.current);\n    }\n    return () => {\n      clearTimeout(initialTimeout);\n      clearTimeout(secondTimeout);\n      window.removeEventListener('resize', updateWidth);\n      resizeObserver.disconnect();\n    };\n  }, []);\n  useEffect(() => {\n    if (chartTags && chartTags.length > 0 && chartContainerRef.current) {\n      const width = chartContainerRef.current.offsetWidth;\n      if (width > 0 && containerWidth !== width) {\n        setContainerWidth(width);\n      }\n    }\n  }, [chartTags, containerWidth]);\n  useEffect(() => {\n    if (!editingTagId && !editingEvent) return;\n    const handleClickOutside = e => {\n      const clickedElement = e.target;\n      const isInsidePopover = clickedElement.closest('.tag-edit-popover');\n      const isInsideEventEdit = clickedElement.closest('.event-span-edit');\n      const isTagLabel = clickedElement.closest('.tag-label');\n      const isSpanLabel = clickedElement.closest('.event-span-label');\n      const isActivePill = clickedElement.closest('.active-tag-pill');\n      const isButton = clickedElement.closest('button');\n      const isInput = clickedElement.closest('input');\n      if (isInsidePopover || isInsideEventEdit || isTagLabel || isSpanLabel || isActivePill || isButton || isInput) {\n        return;\n      }\n      setEditingTagId(null);\n      setEditingTagData(null);\n      setEditingEvent(null);\n    };\n    const timeoutId = setTimeout(() => {\n      document.addEventListener('click', handleClickOutside, true);\n    }, 50);\n    return () => {\n      clearTimeout(timeoutId);\n      document.removeEventListener('click', handleClickOutside, true);\n    };\n  }, [editingTagId, editingEvent]);\n  const formatValue = val => {\n    if (val === null || val === undefined || isNaN(val)) return '-';\n    if (format === 'currency') {\n      if (Math.abs(val) >= 1000000) {\n        return `$${(val / 1000000).toFixed(1)}M`;\n      }\n      if (Math.abs(val) >= 1000) {\n        return `$${(val / 1000).toFixed(0)}K`;\n      }\n      return `$${val.toFixed(2)}`;\n    }\n    if (format === 'percentage') {\n      return `${(val * 100).toFixed(2)}%`;\n    }\n    if (Math.abs(val) >= 1000000) {\n      return `${(val / 1000000).toFixed(1)}M`;\n    }\n    if (Math.abs(val) >= 1000) {\n      return `${(val / 1000).toFixed(0)}K`;\n    }\n    return val.toLocaleString();\n  };\n  const formatAxisDate = dateStr => {\n    const date = new Date(dateStr);\n    return date.toLocaleDateString('en-US', {\n      month: 'short',\n      day: 'numeric'\n    });\n  };\n  const formatFullDate = dateStr => {\n    const date = new Date(dateStr);\n    return date.toLocaleDateString('en-US', {\n      weekday: 'short',\n      month: 'short',\n      day: 'numeric',\n      year: 'numeric'\n    });\n  };\n  const formatShortDate = dateStr => {\n    if (!dateStr) return '-';\n    const date = new Date(dateStr);\n    return date.toLocaleDateString('en-US', {\n      month: 'short',\n      day: 'numeric'\n    });\n  };\n  const getContainerRect = useCallback(() => {\n    if (!chartContainerRef.current) return null;\n    return chartContainerRef.current.getBoundingClientRect();\n  }, []);\n  const getDateIndexFromX = useCallback(clientX => {\n    if (!chartData || chartData.length === 0) return -1;\n    const rect = getContainerRect();\n    if (!rect) return -1;\n    const chartAreaLeft = Y_AXIS_WIDTH + CHART_MARGINS.left;\n    const chartAreaWidth = rect.width - chartAreaLeft - CHART_MARGINS.right;\n    const relativeX = clientX - rect.left - chartAreaLeft;\n    const percentage = Math.max(0, Math.min(1, relativeX / chartAreaWidth));\n    const dataIndex = Math.round(percentage * (chartData.length - 1));\n    return Math.max(0, Math.min(dataIndex, chartData.length - 1));\n  }, [chartData, getContainerRect]);\n  const getXPositionForIndex = useCallback(index => {\n    var _chartContainerRef$cu;\n    if (!chartData || chartData.length === 0 || index < 0) return 0;\n    const width = containerWidth || ((_chartContainerRef$cu = chartContainerRef.current) === null || _chartContainerRef$cu === void 0 ? void 0 : _chartContainerRef$cu.offsetWidth) || 0;\n    if (width === 0) return 0;\n    const chartAreaLeft = Y_AXIS_WIDTH + CHART_MARGINS.left;\n    const chartAreaWidth = width - chartAreaLeft - CHART_MARGINS.right;\n    if (chartData.length === 1) {\n      return chartAreaLeft + chartAreaWidth / 2;\n    }\n    const percentage = index / (chartData.length - 1);\n    return chartAreaLeft + percentage * chartAreaWidth;\n  }, [chartData, containerWidth]);\n  const getDateFromIndex = useCallback(index => {\n    var _chartData$index;\n    if (!chartData || chartData.length === 0 || index < 0 || index >= chartData.length) return null;\n    return ((_chartData$index = chartData[index]) === null || _chartData$index === void 0 ? void 0 : _chartData$index.date) || null;\n  }, [chartData]);\n  const getIndexFromDate = useCallback(dateStr => {\n    if (!chartData || chartData.length === 0 || !dateStr) return -1;\n    return chartData.findIndex(d => d.date === dateStr);\n  }, [chartData]);\n  const CustomTooltip = ({\n    active,\n    payload,\n    label\n  }) => {\n    if (active && payload && payload.length) {\n      const dataPoint = chartData === null || chartData === void 0 ? void 0 : chartData.find(d => d.displayDate === label);\n      const formatDate = dateStr => new Date(dateStr).toLocaleDateString('en-US', {\n        weekday: 'short',\n        month: 'short',\n        day: 'numeric',\n        year: 'numeric'\n      });\n      const dateTag = chartTags === null || chartTags === void 0 ? void 0 : chartTags.find(t => t.date === label || t.date === (dataPoint === null || dataPoint === void 0 ? void 0 : dataPoint.date));\n      return /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"chart-tooltip\",\n        children: [displayMode === 'ly' ? /*#__PURE__*/_jsxDEV(\"p\", {\n          className: \"tooltip-date\",\n          children: formatDate((dataPoint === null || dataPoint === void 0 ? void 0 : dataPoint.date_ly) || label)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 241,\n          columnNumber: 13\n        }, this) : displayMode === 'both' && dataPoint !== null && dataPoint !== void 0 && dataPoint.date && dataPoint !== null && dataPoint !== void 0 && dataPoint.date_ly ? /*#__PURE__*/_jsxDEV(_Fragment, {\n          children: [/*#__PURE__*/_jsxDEV(\"p\", {\n            className: \"tooltip-date\",\n            children: [\"TY: \", formatDate(dataPoint.date)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 244,\n            columnNumber: 15\n          }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n            className: \"tooltip-date tooltip-date-ly\",\n            children: [\"LY: \", formatDate(dataPoint.date_ly)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 245,\n            columnNumber: 15\n          }, this)]\n        }, void 0, true) : /*#__PURE__*/_jsxDEV(\"p\", {\n          className: \"tooltip-date\",\n          children: formatDate((dataPoint === null || dataPoint === void 0 ? void 0 : dataPoint.date) || label)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 248,\n          columnNumber: 13\n        }, this), dateTag && /*#__PURE__*/_jsxDEV(\"p\", {\n          className: \"tooltip-tag\",\n          children: [/*#__PURE__*/_jsxDEV(\"span\", {\n            className: \"tooltip-tag-marker\",\n            style: {\n              background: dateTag.color\n            }\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 252,\n            columnNumber: 15\n          }, this), dateTag.name]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 251,\n          columnNumber: 13\n        }, this), payload.map((entry, index) => /*#__PURE__*/_jsxDEV(\"p\", {\n          className: \"tooltip-value\",\n          style: {\n            color: entry.color\n          },\n          children: [/*#__PURE__*/_jsxDEV(\"span\", {\n            className: \"tooltip-label\",\n            children: [entry.name, \": \"]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 258,\n            columnNumber: 15\n          }, this), formatValue(entry.value)]\n        }, index, true, {\n          fileName: _jsxFileName,\n          lineNumber: 257,\n          columnNumber: 13\n        }, this))]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 239,\n        columnNumber: 9\n      }, this);\n    }\n    return null;\n  };\n  const handleDragStart = (e, tag) => {\n    const tagForDrag = {\n      ...tag,\n      id: tag.id.startsWith('custom-') ? tag.id : tag.id\n    };\n    setDraggedTag(tagForDrag);\n    e.dataTransfer.effectAllowed = 'copy';\n    const img = new Image();\n    img.src = 'data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7';\n    e.dataTransfer.setDragImage(img, 0, 0);\n  };\n  const handleDragOver = e => {\n    var _chartData$dateIndex;\n    e.preventDefault();\n    e.dataTransfer.dropEffect = 'copy';\n    if (!draggedTag || !chartData || chartData.length === 0) return;\n    const rect = getContainerRect();\n    if (!rect) return;\n    const dateIndex = getDateIndexFromX(e.clientX);\n    const targetDate = (_chartData$dateIndex = chartData[dateIndex]) === null || _chartData$dateIndex === void 0 ? void 0 : _chartData$dateIndex.date;\n    const xPosition = getXPositionForIndex(dateIndex);\n    if (targetDate && dateIndex >= 0) {\n      setDragPreview({\n        date: targetDate,\n        formattedDate: formatFullDate(targetDate),\n        x: xPosition,\n        index: dateIndex,\n        tag: draggedTag\n      });\n    }\n  };\n  const handleDragLeave = e => {\n    var _chartContainerRef$cu2;\n    const rect = (_chartContainerRef$cu2 = chartContainerRef.current) === null || _chartContainerRef$cu2 === void 0 ? void 0 : _chartContainerRef$cu2.getBoundingClientRect();\n    if (rect) {\n      const {\n        clientX,\n        clientY\n      } = e;\n      if (clientX < rect.left || clientX > rect.right || clientY < rect.top || clientY > rect.bottom) {\n        setDragPreview(null);\n      }\n    }\n  };\n  const handleDrop = e => {\n    var _chartData$dateIndex2;\n    e.preventDefault();\n    if (!draggedTag || !chartData || chartData.length === 0) return;\n    const dateIndex = getDateIndexFromX(e.clientX);\n    const targetDate = (_chartData$dateIndex2 = chartData[dateIndex]) === null || _chartData$dateIndex2 === void 0 ? void 0 : _chartData$dateIndex2.date;\n    if (targetDate) {\n      const uniqueId = `${draggedTag.id}-${Date.now()}-${Math.random().toString(36).substr(2, 9)}`;\n      const newTag = {\n        ...draggedTag,\n        id: uniqueId,\n        date: targetDate,\n        startDate: targetDate,\n        endDate: targetDate,\n        dateIndex: dateIndex,\n        startIndex: dateIndex,\n        endIndex: dateIndex,\n        isSpan: false,\n        isManual: true,\n        createdAt: new Date().toISOString()\n      };\n      if (onTagsChange) {\n        onTagsChange([...(chartTags || []), newTag]);\n      }\n      setTimeout(() => {\n        setEditingTagId(uniqueId);\n        setEditingTagData({\n          name: newTag.name,\n          owner: newTag.owner || '',\n          description: newTag.description || '',\n          startDate: targetDate,\n          endDate: targetDate,\n          startIndex: dateIndex,\n          endIndex: dateIndex\n        });\n      }, 50);\n    }\n    setDraggedTag(null);\n    setDragPreview(null);\n  };\n  const handleDragEnd = () => {\n    setDragPreview(null);\n    setDraggedTag(null);\n  };\n  const handleAddCustomTag = () => {\n    if (!customTagName.trim() || !customTagOwner.trim()) return;\n    const newTag = {\n      id: `custom-${Date.now()}`,\n      name: customTagName.trim(),\n      owner: customTagOwner.trim(),\n      description: customTagDescription.trim() || '',\n      color: '#6e6e73',\n      isCustom: true\n    };\n    setDraggedTag(newTag);\n    setCustomTagName('');\n    setCustomTagOwner('');\n    setCustomTagDescription('');\n    setShowCustomForm(false);\n  };\n  const openTagEditor = useCallback((tagId, tag) => {\n    const tagIndex = tag.startIndex !== undefined ? tag.startIndex : tag.dateIndex !== undefined ? tag.dateIndex : getIndexFromDate(tag.date);\n    const endIndex = tag.endIndex !== undefined ? tag.endIndex : tagIndex;\n    setEditingTagId(tagId);\n    setEditingTagData({\n      name: tag.name || '',\n      owner: tag.owner || '',\n      description: tag.description || '',\n      startDate: tag.startDate || tag.date,\n      endDate: tag.endDate || tag.date,\n      startIndex: tagIndex,\n      endIndex: endIndex\n    });\n  }, [getIndexFromDate]);\n  const closeTagEditor = useCallback(() => {\n    setEditingTagId(null);\n    setEditingTagData(null);\n  }, []);\n  const handleTagLabelClick = useCallback((e, tagId, tag) => {\n    e.preventDefault();\n    e.stopPropagation();\n    if (editingTagId === tagId) {\n      return;\n    }\n    openTagEditor(tagId, tag);\n  }, [editingTagId, openTagEditor]);\n  const handleEditingDataChange = useCallback((field, value) => {\n    setEditingTagData(prev => prev ? {\n      ...prev,\n      [field]: value\n    } : null);\n  }, []);\n  const handleStartDateChange = useCallback(newIndex => {\n    if (!editingTagData || newIndex < 0 || newIndex >= chartData.length) return;\n    const newStartDate = getDateFromIndex(newIndex);\n    if (!newStartDate) return;\n    let endIndex = editingTagData.endIndex;\n    if (newIndex > endIndex) {\n      endIndex = newIndex;\n    }\n    setEditingTagData(prev => prev ? {\n      ...prev,\n      startDate: newStartDate,\n      startIndex: newIndex,\n      endDate: getDateFromIndex(endIndex) || prev.endDate,\n      endIndex: endIndex\n    } : null);\n  }, [editingTagData, chartData.length, getDateFromIndex]);\n  const handleEndDateChange = useCallback(newIndex => {\n    if (!editingTagData || newIndex < 0 || newIndex >= chartData.length) return;\n    const newEndDate = getDateFromIndex(newIndex);\n    if (!newEndDate) return;\n    let startIndex = editingTagData.startIndex;\n    if (newIndex < startIndex) {\n      startIndex = newIndex;\n    }\n    setEditingTagData(prev => prev ? {\n      ...prev,\n      endDate: newEndDate,\n      endIndex: newIndex,\n      startDate: getDateFromIndex(startIndex) || prev.startDate,\n      startIndex: startIndex\n    } : null);\n  }, [editingTagData, chartData.length, getDateFromIndex]);\n  const handleSaveTagEdit = useCallback(() => {\n    if (!editingTagId || !editingTagData) return;\n    const isSpan = editingTagData.startIndex !== editingTagData.endIndex;\n    const updatedTags = (chartTags || []).map(tag => {\n      if (tag.id === editingTagId) {\n        return {\n          ...tag,\n          name: editingTagData.name,\n          owner: editingTagData.owner,\n          description: editingTagData.description,\n          startDate: editingTagData.startDate,\n          endDate: editingTagData.endDate,\n          date: editingTagData.startDate,\n          startIndex: editingTagData.startIndex,\n          endIndex: editingTagData.endIndex,\n          dateIndex: editingTagData.startIndex,\n          isSpan: isSpan,\n          adjustedStart: new Date(editingTagData.startDate + 'T00:00:00').toISOString(),\n          adjustedEnd: new Date(editingTagData.endDate + 'T00:00:00').toISOString(),\n          yearLabel: displayMode === 'ly' ? 'LY' : 'TY',\n          updatedAt: new Date().toISOString()\n        };\n      }\n      return tag;\n    });\n    if (onTagsChange) {\n      onTagsChange(updatedTags);\n    }\n    closeTagEditor();\n  }, [editingTagId, editingTagData, chartTags, displayMode, onTagsChange, closeTagEditor]);\n  const handleConvertToSpan = useCallback(e => {\n    if (e) {\n      e.preventDefault();\n      e.stopPropagation();\n    }\n    if (!editingTagData) return;\n    const currentIndex = editingTagData.startIndex;\n    const defaultSpanDays = 3;\n    const newEndIndex = Math.min(currentIndex + defaultSpanDays, chartData.length - 1);\n    const newEndDate = getDateFromIndex(newEndIndex);\n    setEditingTagData(prev => prev ? {\n      ...prev,\n      endDate: newEndDate || prev.endDate,\n      endIndex: newEndIndex\n    } : null);\n  }, [editingTagData, chartData.length, getDateFromIndex]);\n  const handleConvertToPoint = useCallback(e => {\n    if (e) {\n      e.preventDefault();\n      e.stopPropagation();\n    }\n    if (!editingTagData) return;\n    const startDate = editingTagData.startDate;\n    const startIndex = editingTagData.startIndex;\n    setEditingTagData(prev => prev ? {\n      ...prev,\n      endDate: startDate,\n      endIndex: startIndex\n    } : null);\n  }, [editingTagData]);\n  const handleRemoveTag = useCallback((tagId, e) => {\n    if (e) {\n      e.preventDefault();\n      e.stopPropagation();\n    }\n    if (onTagsChange) {\n      onTagsChange((chartTags || []).filter(t => t.id !== tagId));\n    }\n    if (editingTagId === tagId) {\n      closeTagEditor();\n    }\n  }, [chartTags, editingTagId, onTagsChange, closeTagEditor]);\n  useEffect(() => {\n    try {\n      sessionStorage.setItem('dismissedEvents', JSON.stringify(dismissedEvents));\n    } catch {}\n  }, [dismissedEvents]);\n  const handleDismissEvent = eventId => {\n    setDismissedEvents(prev => [...prev, eventId]);\n  };\n  const handleResetDismissed = () => {\n    setDismissedEvents([]);\n  };\n  const pinnedEventIds = (chartTags || []).filter(tag => tag.sourceEventId).map(tag => tag.sourceEventId);\n  const getFilteredEvents = useCallback(() => {\n    var _chartData$, _chartData;\n    if (!events || events.length === 0 || !chartData || chartData.length === 0) return [];\n    const chartStartDate = (_chartData$ = chartData[0]) === null || _chartData$ === void 0 ? void 0 : _chartData$.date;\n    const chartEndDate = (_chartData = chartData[chartData.length - 1]) === null || _chartData === void 0 ? void 0 : _chartData.date;\n    if (!chartStartDate || !chartEndDate) return [];\n    const chartStart = new Date(chartStartDate + 'T00:00:00');\n    const chartEnd = new Date(chartEndDate + 'T00:00:00');\n    const yearLabel = displayMode === 'ly' ? 'LY' : 'TY';\n    return events.filter(ev => !dismissedEvents.includes(ev.id)).filter(ev => !pinnedEventIds.includes(ev.id)).map(ev => {\n      let evStart = new Date(ev.startDate + 'T00:00:00');\n      let evEnd = new Date(ev.endDate + 'T00:00:00');\n      if (displayMode === 'ly') {\n        evStart = new Date(evStart.getTime() - 365 * 24 * 60 * 60 * 1000);\n        evEnd = new Date(evEnd.getTime() - 365 * 24 * 60 * 60 * 1000);\n      }\n      return {\n        ...ev,\n        adjustedStart: evStart,\n        adjustedEnd: evEnd,\n        yearLabel\n      };\n    }).filter(ev => ev.adjustedStart <= chartEnd && ev.adjustedEnd >= chartStart);\n  }, [events, chartData, displayMode, dismissedEvents, pinnedEventIds]);\n  const getIndexForDate = useCallback(targetDate => {\n    if (!chartData || chartData.length === 0) return -1;\n    let bestIdx = 0;\n    let bestDiff = Infinity;\n    for (let i = 0; i < chartData.length; i++) {\n      const d = new Date(chartData[i].date + 'T00:00:00');\n      const diff = Math.abs(d.getTime() - targetDate.getTime());\n      if (diff < bestDiff) {\n        bestDiff = diff;\n        bestIdx = i;\n      }\n    }\n    return bestIdx;\n  }, [chartData]);\n  const renderCompactEditPopover = (tag, isInSpanLayer = false) => {\n    if (editingTagId !== tag.id || !editingTagData) return null;\n    const isSpan = editingTagData.startIndex !== editingTagData.endIndex;\n    const dayCount = editingTagData.endIndex - editingTagData.startIndex + 1;\n    const handlePopoverClick = e => {\n      e.preventDefault();\n      e.stopPropagation();\n    };\n    const handlePopoverMouseMove = e => {\n      e.stopPropagation();\n    };\n    return /*#__PURE__*/_jsxDEV(\"div\", {\n      className: `tag-edit-popover compact ${isInSpanLayer ? 'in-span-layer' : ''}`,\n      style: {\n        borderColor: tag.color\n      },\n      onClick: handlePopoverClick,\n      onMouseDown: handlePopoverClick,\n      onMouseMove: handlePopoverMouseMove,\n      onMouseEnter: handlePopoverClick,\n      children: [/*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"edit-popover-header\",\n        children: [/*#__PURE__*/_jsxDEV(\"input\", {\n          type: \"text\",\n          className: \"edit-name-input\",\n          value: editingTagData.name,\n          onChange: e => handleEditingDataChange('name', e.target.value),\n          placeholder: \"Event name\",\n          onClick: e => e.stopPropagation(),\n          onMouseDown: e => e.stopPropagation()\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 635,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n          className: \"edit-popover-close\",\n          onClick: e => {\n            e.preventDefault();\n            e.stopPropagation();\n            closeTagEditor();\n          },\n          children: /*#__PURE__*/_jsxDEV(\"svg\", {\n            width: \"14\",\n            height: \"14\",\n            viewBox: \"0 0 24 24\",\n            fill: \"none\",\n            stroke: \"currentColor\",\n            strokeWidth: \"2\",\n            children: [/*#__PURE__*/_jsxDEV(\"line\", {\n              x1: \"18\",\n              y1: \"6\",\n              x2: \"6\",\n              y2: \"18\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 653,\n              columnNumber: 15\n            }, this), /*#__PURE__*/_jsxDEV(\"line\", {\n              x1: \"6\",\n              y1: \"6\",\n              x2: \"18\",\n              y2: \"18\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 654,\n              columnNumber: 15\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 652,\n            columnNumber: 13\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 644,\n          columnNumber: 11\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 634,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"edit-row\",\n        children: [/*#__PURE__*/_jsxDEV(\"input\", {\n          type: \"text\",\n          className: \"edit-field-small\",\n          value: editingTagData.owner,\n          onChange: e => handleEditingDataChange('owner', e.target.value),\n          placeholder: \"Owner\",\n          onClick: e => e.stopPropagation(),\n          onMouseDown: e => e.stopPropagation()\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 660,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"input\", {\n          type: \"text\",\n          className: \"edit-field-small\",\n          value: editingTagData.description,\n          onChange: e => handleEditingDataChange('description', e.target.value),\n          placeholder: \"Note\",\n          onClick: e => e.stopPropagation(),\n          onMouseDown: e => e.stopPropagation()\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 669,\n          columnNumber: 11\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 659,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"edit-date-row\",\n        onClick: handlePopoverClick,\n        onMouseDown: handlePopoverClick,\n        children: [/*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"date-control\",\n          children: [/*#__PURE__*/_jsxDEV(\"button\", {\n            className: \"date-btn\",\n            onClick: e => {\n              e.preventDefault();\n              e.stopPropagation();\n              handleStartDateChange(editingTagData.startIndex - 1);\n            },\n            disabled: editingTagData.startIndex <= 0,\n            children: \"-\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 682,\n            columnNumber: 13\n          }, this), /*#__PURE__*/_jsxDEV(\"span\", {\n            className: \"date-value\",\n            children: formatShortDate(editingTagData.startDate)\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 691,\n            columnNumber: 13\n          }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n            className: \"date-btn\",\n            onClick: e => {\n              e.preventDefault();\n              e.stopPropagation();\n              handleStartDateChange(editingTagData.startIndex + 1);\n            },\n            disabled: editingTagData.startIndex >= chartData.length - 1,\n            children: \"+\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 692,\n            columnNumber: 13\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 681,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"span\", {\n          className: \"date-separator\",\n          children: \"to\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 703,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"date-control\",\n          children: [/*#__PURE__*/_jsxDEV(\"button\", {\n            className: \"date-btn\",\n            onClick: e => {\n              e.preventDefault();\n              e.stopPropagation();\n              handleEndDateChange(editingTagData.endIndex - 1);\n            },\n            disabled: editingTagData.endIndex <= 0,\n            children: \"-\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 706,\n            columnNumber: 13\n          }, this), /*#__PURE__*/_jsxDEV(\"span\", {\n            className: \"date-value\",\n            children: formatShortDate(editingTagData.endDate)\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 715,\n            columnNumber: 13\n          }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n            className: \"date-btn\",\n            onClick: e => {\n              e.preventDefault();\n              e.stopPropagation();\n              handleEndDateChange(editingTagData.endIndex + 1);\n            },\n            disabled: editingTagData.endIndex >= chartData.length - 1,\n            children: \"+\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 716,\n            columnNumber: 13\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 705,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"span\", {\n          className: \"day-count\",\n          children: [dayCount, \"d\"]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 727,\n          columnNumber: 11\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 680,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"edit-actions-row\",\n        onClick: handlePopoverClick,\n        onMouseDown: handlePopoverClick,\n        children: [!isSpan ? /*#__PURE__*/_jsxDEV(\"button\", {\n          className: \"action-btn secondary\",\n          onClick: e => handleConvertToSpan(e),\n          children: \"Make Span\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 732,\n          columnNumber: 13\n        }, this) : /*#__PURE__*/_jsxDEV(\"button\", {\n          className: \"action-btn secondary\",\n          onClick: e => handleConvertToPoint(e),\n          children: \"Single Day\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 739,\n          columnNumber: 13\n        }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n          className: \"action-btn danger\",\n          onClick: e => handleRemoveTag(tag.id, e),\n          children: \"Delete\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 746,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n          className: \"action-btn primary\",\n          onClick: e => {\n            e.preventDefault();\n            e.stopPropagation();\n            handleSaveTagEdit();\n          },\n          children: \"Save\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 752,\n          columnNumber: 11\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 730,\n        columnNumber: 9\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 626,\n      columnNumber: 7\n    }, this);\n  };\n  const renderSingleSpan = (ev, isPinned = false, isManualSpan = false) => {\n    var _chartContainerRef$cu3;\n    const currentWidth = containerWidth || ((_chartContainerRef$cu3 = chartContainerRef.current) === null || _chartContainerRef$cu3 === void 0 ? void 0 : _chartContainerRef$cu3.offsetWidth) || 0;\n    if (currentWidth === 0) return null;\n    const chartAreaLeft = Y_AXIS_WIDTH + CHART_MARGINS.left;\n    const chartAreaWidth = currentWidth - chartAreaLeft - CHART_MARGINS.right;\n    let evStart, evEnd;\n    if (isManualSpan) {\n      evStart = new Date(ev.startDate + 'T00:00:00');\n      evEnd = new Date(ev.endDate + 'T00:00:00');\n    } else {\n      evStart = isPinned ? new Date(ev.adjustedStart) : ev.adjustedStart;\n      evEnd = isPinned ? new Date(ev.adjustedEnd) : ev.adjustedEnd;\n    }\n    const startIdx = isManualSpan ? ev.startIndex : getIndexForDate(evStart);\n    const endIdx = isManualSpan ? ev.endIndex : getIndexForDate(evEnd);\n    const clampedStart = Math.max(0, startIdx);\n    const clampedEnd = Math.min(chartData.length - 1, endIdx);\n    const startPct = chartData.length === 1 ? 0.5 : clampedStart / (chartData.length - 1);\n    const endPct = chartData.length === 1 ? 0.5 : clampedEnd / (chartData.length - 1);\n    const leftPx = chartAreaLeft + startPct * chartAreaWidth;\n    const rightPx = chartAreaLeft + endPct * chartAreaWidth;\n    const widthPx = Math.max(rightPx - leftPx, 4);\n    const centerPx = leftPx + widthPx / 2;\n    const fillColor = hexToRgba(ev.color, 0.12);\n    const borderColor = hexToRgba(ev.color, 0.5);\n    const isBeingEdited = editingTagId === ev.id;\n    const spanLabel = ev.name || ev.label;\n    const yearLabel = ev.yearLabel || (displayMode === 'ly' ? 'LY' : 'TY');\n    const handleSpanClick = e => {\n      e.preventDefault();\n      e.stopPropagation();\n    };\n    return /*#__PURE__*/_jsxDEV(\"div\", {\n      className: `event-span ${isPinned || isManualSpan ? 'pinned' : ''} ${isBeingEdited ? 'editing' : ''}`,\n      style: {\n        left: `${leftPx}px`,\n        width: `${widthPx}px`,\n        background: fillColor,\n        borderLeft: `2px solid ${borderColor}`,\n        borderRight: `2px solid ${borderColor}`\n      },\n      children: [/*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"event-span-label\",\n        style: {\n          left: `${centerPx - leftPx}px`,\n          background: ev.color\n        },\n        onClick: e => {\n          e.preventDefault();\n          e.stopPropagation();\n          if (isManualSpan) {\n            if (editingTagId !== ev.id) {\n              openTagEditor(ev.id, ev);\n            }\n          } else if (!isPinned) {\n            setEditingEvent((editingEvent === null || editingEvent === void 0 ? void 0 : editingEvent.id) === ev.id ? null : ev);\n          }\n        },\n        onMouseDown: handleSpanClick,\n        children: [/*#__PURE__*/_jsxDEV(\"span\", {\n          className: \"event-span-label-text\",\n          children: [spanLabel, \" (\", yearLabel, \")\"]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 838,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n          className: \"event-span-dismiss\",\n          onClick: e => {\n            e.preventDefault();\n            e.stopPropagation();\n            if (isPinned || isManualSpan) {\n              handleRemoveTag(ev.id, e);\n            } else {\n              handleDismissEvent(ev.id);\n            }\n          },\n          title: isPinned || isManualSpan ? \"Remove\" : \"Dismiss\",\n          children: \"x\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 841,\n          columnNumber: 11\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 822,\n        columnNumber: 9\n      }, this), isManualSpan && isBeingEdited && renderCompactEditPopover(ev, true), !isPinned && !isManualSpan && (editingEvent === null || editingEvent === void 0 ? void 0 : editingEvent.id) === ev.id && /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"event-span-edit\",\n        style: {\n          left: `${centerPx - leftPx}px`\n        },\n        onClick: handleSpanClick,\n        onMouseDown: handleSpanClick,\n        onMouseMove: handleSpanClick,\n        onMouseEnter: handleSpanClick,\n        children: [/*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"event-span-edit-header\",\n          children: [/*#__PURE__*/_jsxDEV(\"strong\", {\n            children: ev.label\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 870,\n            columnNumber: 15\n          }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n            className: \"event-span-edit-close\",\n            onClick: e => {\n              e.preventDefault();\n              e.stopPropagation();\n              setEditingEvent(null);\n            },\n            children: \"x\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 871,\n            columnNumber: 15\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 869,\n          columnNumber: 13\n        }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n          className: \"event-span-edit-dates\",\n          children: [new Date(ev.adjustedStart).toLocaleDateString('en-US', {\n            month: 'short',\n            day: 'numeric'\n          }), ' - ', new Date(ev.adjustedEnd).toLocaleDateString('en-US', {\n            month: 'short',\n            day: 'numeric'\n          })]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 882,\n          columnNumber: 13\n        }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n          className: \"event-span-edit-tier\",\n          children: ev.tier ? 'Tier 1 Event' : 'Tracked Event'\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 887,\n          columnNumber: 13\n        }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n          className: \"event-span-pin-btn\",\n          onClick: e => {\n            e.preventDefault();\n            e.stopPropagation();\n            if (onTagsChange) {\n              onTagsChange([...(chartTags || []), {\n                id: `pinned-${ev.id}-${Date.now()}`,\n                name: ev.label,\n                color: ev.color,\n                sourceEventId: ev.id,\n                isSpan: true,\n                startDate: ev.startDate,\n                endDate: ev.endDate,\n                adjustedStart: ev.adjustedStart.toISOString(),\n                adjustedEnd: ev.adjustedEnd.toISOString(),\n                yearLabel: ev.yearLabel,\n                tier: ev.tier,\n                source: 'suggested'\n              }]);\n            }\n            setEditingEvent(null);\n          },\n          children: \"Pin to chart\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 890,\n          columnNumber: 13\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 861,\n        columnNumber: 11\n      }, this)]\n    }, ev.id, true, {\n      fileName: _jsxFileName,\n      lineNumber: 811,\n      columnNumber: 7\n    }, this);\n  };\n  const getPinnedSpans = useCallback(() => {\n    var _chartData$2, _chartData2;\n    if (!chartTags || !chartData || chartData.length === 0) return [];\n    const chartStartDate = (_chartData$2 = chartData[0]) === null || _chartData$2 === void 0 ? void 0 : _chartData$2.date;\n    const chartEndDate = (_chartData2 = chartData[chartData.length - 1]) === null || _chartData2 === void 0 ? void 0 : _chartData2.date;\n    if (!chartStartDate || !chartEndDate) return [];\n    const chartStart = new Date(chartStartDate + 'T00:00:00');\n    const chartEnd = new Date(chartEndDate + 'T00:00:00');\n    return chartTags.filter(tag => tag.isSpan && !tag.isManual).filter(tag => {\n      const tagStart = new Date(tag.adjustedStart);\n      const tagEnd = new Date(tag.adjustedEnd);\n      return tagStart <= chartEnd && tagEnd >= chartStart;\n    });\n  }, [chartTags, chartData]);\n  const getManualSpans = useCallback(() => {\n    if (!chartTags || !chartData || chartData.length === 0) return [];\n    return chartTags.filter(tag => tag.isSpan && tag.isManual);\n  }, [chartTags, chartData]);\n  const renderEventSpans = () => {\n    var _chartContainerRef$cu4;\n    const currentWidth = containerWidth || ((_chartContainerRef$cu4 = chartContainerRef.current) === null || _chartContainerRef$cu4 === void 0 ? void 0 : _chartContainerRef$cu4.offsetWidth) || 0;\n    if (currentWidth === 0) return null;\n    const pinnedSpans = getPinnedSpans();\n    const manualSpans = getManualSpans();\n    const suggestedEvents = showSuggestedEvents ? getFilteredEvents() : [];\n    if (pinnedSpans.length === 0 && suggestedEvents.length === 0 && manualSpans.length === 0) return null;\n    return /*#__PURE__*/_jsxDEV(_Fragment, {\n      children: [pinnedSpans.map(span => renderSingleSpan(span, true, false)), manualSpans.map(span => renderSingleSpan(span, false, true)), suggestedEvents.map(ev => renderSingleSpan(ev, false, false))]\n    }, void 0, true);\n  };\n  const commonProps = {\n    data: chartData,\n    margin: CHART_MARGINS\n  };\n  const axisStyle = {\n    fontSize: 11,\n    fill: '#86868b',\n    fontWeight: 500\n  };\n  const calculateTickInterval = () => {\n    if (!chartData || chartData.length <= 1) return 0;\n    const dataPoints = chartData.length;\n    const targetTicks = 7;\n    const interval = Math.max(0, Math.floor((dataPoints - 1) / (targetTicks - 1)) - 1);\n    return interval;\n  };\n  const tickInterval = calculateTickInterval();\n  const tyDataKey = hasComparison ? `${kpi}_ty` : kpi;\n  const lyDataKey = hasComparison ? `${kpi}_ly` : null;\n  const showTY = displayMode === 'both' || displayMode === 'ty';\n  const showLY = displayMode === 'both' || displayMode === 'ly';\n  const renderPlacedTags = () => {\n    var _chartContainerRef$cu5;\n    if (!chartTags || chartTags.length === 0 || !chartData || chartData.length === 0) return null;\n    const pointTags = chartTags.filter(t => !t.isSpan);\n    if (pointTags.length === 0) return null;\n    const currentWidth = containerWidth || ((_chartContainerRef$cu5 = chartContainerRef.current) === null || _chartContainerRef$cu5 === void 0 ? void 0 : _chartContainerRef$cu5.offsetWidth) || 0;\n    if (currentWidth === 0) return null;\n    const poleHeight = CHART_HEIGHT - CHART_MARGINS.bottom - 40;\n    return pointTags.map(tag => {\n      let dateIndex = tag.dateIndex;\n      if (dateIndex === undefined || dateIndex < 0 || dateIndex >= chartData.length) {\n        dateIndex = chartData.findIndex(d => d.date === tag.date);\n      }\n      if (dateIndex === -1 || dateIndex >= chartData.length) return null;\n      const xPos = getXPositionForIndex(dateIndex);\n      if (xPos === 0 && dateIndex !== 0) return null;\n      const isEditing = editingTagId === tag.id;\n      const yearLabel = tag.yearLabel || (displayMode === 'ly' ? 'LY' : 'TY');\n      return /*#__PURE__*/_jsxDEV(\"div\", {\n        className: `placed-tag-container ${isEditing ? 'editing' : ''}`,\n        style: {\n          left: `${xPos}px`\n        },\n        children: [/*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"tag-label clickable\",\n          style: {\n            background: tag.color\n          },\n          onClick: e => handleTagLabelClick(e, tag.id, tag),\n          onMouseDown: e => {\n            e.preventDefault();\n            e.stopPropagation();\n          },\n          children: [/*#__PURE__*/_jsxDEV(\"span\", {\n            className: \"tag-label-text\",\n            children: [tag.name, \" (\", yearLabel, \")\"]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 1029,\n            columnNumber: 13\n          }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n            className: \"tag-label-remove\",\n            onClick: e => handleRemoveTag(tag.id, e),\n            title: \"Remove tag\",\n            children: \"x\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 1030,\n            columnNumber: 13\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 1023,\n          columnNumber: 11\n        }, this), isEditing && renderCompactEditPopover(tag, false), /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"tag-pole\",\n          style: {\n            background: tag.color,\n            height: poleHeight\n          }\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 1041,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"tag-date\",\n          style: {\n            color: tag.color\n          },\n          children: formatAxisDate(tag.date)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 1048,\n          columnNumber: 11\n        }, this)]\n      }, tag.id, true, {\n        fileName: _jsxFileName,\n        lineNumber: 1018,\n        columnNumber: 9\n      }, this);\n    });\n  };\n  const renderDragPreview = () => {\n    if (!dragPreview || dragPreview.x === 0) return null;\n    const poleHeight = CHART_HEIGHT - CHART_MARGINS.bottom - 40;\n    return /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"drag-preview-container\",\n      style: {\n        left: `${dragPreview.x}px`\n      },\n      children: [/*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"tag-label preview\",\n        style: {\n          background: dragPreview.tag.color\n        },\n        children: /*#__PURE__*/_jsxDEV(\"span\", {\n          className: \"tag-label-text\",\n          children: dragPreview.tag.name\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 1067,\n          columnNumber: 11\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 1066,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"tag-pole preview\",\n        style: {\n          borderColor: dragPreview.tag.color,\n          height: poleHeight\n        }\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 1069,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"tag-date preview\",\n        style: {\n          color: dragPreview.tag.color\n        },\n        children: dragPreview.formattedDate\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 1076,\n        columnNumber: 9\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 1062,\n      columnNumber: 7\n    }, this);\n  };\n  const renderChart = () => {\n    switch (chartType) {\n      case 'area':\n        return /*#__PURE__*/_jsxDEV(AreaChart, {\n          ...commonProps,\n          children: [/*#__PURE__*/_jsxDEV(\"defs\", {\n            children: [/*#__PURE__*/_jsxDEV(\"linearGradient\", {\n              id: \"areaGradientTY\",\n              x1: \"0\",\n              y1: \"0\",\n              x2: \"0\",\n              y2: \"1\",\n              children: [/*#__PURE__*/_jsxDEV(\"stop\", {\n                offset: \"0%\",\n                stopColor: \"#F96302\",\n                stopOpacity: 0.25\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 1090,\n                columnNumber: 17\n              }, this), /*#__PURE__*/_jsxDEV(\"stop\", {\n                offset: \"100%\",\n                stopColor: \"#F96302\",\n                stopOpacity: 0\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 1091,\n                columnNumber: 17\n              }, this)]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 1089,\n              columnNumber: 15\n            }, this), /*#__PURE__*/_jsxDEV(\"linearGradient\", {\n              id: \"areaGradientLY\",\n              x1: \"0\",\n              y1: \"0\",\n              x2: \"0\",\n              y2: \"1\",\n              children: [/*#__PURE__*/_jsxDEV(\"stop\", {\n                offset: \"0%\",\n                stopColor: \"#86868b\",\n                stopOpacity: 0.15\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 1094,\n                columnNumber: 17\n              }, this), /*#__PURE__*/_jsxDEV(\"stop\", {\n                offset: \"100%\",\n                stopColor: \"#86868b\",\n                stopOpacity: 0\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 1095,\n                columnNumber: 17\n              }, this)]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 1093,\n              columnNumber: 15\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 1088,\n            columnNumber: 13\n          }, this), /*#__PURE__*/_jsxDEV(CartesianGrid, {\n            strokeDasharray: \"3 3\",\n            stroke: \"rgba(0,0,0,0.04)\",\n            vertical: false\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 1098,\n            columnNumber: 13\n          }, this), /*#__PURE__*/_jsxDEV(XAxis, {\n            dataKey: \"displayDate\",\n            tick: axisStyle,\n            tickLine: false,\n            axisLine: {\n              stroke: 'rgba(0,0,0,0.08)'\n            },\n            tickFormatter: formatAxisDate,\n            interval: tickInterval\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 1099,\n            columnNumber: 13\n          }, this), /*#__PURE__*/_jsxDEV(YAxis, {\n            tick: axisStyle,\n            tickLine: false,\n            axisLine: false,\n            tickFormatter: formatValue,\n            width: Y_AXIS_WIDTH\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 1107,\n            columnNumber: 13\n          }, this), /*#__PURE__*/_jsxDEV(Tooltip, {\n            content: /*#__PURE__*/_jsxDEV(CustomTooltip, {}, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 1114,\n              columnNumber: 31\n            }, this)\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 1114,\n            columnNumber: 13\n          }, this), hasComparison && /*#__PURE__*/_jsxDEV(Legend, {}, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 1115,\n            columnNumber: 31\n          }, this), launchDate && showTY && /*#__PURE__*/_jsxDEV(ReferenceLine, {\n            x: launchDate,\n            stroke: \"#F96302\",\n            strokeDasharray: \"4 4\",\n            strokeWidth: 2,\n            label: {\n              value: 'Launch',\n              position: 'top',\n              fill: '#F96302',\n              fontSize: 11,\n              fontWeight: 600\n            }\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 1117,\n            columnNumber: 15\n          }, this), hasComparison && lyDataKey && showLY && /*#__PURE__*/_jsxDEV(Area, {\n            type: \"monotone\",\n            dataKey: lyDataKey,\n            name: \"Last Year\",\n            stroke: \"#86868b\",\n            strokeWidth: 1.5,\n            strokeDasharray: \"4 4\",\n            fill: \"url(#areaGradientLY)\",\n            dot: false,\n            activeDot: {\n              r: 4,\n              fill: '#86868b',\n              stroke: '#fff',\n              strokeWidth: 2\n            }\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 1132,\n            columnNumber: 15\n          }, this), showTY && /*#__PURE__*/_jsxDEV(Area, {\n            type: \"monotone\",\n            dataKey: tyDataKey,\n            name: hasComparison ? \"This Year\" : kpi,\n            stroke: \"#F96302\",\n            strokeWidth: 2,\n            fill: \"url(#areaGradientTY)\",\n            dot: false,\n            activeDot: {\n              r: 5,\n              fill: '#F96302',\n              stroke: '#fff',\n              strokeWidth: 2\n            }\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 1145,\n            columnNumber: 15\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 1087,\n          columnNumber: 11\n        }, this);\n      case 'bar':\n        return /*#__PURE__*/_jsxDEV(BarChart, {\n          ...commonProps,\n          children: [/*#__PURE__*/_jsxDEV(CartesianGrid, {\n            strokeDasharray: \"3 3\",\n            stroke: \"rgba(0,0,0,0.04)\",\n            vertical: false\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 1162,\n            columnNumber: 13\n          }, this), /*#__PURE__*/_jsxDEV(XAxis, {\n            dataKey: \"displayDate\",\n            tick: axisStyle,\n            tickLine: false,\n            axisLine: {\n              stroke: 'rgba(0,0,0,0.08)'\n            },\n            tickFormatter: formatAxisDate,\n            interval: tickInterval\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 1163,\n            columnNumber: 13\n          }, this), /*#__PURE__*/_jsxDEV(YAxis, {\n            tick: axisStyle,\n            tickLine: false,\n            axisLine: false,\n            tickFormatter: formatValue,\n            width: Y_AXIS_WIDTH\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 1171,\n            columnNumber: 13\n          }, this), /*#__PURE__*/_jsxDEV(Tooltip, {\n            content: /*#__PURE__*/_jsxDEV(CustomTooltip, {}, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 1178,\n              columnNumber: 31\n            }, this)\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 1178,\n            columnNumber: 13\n          }, this), hasComparison && /*#__PURE__*/_jsxDEV(Legend, {}, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 1179,\n            columnNumber: 31\n          }, this), launchDate && showTY && /*#__PURE__*/_jsxDEV(ReferenceLine, {\n            x: launchDate,\n            stroke: \"#F96302\",\n            strokeDasharray: \"4 4\",\n            strokeWidth: 2\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 1181,\n            columnNumber: 15\n          }, this), hasComparison && lyDataKey && showLY && /*#__PURE__*/_jsxDEV(Bar, {\n            dataKey: lyDataKey,\n            name: \"Last Year\",\n            fill: \"#d1d1d6\",\n            radius: [4, 4, 0, 0],\n            maxBarSize: 20\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 1189,\n            columnNumber: 15\n          }, this), showTY && /*#__PURE__*/_jsxDEV(Bar, {\n            dataKey: tyDataKey,\n            name: hasComparison ? \"This Year\" : kpi,\n            fill: \"#F96302\",\n            radius: [4, 4, 0, 0],\n            maxBarSize: hasComparison ? 20 : 40\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 1198,\n            columnNumber: 15\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 1161,\n          columnNumber: 11\n        }, this);\n      default:\n        return /*#__PURE__*/_jsxDEV(LineChart, {\n          ...commonProps,\n          children: [/*#__PURE__*/_jsxDEV(CartesianGrid, {\n            strokeDasharray: \"3 3\",\n            stroke: \"rgba(0,0,0,0.04)\",\n            vertical: false\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 1212,\n            columnNumber: 13\n          }, this), /*#__PURE__*/_jsxDEV(XAxis, {\n            dataKey: \"displayDate\",\n            tick: axisStyle,\n            tickLine: false,\n            axisLine: {\n              stroke: 'rgba(0,0,0,0.08)'\n            },\n            tickFormatter: formatAxisDate,\n            interval: tickInterval\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 1213,\n            columnNumber: 13\n          }, this), /*#__PURE__*/_jsxDEV(YAxis, {\n            tick: axisStyle,\n            tickLine: false,\n            axisLine: false,\n            tickFormatter: formatValue,\n            width: Y_AXIS_WIDTH\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 1221,\n            columnNumber: 13\n          }, this), /*#__PURE__*/_jsxDEV(Tooltip, {\n            content: /*#__PURE__*/_jsxDEV(CustomTooltip, {}, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 1228,\n              columnNumber: 31\n            }, this)\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 1228,\n            columnNumber: 13\n          }, this), hasComparison && /*#__PURE__*/_jsxDEV(Legend, {}, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 1229,\n            columnNumber: 31\n          }, this), launchDate && showTY && /*#__PURE__*/_jsxDEV(ReferenceLine, {\n            x: launchDate,\n            stroke: \"#F96302\",\n            strokeDasharray: \"4 4\",\n            strokeWidth: 2,\n            label: {\n              value: 'Launch',\n              position: 'top',\n              fill: '#F96302',\n              fontSize: 11,\n              fontWeight: 600\n            }\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 1231,\n            columnNumber: 15\n          }, this), hasComparison && lyDataKey && showLY && /*#__PURE__*/_jsxDEV(Line, {\n            type: \"monotone\",\n            dataKey: lyDataKey,\n            name: \"Last Year\",\n            stroke: \"#86868b\",\n            strokeWidth: 1.5,\n            strokeDasharray: \"4 4\",\n            dot: false,\n            activeDot: {\n              r: 4,\n              fill: '#86868b',\n              stroke: '#fff',\n              strokeWidth: 2\n            }\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 1246,\n            columnNumber: 15\n          }, this), showTY && /*#__PURE__*/_jsxDEV(Line, {\n            type: \"monotone\",\n            dataKey: tyDataKey,\n            name: hasComparison ? \"This Year\" : kpi,\n            stroke: \"#F96302\",\n            strokeWidth: 2,\n            dot: false,\n            activeDot: {\n              r: 5,\n              fill: '#F96302',\n              stroke: '#fff',\n              strokeWidth: 2\n            }\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 1258,\n            columnNumber: 15\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 1211,\n          columnNumber: 11\n        }, this);\n    }\n  };\n  if (!chartData || chartData.length === 0) {\n    return /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"chart-empty\",\n      children: /*#__PURE__*/_jsxDEV(\"p\", {\n        children: \"No data available for the selected period\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 1276,\n        columnNumber: 9\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 1275,\n      columnNumber: 7\n    }, this);\n  }\n  if (isBeta) {\n    return /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"kpi-chart beta-restricted\",\n      children: [/*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"chart-blur-wrapper\",\n        children: /*#__PURE__*/_jsxDEV(ResponsiveContainer, {\n          width: \"100%\",\n          height: 320,\n          children: renderChart()\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 1285,\n          columnNumber: 11\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 1284,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"beta-overlay\",\n        children: /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"beta-overlay-content\",\n          children: [/*#__PURE__*/_jsxDEV(\"h3\", {\n            children: \"Place holder\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 1291,\n            columnNumber: 13\n          }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n            children: \"Chart visualization\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 1292,\n            columnNumber: 13\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 1290,\n          columnNumber: 11\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 1289,\n        columnNumber: 9\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 1283,\n      columnNumber: 7\n    }, this);\n  }\n  const isEditingActive = editingTagId || editingEvent;\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    className: \"kpi-chart-wrapper\",\n    children: [/*#__PURE__*/_jsxDEV(\"div\", {\n      className: `kpi-chart ${draggedTag ? 'drop-active' : ''} ${isEditingActive ? 'editing-active' : ''}`,\n      ref: chartContainerRef,\n      onDragOver: handleDragOver,\n      onDragLeave: handleDragLeave,\n      onDrop: handleDrop,\n      children: [/*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"tag-area\",\n        children: [renderPlacedTags(), dragPreview && renderDragPreview()]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 1310,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        className: `event-spans-layer ${isEditingActive ? 'has-editing' : ''}`,\n        style: {\n          height: `${PLOT_AREA_HEIGHT}px`\n        },\n        children: renderEventSpans()\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 1315,\n        columnNumber: 9\n      }, this), isEditingActive && /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"chart-interaction-blocker\",\n        onClick: e => {\n          e.stopPropagation();\n        },\n        onMouseMove: e => {\n          e.stopPropagation();\n        }\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 1323,\n        columnNumber: 11\n      }, this), /*#__PURE__*/_jsxDEV(ResponsiveContainer, {\n        width: \"100%\",\n        height: 320,\n        children: renderChart()\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 1330,\n        columnNumber: 9\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 1303,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"chart-tag-controls\",\n      children: [/*#__PURE__*/_jsxDEV(\"button\", {\n        className: `tag-panel-toggle ${showTagPanel ? 'active' : ''}`,\n        onClick: () => setShowTagPanel(!showTagPanel),\n        children: [/*#__PURE__*/_jsxDEV(\"svg\", {\n          width: \"16\",\n          height: \"16\",\n          viewBox: \"0 0 24 24\",\n          fill: \"none\",\n          stroke: \"currentColor\",\n          strokeWidth: \"2\",\n          strokeLinecap: \"round\",\n          strokeLinejoin: \"round\",\n          children: [/*#__PURE__*/_jsxDEV(\"path\", {\n            d: \"M20.59 13.41l-7.17 7.17a2 2 0 0 1-2.83 0L2 12V2h10l8.59 8.59a2 2 0 0 1 0 2.82z\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 1341,\n            columnNumber: 13\n          }, this), /*#__PURE__*/_jsxDEV(\"line\", {\n            x1: \"7\",\n            y1: \"7\",\n            x2: \"7.01\",\n            y2: \"7\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 1342,\n            columnNumber: 13\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 1340,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"span\", {\n          children: \"Add Tag\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 1344,\n          columnNumber: 11\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 1336,\n        columnNumber: 9\n      }, this), chartTags && chartTags.length > 0 && (() => {\n        const pinnedEvents = chartTags.filter(tag => tag.source === 'suggested');\n        const manualTags = chartTags.filter(tag => tag.source !== 'suggested');\n        const renderPill = tag => /*#__PURE__*/_jsxDEV(\"span\", {\n          className: `active-tag-pill ${editingTagId === tag.id ? 'editing' : ''}`,\n          style: {\n            '--tag-color': tag.color\n          },\n          onClick: e => {\n            e.preventDefault();\n            e.stopPropagation();\n            openTagEditor(tag.id, tag);\n          },\n          children: [/*#__PURE__*/_jsxDEV(\"span\", {\n            className: \"pill-dot\",\n            style: {\n              background: tag.color\n            }\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 1362,\n            columnNumber: 15\n          }, this), /*#__PURE__*/_jsxDEV(\"span\", {\n            className: \"pill-name\",\n            children: tag.name\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 1363,\n            columnNumber: 15\n          }, this), tag.isSpan && /*#__PURE__*/_jsxDEV(\"span\", {\n            className: \"pill-range\",\n            children: [formatShortDate(tag.startDate), \"-\", formatShortDate(tag.endDate)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 1365,\n            columnNumber: 17\n          }, this), !tag.isSpan && /*#__PURE__*/_jsxDEV(\"span\", {\n            className: \"pill-date\",\n            children: formatShortDate(tag.date)\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 1370,\n            columnNumber: 17\n          }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n            className: \"pill-remove\",\n            onClick: e => handleRemoveTag(tag.id, e),\n            children: /*#__PURE__*/_jsxDEV(\"svg\", {\n              width: \"10\",\n              height: \"10\",\n              viewBox: \"0 0 24 24\",\n              fill: \"none\",\n              stroke: \"currentColor\",\n              strokeWidth: \"3\",\n              children: [/*#__PURE__*/_jsxDEV(\"line\", {\n                x1: \"18\",\n                y1: \"6\",\n                x2: \"6\",\n                y2: \"18\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 1377,\n                columnNumber: 19\n              }, this), /*#__PURE__*/_jsxDEV(\"line\", {\n                x1: \"6\",\n                y1: \"6\",\n                x2: \"18\",\n                y2: \"18\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 1378,\n                columnNumber: 19\n              }, this)]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 1376,\n              columnNumber: 17\n            }, this)\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 1372,\n            columnNumber: 15\n          }, this)]\n        }, tag.id, true, {\n          fileName: _jsxFileName,\n          lineNumber: 1352,\n          columnNumber: 13\n        }, this);\n        return /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"active-tags-list\",\n          children: [pinnedEvents.length > 0 && /*#__PURE__*/_jsxDEV(_Fragment, {\n            children: [/*#__PURE__*/_jsxDEV(\"span\", {\n              className: \"tags-section-label pinned\",\n              children: \"Suggested Events\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 1388,\n              columnNumber: 19\n            }, this), pinnedEvents.map(renderPill)]\n          }, void 0, true), pinnedEvents.length > 0 && manualTags.length > 0 && /*#__PURE__*/_jsxDEV(\"span\", {\n            className: \"tags-separator\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 1393,\n            columnNumber: 17\n          }, this), manualTags.length > 0 && /*#__PURE__*/_jsxDEV(_Fragment, {\n            children: [/*#__PURE__*/_jsxDEV(\"span\", {\n              className: \"tags-section-label manual\",\n              children: \"User Added\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 1397,\n              columnNumber: 19\n            }, this), manualTags.map(renderPill)]\n          }, void 0, true)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 1385,\n          columnNumber: 13\n        }, this);\n      })()]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 1335,\n      columnNumber: 7\n    }, this), showTagPanel && /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"tag-panel\",\n      children: [/*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"tag-panel-header\",\n        children: [/*#__PURE__*/_jsxDEV(\"h4\", {\n          children: \"Add Event Tag\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 1409,\n          columnNumber: 13\n        }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n          className: \"tag-panel-close\",\n          onClick: () => setShowTagPanel(false),\n          children: /*#__PURE__*/_jsxDEV(\"svg\", {\n            width: \"16\",\n            height: \"16\",\n            viewBox: \"0 0 24 24\",\n            fill: \"none\",\n            stroke: \"currentColor\",\n            strokeWidth: \"2\",\n            children: [/*#__PURE__*/_jsxDEV(\"line\", {\n              x1: \"18\",\n              y1: \"6\",\n              x2: \"6\",\n              y2: \"18\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 1412,\n              columnNumber: 17\n            }, this), /*#__PURE__*/_jsxDEV(\"line\", {\n              x1: \"6\",\n              y1: \"6\",\n              x2: \"18\",\n              y2: \"18\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 1413,\n              columnNumber: 17\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 1411,\n            columnNumber: 15\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 1410,\n          columnNumber: 13\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 1408,\n        columnNumber: 11\n      }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n        className: \"tag-panel-hint\",\n        children: \"Drag a tag onto the chart. Click to edit dates and convert to a span.\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 1418,\n        columnNumber: 11\n      }, this), dismissedEvents.length > 0 && /*#__PURE__*/_jsxDEV(\"button\", {\n        className: \"reset-dismissed-btn\",\n        onClick: handleResetDismissed,\n        children: [\"Restore \", dismissedEvents.length, \" dismissed\"]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 1423,\n        columnNumber: 13\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"preset-tags\",\n        children: PRESET_TAGS.map(tag => /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"draggable-tag\",\n          draggable: true,\n          onDragStart: e => handleDragStart(e, tag),\n          onDragEnd: handleDragEnd,\n          style: {\n            borderColor: tag.color\n          },\n          children: [/*#__PURE__*/_jsxDEV(\"span\", {\n            className: \"tag-marker\",\n            style: {\n              background: tag.color\n            }\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 1438,\n            columnNumber: 17\n          }, this), tag.name]\n        }, tag.id, true, {\n          fileName: _jsxFileName,\n          lineNumber: 1430,\n          columnNumber: 15\n        }, this))\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 1428,\n        columnNumber: 11\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"custom-tag-section\",\n        children: !showCustomForm ? /*#__PURE__*/_jsxDEV(\"button\", {\n          className: \"add-custom-tag-btn\",\n          onClick: () => setShowCustomForm(true),\n          children: [/*#__PURE__*/_jsxDEV(\"svg\", {\n            width: \"14\",\n            height: \"14\",\n            viewBox: \"0 0 24 24\",\n            fill: \"none\",\n            stroke: \"currentColor\",\n            strokeWidth: \"2\",\n            children: [/*#__PURE__*/_jsxDEV(\"line\", {\n              x1: \"12\",\n              y1: \"5\",\n              x2: \"12\",\n              y2: \"19\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 1451,\n              columnNumber: 19\n            }, this), /*#__PURE__*/_jsxDEV(\"line\", {\n              x1: \"5\",\n              y1: \"12\",\n              x2: \"19\",\n              y2: \"12\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 1452,\n              columnNumber: 19\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 1450,\n            columnNumber: 17\n          }, this), \"Custom Tag\"]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 1446,\n          columnNumber: 15\n        }, this) : /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"custom-tag-form\",\n          children: [/*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"custom-form-row\",\n            children: [/*#__PURE__*/_jsxDEV(\"input\", {\n              type: \"text\",\n              placeholder: \"Tag name\",\n              value: customTagName,\n              onChange: e => setCustomTagName(e.target.value),\n              className: \"custom-tag-input\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 1459,\n              columnNumber: 19\n            }, this), /*#__PURE__*/_jsxDEV(\"input\", {\n              type: \"text\",\n              placeholder: \"Owner\",\n              value: customTagOwner,\n              onChange: e => setCustomTagOwner(e.target.value),\n              className: \"custom-tag-input\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 1466,\n              columnNumber: 19\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 1458,\n            columnNumber: 17\n          }, this), /*#__PURE__*/_jsxDEV(\"input\", {\n            type: \"text\",\n            placeholder: \"Description (optional)\",\n            value: customTagDescription,\n            onChange: e => setCustomTagDescription(e.target.value),\n            className: \"custom-tag-input full\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 1474,\n            columnNumber: 17\n          }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"custom-tag-actions\",\n            children: [/*#__PURE__*/_jsxDEV(\"button\", {\n              className: \"custom-tag-cancel\",\n              onClick: () => {\n                setShowCustomForm(false);\n                setCustomTagName('');\n                setCustomTagOwner('');\n                setCustomTagDescription('');\n              },\n              children: \"Cancel\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 1482,\n              columnNumber: 19\n            }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n              className: \"custom-tag-create\",\n              onClick: handleAddCustomTag,\n              disabled: !customTagName.trim() || !customTagOwner.trim(),\n              children: \"Create\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 1493,\n              columnNumber: 19\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 1481,\n            columnNumber: 17\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 1457,\n          columnNumber: 15\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 1444,\n        columnNumber: 11\n      }, this), draggedTag && draggedTag.isCustom && /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"drag-instruction\",\n        children: [/*#__PURE__*/_jsxDEV(\"p\", {\n          children: [\"Drag \\\"\", draggedTag.name, \"\\\" onto the chart:\"]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 1507,\n          columnNumber: 15\n        }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"draggable-tag custom\",\n          draggable: true,\n          onDragStart: e => handleDragStart(e, draggedTag),\n          onDragEnd: handleDragEnd,\n          children: [/*#__PURE__*/_jsxDEV(\"span\", {\n            className: \"tag-marker\",\n            style: {\n              background: draggedTag.color\n            }\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 1514,\n            columnNumber: 17\n          }, this), draggedTag.name]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 1508,\n          columnNumber: 15\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 1506,\n        columnNumber: 13\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 1407,\n      columnNumber: 9\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 1302,\n    columnNumber: 5\n  }, this);\n}\n_s(KPIChart, \"rLElypchEG9bs6m57NN5DBURFV0=\", false, function () {\n  return [useAuth];\n});\n_c = KPIChart;\nexport default KPIChart;\nvar _c;\n$RefreshReg$(_c, \"KPIChart\");","map":{"version":3,"names":["useState","useRef","useCallback","useEffect","LineChart","Line","AreaChart","Area","BarChart","Bar","XAxis","YAxis","CartesianGrid","Tooltip","ResponsiveContainer","ReferenceLine","Legend","useAuth","jsxDEV","_jsxDEV","Fragment","_Fragment","PRESET_TAGS","id","name","color","CHART_MARGINS","top","right","left","bottom","Y_AXIS_WIDTH","CHART_HEIGHT","PLOT_AREA_HEIGHT","hexToRgba","hex","alpha","r","parseInt","slice","g","b","KPIChart","data","kpi","chartType","format","launchDate","comparisonData","chartTags","onTagsChange","displayMode","events","showSuggestedEvents","_s","isBetaMode","isBeta","chartContainerRef","showTagPanel","setShowTagPanel","customTagName","setCustomTagName","customTagOwner","setCustomTagOwner","customTagDescription","setCustomTagDescription","draggedTag","setDraggedTag","showCustomForm","setShowCustomForm","dragPreview","setDragPreview","containerWidth","setContainerWidth","editingTagId","setEditingTagId","editingTagData","setEditingTagData","dismissedEvents","setDismissedEvents","stored","sessionStorage","getItem","JSON","parse","editingEvent","setEditingEvent","rawChartData","length","hasComparison","chartData","map","d","displayDate","date_ly","date","updateWidth","current","width","offsetWidth","initialTimeout","setTimeout","secondTimeout","window","addEventListener","resizeObserver","ResizeObserver","requestAnimationFrame","observe","clearTimeout","removeEventListener","disconnect","handleClickOutside","e","clickedElement","target","isInsidePopover","closest","isInsideEventEdit","isTagLabel","isSpanLabel","isActivePill","isButton","isInput","timeoutId","document","formatValue","val","undefined","isNaN","Math","abs","toFixed","toLocaleString","formatAxisDate","dateStr","Date","toLocaleDateString","month","day","formatFullDate","weekday","year","formatShortDate","getContainerRect","getBoundingClientRect","getDateIndexFromX","clientX","rect","chartAreaLeft","chartAreaWidth","relativeX","percentage","max","min","dataIndex","round","getXPositionForIndex","index","_chartContainerRef$cu","getDateFromIndex","_chartData$index","getIndexFromDate","findIndex","CustomTooltip","active","payload","label","dataPoint","find","formatDate","dateTag","t","className","children","fileName","_jsxFileName","lineNumber","columnNumber","style","background","entry","value","handleDragStart","tag","tagForDrag","startsWith","dataTransfer","effectAllowed","img","Image","src","setDragImage","handleDragOver","_chartData$dateIndex","preventDefault","dropEffect","dateIndex","targetDate","xPosition","formattedDate","x","handleDragLeave","_chartContainerRef$cu2","clientY","handleDrop","_chartData$dateIndex2","uniqueId","now","random","toString","substr","newTag","startDate","endDate","startIndex","endIndex","isSpan","isManual","createdAt","toISOString","owner","description","handleDragEnd","handleAddCustomTag","trim","isCustom","openTagEditor","tagId","tagIndex","closeTagEditor","handleTagLabelClick","stopPropagation","handleEditingDataChange","field","prev","handleStartDateChange","newIndex","newStartDate","handleEndDateChange","newEndDate","handleSaveTagEdit","updatedTags","adjustedStart","adjustedEnd","yearLabel","updatedAt","handleConvertToSpan","currentIndex","defaultSpanDays","newEndIndex","handleConvertToPoint","handleRemoveTag","filter","setItem","stringify","handleDismissEvent","eventId","handleResetDismissed","pinnedEventIds","sourceEventId","getFilteredEvents","_chartData$","_chartData","chartStartDate","chartEndDate","chartStart","chartEnd","ev","includes","evStart","evEnd","getTime","getIndexForDate","bestIdx","bestDiff","Infinity","i","diff","renderCompactEditPopover","isInSpanLayer","dayCount","handlePopoverClick","handlePopoverMouseMove","borderColor","onClick","onMouseDown","onMouseMove","onMouseEnter","type","onChange","placeholder","height","viewBox","fill","stroke","strokeWidth","x1","y1","x2","y2","disabled","renderSingleSpan","isPinned","isManualSpan","_chartContainerRef$cu3","currentWidth","startIdx","endIdx","clampedStart","clampedEnd","startPct","endPct","leftPx","rightPx","widthPx","centerPx","fillColor","isBeingEdited","spanLabel","handleSpanClick","borderLeft","borderRight","title","tier","source","getPinnedSpans","_chartData$2","_chartData2","tagStart","tagEnd","getManualSpans","renderEventSpans","_chartContainerRef$cu4","pinnedSpans","manualSpans","suggestedEvents","span","commonProps","margin","axisStyle","fontSize","fontWeight","calculateTickInterval","dataPoints","targetTicks","interval","floor","tickInterval","tyDataKey","lyDataKey","showTY","showLY","renderPlacedTags","_chartContainerRef$cu5","pointTags","poleHeight","xPos","isEditing","renderDragPreview","renderChart","offset","stopColor","stopOpacity","strokeDasharray","vertical","dataKey","tick","tickLine","axisLine","tickFormatter","content","position","dot","activeDot","radius","maxBarSize","isEditingActive","ref","onDragOver","onDragLeave","onDrop","strokeLinecap","strokeLinejoin","pinnedEvents","manualTags","renderPill","draggable","onDragStart","onDragEnd","_c","$RefreshReg$"],"sources":["C:/Users/AkashPatil/THD-Dashboard/frontend/src/components/KPIChart.js"],"sourcesContent":["import { useState, useRef, useCallback, useEffect } from 'react';\r\nimport {\r\n  LineChart, Line, AreaChart, Area, BarChart, Bar,\r\n  XAxis, YAxis, CartesianGrid, Tooltip, ResponsiveContainer,\r\n  ReferenceLine, Legend\r\n} from 'recharts';\r\nimport { useAuth } from '../context/AuthContext';\r\nimport './KPIChart.css';\r\n\r\nconst PRESET_TAGS = [\r\n  { id: 'thanksgiving', name: 'Thanksgiving', color: '#F96302' },\r\n  { id: 'july4th', name: '4th of July', color: '#FF3B30' },\r\n  { id: 'tier1', name: 'Tier 1 Event', color: '#5856D6' },\r\n  { id: 'promo', name: 'Promo', color: '#34C759' },\r\n  { id: 'outage', name: 'Outage/Issue', color: '#FF2D55' }\r\n];\r\n\r\nconst CHART_MARGINS = { top: 20, right: 20, left: 10, bottom: 20 };\r\nconst Y_AXIS_WIDTH = 60;\r\nconst CHART_HEIGHT = 320;\r\nconst PLOT_AREA_HEIGHT = CHART_HEIGHT - CHART_MARGINS.top - CHART_MARGINS.bottom - 54;\r\n\r\nfunction hexToRgba(hex, alpha) {\r\n  const r = parseInt(hex.slice(1, 3), 16);\r\n  const g = parseInt(hex.slice(3, 5), 16);\r\n  const b = parseInt(hex.slice(5, 7), 16);\r\n  return `rgba(${r},${g},${b},${alpha})`;\r\n}\r\n\r\nfunction KPIChart({ data, kpi, chartType, format, launchDate, comparisonData, chartTags, onTagsChange, displayMode = 'both', events = [], showSuggestedEvents = false }) {\r\n  const { isBetaMode } = useAuth();\r\n  const isBeta = isBetaMode();\r\n  const chartContainerRef = useRef(null);\r\n  const [showTagPanel, setShowTagPanel] = useState(false);\r\n  const [customTagName, setCustomTagName] = useState('');\r\n  const [customTagOwner, setCustomTagOwner] = useState('');\r\n  const [customTagDescription, setCustomTagDescription] = useState('');\r\n  const [draggedTag, setDraggedTag] = useState(null);\r\n  const [showCustomForm, setShowCustomForm] = useState(false);\r\n  const [dragPreview, setDragPreview] = useState(null);\r\n  const [containerWidth, setContainerWidth] = useState(0);\r\n  const [editingTagId, setEditingTagId] = useState(null);\r\n  const [editingTagData, setEditingTagData] = useState(null);\r\n  const [dismissedEvents, setDismissedEvents] = useState(() => {\r\n    try {\r\n      const stored = sessionStorage.getItem('dismissedEvents');\r\n      return stored ? JSON.parse(stored) : [];\r\n    } catch { return []; }\r\n  });\r\n  const [editingEvent, setEditingEvent] = useState(null);\r\n\r\n  const rawChartData = comparisonData && comparisonData.length > 0 ? comparisonData : data;\r\n  const hasComparison = comparisonData && comparisonData.length > 0;\r\n\r\n  const chartData = rawChartData?.map(d => ({\r\n    ...d,\r\n    displayDate: displayMode === 'ly' && d.date_ly ? d.date_ly : d.date\r\n  })) || [];\r\n\r\n  useEffect(() => {\r\n    const updateWidth = () => {\r\n      if (chartContainerRef.current) {\r\n        const width = chartContainerRef.current.offsetWidth;\r\n        if (width > 0) {\r\n          setContainerWidth(width);\r\n        }\r\n      }\r\n    };\r\n\r\n    updateWidth();\r\n    const initialTimeout = setTimeout(updateWidth, 100);\r\n    const secondTimeout = setTimeout(updateWidth, 300);\r\n\r\n    window.addEventListener('resize', updateWidth);\r\n\r\n    const resizeObserver = new ResizeObserver(() => {\r\n      requestAnimationFrame(updateWidth);\r\n    });\r\n    if (chartContainerRef.current) {\r\n      resizeObserver.observe(chartContainerRef.current);\r\n    }\r\n\r\n    return () => {\r\n      clearTimeout(initialTimeout);\r\n      clearTimeout(secondTimeout);\r\n      window.removeEventListener('resize', updateWidth);\r\n      resizeObserver.disconnect();\r\n    };\r\n  }, []);\r\n\r\n  useEffect(() => {\r\n    if (chartTags && chartTags.length > 0 && chartContainerRef.current) {\r\n      const width = chartContainerRef.current.offsetWidth;\r\n      if (width > 0 && containerWidth !== width) {\r\n        setContainerWidth(width);\r\n      }\r\n    }\r\n  }, [chartTags, containerWidth]);\r\n\r\n  useEffect(() => {\r\n    if (!editingTagId && !editingEvent) return;\r\n\r\n    const handleClickOutside = (e) => {\r\n      const clickedElement = e.target;\r\n      \r\n      const isInsidePopover = clickedElement.closest('.tag-edit-popover');\r\n      const isInsideEventEdit = clickedElement.closest('.event-span-edit');\r\n      const isTagLabel = clickedElement.closest('.tag-label');\r\n      const isSpanLabel = clickedElement.closest('.event-span-label');\r\n      const isActivePill = clickedElement.closest('.active-tag-pill');\r\n      const isButton = clickedElement.closest('button');\r\n      const isInput = clickedElement.closest('input');\r\n      \r\n      if (isInsidePopover || isInsideEventEdit || isTagLabel || isSpanLabel || isActivePill || isButton || isInput) {\r\n        return;\r\n      }\r\n\r\n      setEditingTagId(null);\r\n      setEditingTagData(null);\r\n      setEditingEvent(null);\r\n    };\r\n\r\n    const timeoutId = setTimeout(() => {\r\n      document.addEventListener('click', handleClickOutside, true);\r\n    }, 50);\r\n\r\n    return () => {\r\n      clearTimeout(timeoutId);\r\n      document.removeEventListener('click', handleClickOutside, true);\r\n    };\r\n  }, [editingTagId, editingEvent]);\r\n\r\n  const formatValue = (val) => {\r\n    if (val === null || val === undefined || isNaN(val)) return '-';\r\n\r\n    if (format === 'currency') {\r\n      if (Math.abs(val) >= 1000000) {\r\n        return `$${(val / 1000000).toFixed(1)}M`;\r\n      }\r\n      if (Math.abs(val) >= 1000) {\r\n        return `$${(val / 1000).toFixed(0)}K`;\r\n      }\r\n      return `$${val.toFixed(2)}`;\r\n    }\r\n    if (format === 'percentage') {\r\n      return `${(val * 100).toFixed(2)}%`;\r\n    }\r\n    if (Math.abs(val) >= 1000000) {\r\n      return `${(val / 1000000).toFixed(1)}M`;\r\n    }\r\n    if (Math.abs(val) >= 1000) {\r\n      return `${(val / 1000).toFixed(0)}K`;\r\n    }\r\n    return val.toLocaleString();\r\n  };\r\n\r\n  const formatAxisDate = (dateStr) => {\r\n    const date = new Date(dateStr);\r\n    return date.toLocaleDateString('en-US', { month: 'short', day: 'numeric' });\r\n  };\r\n\r\n  const formatFullDate = (dateStr) => {\r\n    const date = new Date(dateStr);\r\n    return date.toLocaleDateString('en-US', {\r\n      weekday: 'short',\r\n      month: 'short',\r\n      day: 'numeric',\r\n      year: 'numeric'\r\n    });\r\n  };\r\n\r\n  const formatShortDate = (dateStr) => {\r\n    if (!dateStr) return '-';\r\n    const date = new Date(dateStr);\r\n    return date.toLocaleDateString('en-US', { month: 'short', day: 'numeric' });\r\n  };\r\n\r\n  const getContainerRect = useCallback(() => {\r\n    if (!chartContainerRef.current) return null;\r\n    return chartContainerRef.current.getBoundingClientRect();\r\n  }, []);\r\n\r\n  const getDateIndexFromX = useCallback((clientX) => {\r\n    if (!chartData || chartData.length === 0) return -1;\r\n    const rect = getContainerRect();\r\n    if (!rect) return -1;\r\n\r\n    const chartAreaLeft = Y_AXIS_WIDTH + CHART_MARGINS.left;\r\n    const chartAreaWidth = rect.width - chartAreaLeft - CHART_MARGINS.right;\r\n\r\n    const relativeX = clientX - rect.left - chartAreaLeft;\r\n    const percentage = Math.max(0, Math.min(1, relativeX / chartAreaWidth));\r\n\r\n    const dataIndex = Math.round(percentage * (chartData.length - 1));\r\n    return Math.max(0, Math.min(dataIndex, chartData.length - 1));\r\n  }, [chartData, getContainerRect]);\r\n\r\n  const getXPositionForIndex = useCallback((index) => {\r\n    if (!chartData || chartData.length === 0 || index < 0) return 0;\r\n\r\n    const width = containerWidth || (chartContainerRef.current?.offsetWidth || 0);\r\n    if (width === 0) return 0;\r\n\r\n    const chartAreaLeft = Y_AXIS_WIDTH + CHART_MARGINS.left;\r\n    const chartAreaWidth = width - chartAreaLeft - CHART_MARGINS.right;\r\n\r\n    if (chartData.length === 1) {\r\n      return chartAreaLeft + chartAreaWidth / 2;\r\n    }\r\n\r\n    const percentage = index / (chartData.length - 1);\r\n    return chartAreaLeft + (percentage * chartAreaWidth);\r\n  }, [chartData, containerWidth]);\r\n\r\n  const getDateFromIndex = useCallback((index) => {\r\n    if (!chartData || chartData.length === 0 || index < 0 || index >= chartData.length) return null;\r\n    return chartData[index]?.date || null;\r\n  }, [chartData]);\r\n\r\n  const getIndexFromDate = useCallback((dateStr) => {\r\n    if (!chartData || chartData.length === 0 || !dateStr) return -1;\r\n    return chartData.findIndex(d => d.date === dateStr);\r\n  }, [chartData]);\r\n\r\n  const CustomTooltip = ({ active, payload, label }) => {\r\n    if (active && payload && payload.length) {\r\n      const dataPoint = chartData?.find(d => d.displayDate === label);\r\n\r\n      const formatDate = (dateStr) => new Date(dateStr).toLocaleDateString('en-US', {\r\n        weekday: 'short',\r\n        month: 'short',\r\n        day: 'numeric',\r\n        year: 'numeric'\r\n      });\r\n\r\n      const dateTag = chartTags?.find(t => t.date === label || t.date === dataPoint?.date);\r\n\r\n      return (\r\n        <div className=\"chart-tooltip\">\r\n          {displayMode === 'ly' ? (\r\n            <p className=\"tooltip-date\">{formatDate(dataPoint?.date_ly || label)}</p>\r\n          ) : displayMode === 'both' && dataPoint?.date && dataPoint?.date_ly ? (\r\n            <>\r\n              <p className=\"tooltip-date\">TY: {formatDate(dataPoint.date)}</p>\r\n              <p className=\"tooltip-date tooltip-date-ly\">LY: {formatDate(dataPoint.date_ly)}</p>\r\n            </>\r\n          ) : (\r\n            <p className=\"tooltip-date\">{formatDate(dataPoint?.date || label)}</p>\r\n          )}\r\n          {dateTag && (\r\n            <p className=\"tooltip-tag\">\r\n              <span className=\"tooltip-tag-marker\" style={{ background: dateTag.color }}></span>\r\n              {dateTag.name}\r\n            </p>\r\n          )}\r\n          {payload.map((entry, index) => (\r\n            <p key={index} className=\"tooltip-value\" style={{ color: entry.color }}>\r\n              <span className=\"tooltip-label\">{entry.name}: </span>\r\n              {formatValue(entry.value)}\r\n            </p>\r\n          ))}\r\n        </div>\r\n      );\r\n    }\r\n    return null;\r\n  };\r\n\r\n  const handleDragStart = (e, tag) => {\r\n    const tagForDrag = {\r\n      ...tag,\r\n      id: tag.id.startsWith('custom-') ? tag.id : tag.id\r\n    };\r\n    setDraggedTag(tagForDrag);\r\n    e.dataTransfer.effectAllowed = 'copy';\r\n    const img = new Image();\r\n    img.src = 'data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7';\r\n    e.dataTransfer.setDragImage(img, 0, 0);\r\n  };\r\n\r\n  const handleDragOver = (e) => {\r\n    e.preventDefault();\r\n    e.dataTransfer.dropEffect = 'copy';\r\n\r\n    if (!draggedTag || !chartData || chartData.length === 0) return;\r\n\r\n    const rect = getContainerRect();\r\n    if (!rect) return;\r\n\r\n    const dateIndex = getDateIndexFromX(e.clientX);\r\n    const targetDate = chartData[dateIndex]?.date;\r\n\r\n    const xPosition = getXPositionForIndex(dateIndex);\r\n\r\n    if (targetDate && dateIndex >= 0) {\r\n      setDragPreview({\r\n        date: targetDate,\r\n        formattedDate: formatFullDate(targetDate),\r\n        x: xPosition,\r\n        index: dateIndex,\r\n        tag: draggedTag\r\n      });\r\n    }\r\n  };\r\n\r\n  const handleDragLeave = (e) => {\r\n    const rect = chartContainerRef.current?.getBoundingClientRect();\r\n    if (rect) {\r\n      const { clientX, clientY } = e;\r\n      if (clientX < rect.left || clientX > rect.right ||\r\n          clientY < rect.top || clientY > rect.bottom) {\r\n        setDragPreview(null);\r\n      }\r\n    }\r\n  };\r\n\r\n  const handleDrop = (e) => {\r\n    e.preventDefault();\r\n    if (!draggedTag || !chartData || chartData.length === 0) return;\r\n\r\n    const dateIndex = getDateIndexFromX(e.clientX);\r\n    const targetDate = chartData[dateIndex]?.date;\r\n\r\n    if (targetDate) {\r\n      const uniqueId = `${draggedTag.id}-${Date.now()}-${Math.random().toString(36).substr(2, 9)}`;\r\n      \r\n      const newTag = {\r\n        ...draggedTag,\r\n        id: uniqueId,\r\n        date: targetDate,\r\n        startDate: targetDate,\r\n        endDate: targetDate,\r\n        dateIndex: dateIndex,\r\n        startIndex: dateIndex,\r\n        endIndex: dateIndex,\r\n        isSpan: false,\r\n        isManual: true,\r\n        createdAt: new Date().toISOString()\r\n      };\r\n\r\n      if (onTagsChange) {\r\n        onTagsChange([...(chartTags || []), newTag]);\r\n      }\r\n\r\n      setTimeout(() => {\r\n        setEditingTagId(uniqueId);\r\n        setEditingTagData({\r\n          name: newTag.name,\r\n          owner: newTag.owner || '',\r\n          description: newTag.description || '',\r\n          startDate: targetDate,\r\n          endDate: targetDate,\r\n          startIndex: dateIndex,\r\n          endIndex: dateIndex\r\n        });\r\n      }, 50);\r\n    }\r\n\r\n    setDraggedTag(null);\r\n    setDragPreview(null);\r\n  };\r\n\r\n  const handleDragEnd = () => {\r\n    setDragPreview(null);\r\n    setDraggedTag(null);\r\n  };\r\n\r\n  const handleAddCustomTag = () => {\r\n    if (!customTagName.trim() || !customTagOwner.trim()) return;\r\n\r\n    const newTag = {\r\n      id: `custom-${Date.now()}`,\r\n      name: customTagName.trim(),\r\n      owner: customTagOwner.trim(),\r\n      description: customTagDescription.trim() || '',\r\n      color: '#6e6e73',\r\n      isCustom: true\r\n    };\r\n\r\n    setDraggedTag(newTag);\r\n    setCustomTagName('');\r\n    setCustomTagOwner('');\r\n    setCustomTagDescription('');\r\n    setShowCustomForm(false);\r\n  };\r\n\r\n  const openTagEditor = useCallback((tagId, tag) => {\r\n    const tagIndex = tag.startIndex !== undefined ? tag.startIndex : \r\n                     (tag.dateIndex !== undefined ? tag.dateIndex : getIndexFromDate(tag.date));\r\n    const endIndex = tag.endIndex !== undefined ? tag.endIndex : tagIndex;\r\n    \r\n    setEditingTagId(tagId);\r\n    setEditingTagData({\r\n      name: tag.name || '',\r\n      owner: tag.owner || '',\r\n      description: tag.description || '',\r\n      startDate: tag.startDate || tag.date,\r\n      endDate: tag.endDate || tag.date,\r\n      startIndex: tagIndex,\r\n      endIndex: endIndex\r\n    });\r\n  }, [getIndexFromDate]);\r\n\r\n  const closeTagEditor = useCallback(() => {\r\n    setEditingTagId(null);\r\n    setEditingTagData(null);\r\n  }, []);\r\n\r\n  const handleTagLabelClick = useCallback((e, tagId, tag) => {\r\n    e.preventDefault();\r\n    e.stopPropagation();\r\n    \r\n    if (editingTagId === tagId) {\r\n      return;\r\n    }\r\n    \r\n    openTagEditor(tagId, tag);\r\n  }, [editingTagId, openTagEditor]);\r\n\r\n  const handleEditingDataChange = useCallback((field, value) => {\r\n    setEditingTagData(prev => prev ? { ...prev, [field]: value } : null);\r\n  }, []);\r\n\r\n  const handleStartDateChange = useCallback((newIndex) => {\r\n    if (!editingTagData || newIndex < 0 || newIndex >= chartData.length) return;\r\n    \r\n    const newStartDate = getDateFromIndex(newIndex);\r\n    if (!newStartDate) return;\r\n\r\n    let endIndex = editingTagData.endIndex;\r\n    if (newIndex > endIndex) {\r\n      endIndex = newIndex;\r\n    }\r\n\r\n    setEditingTagData(prev => prev ? {\r\n      ...prev,\r\n      startDate: newStartDate,\r\n      startIndex: newIndex,\r\n      endDate: getDateFromIndex(endIndex) || prev.endDate,\r\n      endIndex: endIndex\r\n    } : null);\r\n  }, [editingTagData, chartData.length, getDateFromIndex]);\r\n\r\n  const handleEndDateChange = useCallback((newIndex) => {\r\n    if (!editingTagData || newIndex < 0 || newIndex >= chartData.length) return;\r\n    \r\n    const newEndDate = getDateFromIndex(newIndex);\r\n    if (!newEndDate) return;\r\n\r\n    let startIndex = editingTagData.startIndex;\r\n    if (newIndex < startIndex) {\r\n      startIndex = newIndex;\r\n    }\r\n\r\n    setEditingTagData(prev => prev ? {\r\n      ...prev,\r\n      endDate: newEndDate,\r\n      endIndex: newIndex,\r\n      startDate: getDateFromIndex(startIndex) || prev.startDate,\r\n      startIndex: startIndex\r\n    } : null);\r\n  }, [editingTagData, chartData.length, getDateFromIndex]);\r\n\r\n  const handleSaveTagEdit = useCallback(() => {\r\n    if (!editingTagId || !editingTagData) return;\r\n\r\n    const isSpan = editingTagData.startIndex !== editingTagData.endIndex;\r\n\r\n    const updatedTags = (chartTags || []).map(tag => {\r\n      if (tag.id === editingTagId) {\r\n        return {\r\n          ...tag,\r\n          name: editingTagData.name,\r\n          owner: editingTagData.owner,\r\n          description: editingTagData.description,\r\n          startDate: editingTagData.startDate,\r\n          endDate: editingTagData.endDate,\r\n          date: editingTagData.startDate,\r\n          startIndex: editingTagData.startIndex,\r\n          endIndex: editingTagData.endIndex,\r\n          dateIndex: editingTagData.startIndex,\r\n          isSpan: isSpan,\r\n          adjustedStart: new Date(editingTagData.startDate + 'T00:00:00').toISOString(),\r\n          adjustedEnd: new Date(editingTagData.endDate + 'T00:00:00').toISOString(),\r\n          yearLabel: displayMode === 'ly' ? 'LY' : 'TY',\r\n          updatedAt: new Date().toISOString()\r\n        };\r\n      }\r\n      return tag;\r\n    });\r\n\r\n    if (onTagsChange) {\r\n      onTagsChange(updatedTags);\r\n    }\r\n\r\n    closeTagEditor();\r\n  }, [editingTagId, editingTagData, chartTags, displayMode, onTagsChange, closeTagEditor]);\r\n\r\n  const handleConvertToSpan = useCallback((e) => {\r\n    if (e) {\r\n      e.preventDefault();\r\n      e.stopPropagation();\r\n    }\r\n    if (!editingTagData) return;\r\n\r\n    const currentIndex = editingTagData.startIndex;\r\n    const defaultSpanDays = 3;\r\n    const newEndIndex = Math.min(currentIndex + defaultSpanDays, chartData.length - 1);\r\n    const newEndDate = getDateFromIndex(newEndIndex);\r\n\r\n    setEditingTagData(prev => prev ? {\r\n      ...prev,\r\n      endDate: newEndDate || prev.endDate,\r\n      endIndex: newEndIndex\r\n    } : null);\r\n  }, [editingTagData, chartData.length, getDateFromIndex]);\r\n\r\n  const handleConvertToPoint = useCallback((e) => {\r\n    if (e) {\r\n      e.preventDefault();\r\n      e.stopPropagation();\r\n    }\r\n    if (!editingTagData) return;\r\n\r\n    const startDate = editingTagData.startDate;\r\n    const startIndex = editingTagData.startIndex;\r\n\r\n    setEditingTagData(prev => prev ? {\r\n      ...prev,\r\n      endDate: startDate,\r\n      endIndex: startIndex\r\n    } : null);\r\n  }, [editingTagData]);\r\n\r\n  const handleRemoveTag = useCallback((tagId, e) => {\r\n    if (e) {\r\n      e.preventDefault();\r\n      e.stopPropagation();\r\n    }\r\n    \r\n    if (onTagsChange) {\r\n      onTagsChange((chartTags || []).filter(t => t.id !== tagId));\r\n    }\r\n    if (editingTagId === tagId) {\r\n      closeTagEditor();\r\n    }\r\n  }, [chartTags, editingTagId, onTagsChange, closeTagEditor]);\r\n\r\n  useEffect(() => {\r\n    try {\r\n      sessionStorage.setItem('dismissedEvents', JSON.stringify(dismissedEvents));\r\n    } catch { }\r\n  }, [dismissedEvents]);\r\n\r\n  const handleDismissEvent = (eventId) => {\r\n    setDismissedEvents(prev => [...prev, eventId]);\r\n  };\r\n\r\n  const handleResetDismissed = () => {\r\n    setDismissedEvents([]);\r\n  };\r\n\r\n  const pinnedEventIds = (chartTags || [])\r\n    .filter(tag => tag.sourceEventId)\r\n    .map(tag => tag.sourceEventId);\r\n\r\n  const getFilteredEvents = useCallback(() => {\r\n    if (!events || events.length === 0 || !chartData || chartData.length === 0) return [];\r\n\r\n    const chartStartDate = chartData[0]?.date;\r\n    const chartEndDate = chartData[chartData.length - 1]?.date;\r\n    if (!chartStartDate || !chartEndDate) return [];\r\n\r\n    const chartStart = new Date(chartStartDate + 'T00:00:00');\r\n    const chartEnd = new Date(chartEndDate + 'T00:00:00');\r\n\r\n    const yearLabel = displayMode === 'ly' ? 'LY' : 'TY';\r\n\r\n    return events\r\n      .filter(ev => !dismissedEvents.includes(ev.id))\r\n      .filter(ev => !pinnedEventIds.includes(ev.id))\r\n      .map(ev => {\r\n        let evStart = new Date(ev.startDate + 'T00:00:00');\r\n        let evEnd = new Date(ev.endDate + 'T00:00:00');\r\n\r\n        if (displayMode === 'ly') {\r\n          evStart = new Date(evStart.getTime() - 365 * 24 * 60 * 60 * 1000);\r\n          evEnd = new Date(evEnd.getTime() - 365 * 24 * 60 * 60 * 1000);\r\n        }\r\n\r\n        return { ...ev, adjustedStart: evStart, adjustedEnd: evEnd, yearLabel };\r\n      })\r\n      .filter(ev => ev.adjustedStart <= chartEnd && ev.adjustedEnd >= chartStart);\r\n  }, [events, chartData, displayMode, dismissedEvents, pinnedEventIds]);\r\n\r\n  const getIndexForDate = useCallback((targetDate) => {\r\n    if (!chartData || chartData.length === 0) return -1;\r\n    let bestIdx = 0;\r\n    let bestDiff = Infinity;\r\n    for (let i = 0; i < chartData.length; i++) {\r\n      const d = new Date(chartData[i].date + 'T00:00:00');\r\n      const diff = Math.abs(d.getTime() - targetDate.getTime());\r\n      if (diff < bestDiff) {\r\n        bestDiff = diff;\r\n        bestIdx = i;\r\n      }\r\n    }\r\n    return bestIdx;\r\n  }, [chartData]);\r\n\r\n  const renderCompactEditPopover = (tag, isInSpanLayer = false) => {\r\n    if (editingTagId !== tag.id || !editingTagData) return null;\r\n\r\n    const isSpan = editingTagData.startIndex !== editingTagData.endIndex;\r\n    const dayCount = editingTagData.endIndex - editingTagData.startIndex + 1;\r\n\r\n    const handlePopoverClick = (e) => {\r\n      e.preventDefault();\r\n      e.stopPropagation();\r\n    };\r\n\r\n    const handlePopoverMouseMove = (e) => {\r\n      e.stopPropagation();\r\n    };\r\n\r\n    return (\r\n      <div\r\n        className={`tag-edit-popover compact ${isInSpanLayer ? 'in-span-layer' : ''}`}\r\n        style={{ borderColor: tag.color }}\r\n        onClick={handlePopoverClick}\r\n        onMouseDown={handlePopoverClick}\r\n        onMouseMove={handlePopoverMouseMove}\r\n        onMouseEnter={handlePopoverClick}\r\n      >\r\n        <div className=\"edit-popover-header\">\r\n          <input\r\n            type=\"text\"\r\n            className=\"edit-name-input\"\r\n            value={editingTagData.name}\r\n            onChange={(e) => handleEditingDataChange('name', e.target.value)}\r\n            placeholder=\"Event name\"\r\n            onClick={(e) => e.stopPropagation()}\r\n            onMouseDown={(e) => e.stopPropagation()}\r\n          />\r\n          <button \r\n            className=\"edit-popover-close\" \r\n            onClick={(e) => { \r\n              e.preventDefault();\r\n              e.stopPropagation(); \r\n              closeTagEditor(); \r\n            }}\r\n          >\r\n            <svg width=\"14\" height=\"14\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" strokeWidth=\"2\">\r\n              <line x1=\"18\" y1=\"6\" x2=\"6\" y2=\"18\"></line>\r\n              <line x1=\"6\" y1=\"6\" x2=\"18\" y2=\"18\"></line>\r\n            </svg>\r\n          </button>\r\n        </div>\r\n\r\n        <div className=\"edit-row\">\r\n          <input\r\n            type=\"text\"\r\n            className=\"edit-field-small\"\r\n            value={editingTagData.owner}\r\n            onChange={(e) => handleEditingDataChange('owner', e.target.value)}\r\n            placeholder=\"Owner\"\r\n            onClick={(e) => e.stopPropagation()}\r\n            onMouseDown={(e) => e.stopPropagation()}\r\n          />\r\n          <input\r\n            type=\"text\"\r\n            className=\"edit-field-small\"\r\n            value={editingTagData.description}\r\n            onChange={(e) => handleEditingDataChange('description', e.target.value)}\r\n            placeholder=\"Note\"\r\n            onClick={(e) => e.stopPropagation()}\r\n            onMouseDown={(e) => e.stopPropagation()}\r\n          />\r\n        </div>\r\n\r\n        <div className=\"edit-date-row\" onClick={handlePopoverClick} onMouseDown={handlePopoverClick}>\r\n          <div className=\"date-control\">\r\n            <button \r\n              className=\"date-btn\"\r\n              onClick={(e) => { \r\n                e.preventDefault();\r\n                e.stopPropagation(); \r\n                handleStartDateChange(editingTagData.startIndex - 1); \r\n              }}\r\n              disabled={editingTagData.startIndex <= 0}\r\n            >-</button>\r\n            <span className=\"date-value\">{formatShortDate(editingTagData.startDate)}</span>\r\n            <button \r\n              className=\"date-btn\"\r\n              onClick={(e) => { \r\n                e.preventDefault();\r\n                e.stopPropagation(); \r\n                handleStartDateChange(editingTagData.startIndex + 1); \r\n              }}\r\n              disabled={editingTagData.startIndex >= chartData.length - 1}\r\n            >+</button>\r\n          </div>\r\n          \r\n          <span className=\"date-separator\">to</span>\r\n          \r\n          <div className=\"date-control\">\r\n            <button \r\n              className=\"date-btn\"\r\n              onClick={(e) => { \r\n                e.preventDefault();\r\n                e.stopPropagation(); \r\n                handleEndDateChange(editingTagData.endIndex - 1); \r\n              }}\r\n              disabled={editingTagData.endIndex <= 0}\r\n            >-</button>\r\n            <span className=\"date-value\">{formatShortDate(editingTagData.endDate)}</span>\r\n            <button \r\n              className=\"date-btn\"\r\n              onClick={(e) => { \r\n                e.preventDefault();\r\n                e.stopPropagation(); \r\n                handleEndDateChange(editingTagData.endIndex + 1); \r\n              }}\r\n              disabled={editingTagData.endIndex >= chartData.length - 1}\r\n            >+</button>\r\n          </div>\r\n          \r\n          <span className=\"day-count\">{dayCount}d</span>\r\n        </div>\r\n\r\n        <div className=\"edit-actions-row\" onClick={handlePopoverClick} onMouseDown={handlePopoverClick}>\r\n          {!isSpan ? (\r\n            <button \r\n              className=\"action-btn secondary\"\r\n              onClick={(e) => handleConvertToSpan(e)}\r\n            >\r\n              Make Span\r\n            </button>\r\n          ) : (\r\n            <button \r\n              className=\"action-btn secondary\"\r\n              onClick={(e) => handleConvertToPoint(e)}\r\n            >\r\n              Single Day\r\n            </button>\r\n          )}\r\n          <button \r\n            className=\"action-btn danger\"\r\n            onClick={(e) => handleRemoveTag(tag.id, e)}\r\n          >\r\n            Delete\r\n          </button>\r\n          <button \r\n            className=\"action-btn primary\"\r\n            onClick={(e) => { \r\n              e.preventDefault();\r\n              e.stopPropagation(); \r\n              handleSaveTagEdit(); \r\n            }}\r\n          >\r\n            Save\r\n          </button>\r\n        </div>\r\n      </div>\r\n    );\r\n  };\r\n\r\n  const renderSingleSpan = (ev, isPinned = false, isManualSpan = false) => {\r\n    const currentWidth = containerWidth || (chartContainerRef.current?.offsetWidth || 0);\r\n    if (currentWidth === 0) return null;\r\n\r\n    const chartAreaLeft = Y_AXIS_WIDTH + CHART_MARGINS.left;\r\n    const chartAreaWidth = currentWidth - chartAreaLeft - CHART_MARGINS.right;\r\n\r\n    let evStart, evEnd;\r\n    \r\n    if (isManualSpan) {\r\n      evStart = new Date(ev.startDate + 'T00:00:00');\r\n      evEnd = new Date(ev.endDate + 'T00:00:00');\r\n    } else {\r\n      evStart = isPinned ? new Date(ev.adjustedStart) : ev.adjustedStart;\r\n      evEnd = isPinned ? new Date(ev.adjustedEnd) : ev.adjustedEnd;\r\n    }\r\n\r\n    const startIdx = isManualSpan ? ev.startIndex : getIndexForDate(evStart);\r\n    const endIdx = isManualSpan ? ev.endIndex : getIndexForDate(evEnd);\r\n\r\n    const clampedStart = Math.max(0, startIdx);\r\n    const clampedEnd = Math.min(chartData.length - 1, endIdx);\r\n\r\n    const startPct = chartData.length === 1 ? 0.5 : clampedStart / (chartData.length - 1);\r\n    const endPct = chartData.length === 1 ? 0.5 : clampedEnd / (chartData.length - 1);\r\n\r\n    const leftPx = chartAreaLeft + startPct * chartAreaWidth;\r\n    const rightPx = chartAreaLeft + endPct * chartAreaWidth;\r\n    const widthPx = Math.max(rightPx - leftPx, 4);\r\n    const centerPx = leftPx + widthPx / 2;\r\n\r\n    const fillColor = hexToRgba(ev.color, 0.12);\r\n    const borderColor = hexToRgba(ev.color, 0.5);\r\n\r\n    const isBeingEdited = editingTagId === ev.id;\r\n    const spanLabel = ev.name || ev.label;\r\n    const yearLabel = ev.yearLabel || (displayMode === 'ly' ? 'LY' : 'TY');\r\n\r\n    const handleSpanClick = (e) => {\r\n      e.preventDefault();\r\n      e.stopPropagation();\r\n    };\r\n\r\n    return (\r\n      <div\r\n        key={ev.id}\r\n        className={`event-span ${isPinned || isManualSpan ? 'pinned' : ''} ${isBeingEdited ? 'editing' : ''}`}\r\n        style={{\r\n          left: `${leftPx}px`,\r\n          width: `${widthPx}px`,\r\n          background: fillColor,\r\n          borderLeft: `2px solid ${borderColor}`,\r\n          borderRight: `2px solid ${borderColor}`,\r\n        }}\r\n      >\r\n        <div\r\n          className=\"event-span-label\"\r\n          style={{ left: `${centerPx - leftPx}px`, background: ev.color }}\r\n          onClick={(e) => {\r\n            e.preventDefault();\r\n            e.stopPropagation();\r\n            if (isManualSpan) {\r\n              if (editingTagId !== ev.id) {\r\n                openTagEditor(ev.id, ev);\r\n              }\r\n            } else if (!isPinned) {\r\n              setEditingEvent(editingEvent?.id === ev.id ? null : ev);\r\n            }\r\n          }}\r\n          onMouseDown={handleSpanClick}\r\n        >\r\n          <span className=\"event-span-label-text\">\r\n            {spanLabel} ({yearLabel})\r\n          </span>\r\n          <button\r\n            className=\"event-span-dismiss\"\r\n            onClick={(e) => { \r\n              e.preventDefault();\r\n              e.stopPropagation(); \r\n              if (isPinned || isManualSpan) {\r\n                handleRemoveTag(ev.id, e);\r\n              } else {\r\n                handleDismissEvent(ev.id);\r\n              }\r\n            }}\r\n            title={isPinned || isManualSpan ? \"Remove\" : \"Dismiss\"}\r\n          >\r\n            x\r\n          </button>\r\n        </div>\r\n\r\n        {isManualSpan && isBeingEdited && renderCompactEditPopover(ev, true)}\r\n\r\n        {!isPinned && !isManualSpan && editingEvent?.id === ev.id && (\r\n          <div\r\n            className=\"event-span-edit\"\r\n            style={{ left: `${centerPx - leftPx}px` }}\r\n            onClick={handleSpanClick}\r\n            onMouseDown={handleSpanClick}\r\n            onMouseMove={handleSpanClick}\r\n            onMouseEnter={handleSpanClick}\r\n          >\r\n            <div className=\"event-span-edit-header\">\r\n              <strong>{ev.label}</strong>\r\n              <button \r\n                className=\"event-span-edit-close\" \r\n                onClick={(e) => { \r\n                  e.preventDefault();\r\n                  e.stopPropagation();\r\n                  setEditingEvent(null); \r\n                }}\r\n              >\r\n                x\r\n              </button>\r\n            </div>\r\n            <p className=\"event-span-edit-dates\">\r\n              {new Date(ev.adjustedStart).toLocaleDateString('en-US', { month: 'short', day: 'numeric' })}\r\n              {' - '}\r\n              {new Date(ev.adjustedEnd).toLocaleDateString('en-US', { month: 'short', day: 'numeric' })}\r\n            </p>\r\n            <p className=\"event-span-edit-tier\">\r\n              {ev.tier ? 'Tier 1 Event' : 'Tracked Event'}\r\n            </p>\r\n            <button\r\n              className=\"event-span-pin-btn\"\r\n              onClick={(e) => {\r\n                e.preventDefault();\r\n                e.stopPropagation();\r\n                if (onTagsChange) {\r\n                  onTagsChange([...(chartTags || []), {\r\n                    id: `pinned-${ev.id}-${Date.now()}`,\r\n                    name: ev.label,\r\n                    color: ev.color,\r\n                    sourceEventId: ev.id,\r\n                    isSpan: true,\r\n                    startDate: ev.startDate,\r\n                    endDate: ev.endDate,\r\n                    adjustedStart: ev.adjustedStart.toISOString(),\r\n                    adjustedEnd: ev.adjustedEnd.toISOString(),\r\n                    yearLabel: ev.yearLabel,\r\n                    tier: ev.tier,\r\n                    source: 'suggested'\r\n                  }]);\r\n                }\r\n                setEditingEvent(null);\r\n              }}\r\n            >\r\n              Pin to chart\r\n            </button>\r\n          </div>\r\n        )}\r\n      </div>\r\n    );\r\n  };\r\n\r\n  const getPinnedSpans = useCallback(() => {\r\n    if (!chartTags || !chartData || chartData.length === 0) return [];\r\n\r\n    const chartStartDate = chartData[0]?.date;\r\n    const chartEndDate = chartData[chartData.length - 1]?.date;\r\n    if (!chartStartDate || !chartEndDate) return [];\r\n\r\n    const chartStart = new Date(chartStartDate + 'T00:00:00');\r\n    const chartEnd = new Date(chartEndDate + 'T00:00:00');\r\n\r\n    return chartTags\r\n      .filter(tag => tag.isSpan && !tag.isManual)\r\n      .filter(tag => {\r\n        const tagStart = new Date(tag.adjustedStart);\r\n        const tagEnd = new Date(tag.adjustedEnd);\r\n        return tagStart <= chartEnd && tagEnd >= chartStart;\r\n      });\r\n  }, [chartTags, chartData]);\r\n\r\n  const getManualSpans = useCallback(() => {\r\n    if (!chartTags || !chartData || chartData.length === 0) return [];\r\n    return chartTags.filter(tag => tag.isSpan && tag.isManual);\r\n  }, [chartTags, chartData]);\r\n\r\n  const renderEventSpans = () => {\r\n    const currentWidth = containerWidth || (chartContainerRef.current?.offsetWidth || 0);\r\n    if (currentWidth === 0) return null;\r\n\r\n    const pinnedSpans = getPinnedSpans();\r\n    const manualSpans = getManualSpans();\r\n    const suggestedEvents = showSuggestedEvents ? getFilteredEvents() : [];\r\n\r\n    if (pinnedSpans.length === 0 && suggestedEvents.length === 0 && manualSpans.length === 0) return null;\r\n\r\n    return (\r\n      <>\r\n        {pinnedSpans.map(span => renderSingleSpan(span, true, false))}\r\n        {manualSpans.map(span => renderSingleSpan(span, false, true))}\r\n        {suggestedEvents.map(ev => renderSingleSpan(ev, false, false))}\r\n      </>\r\n    );\r\n  };\r\n\r\n  const commonProps = {\r\n    data: chartData,\r\n    margin: CHART_MARGINS\r\n  };\r\n\r\n  const axisStyle = {\r\n    fontSize: 11,\r\n    fill: '#86868b',\r\n    fontWeight: 500\r\n  };\r\n\r\n  const calculateTickInterval = () => {\r\n    if (!chartData || chartData.length <= 1) return 0;\r\n    const dataPoints = chartData.length;\r\n    const targetTicks = 7;\r\n    const interval = Math.max(0, Math.floor((dataPoints - 1) / (targetTicks - 1)) - 1);\r\n    return interval;\r\n  };\r\n\r\n  const tickInterval = calculateTickInterval();\r\n\r\n  const tyDataKey = hasComparison ? `${kpi}_ty` : kpi;\r\n  const lyDataKey = hasComparison ? `${kpi}_ly` : null;\r\n\r\n  const showTY = displayMode === 'both' || displayMode === 'ty';\r\n  const showLY = displayMode === 'both' || displayMode === 'ly';\r\n\r\n  const renderPlacedTags = () => {\r\n    if (!chartTags || chartTags.length === 0 || !chartData || chartData.length === 0) return null;\r\n\r\n    const pointTags = chartTags.filter(t => !t.isSpan);\r\n    if (pointTags.length === 0) return null;\r\n\r\n    const currentWidth = containerWidth || (chartContainerRef.current?.offsetWidth || 0);\r\n    if (currentWidth === 0) return null;\r\n\r\n    const poleHeight = CHART_HEIGHT - CHART_MARGINS.bottom - 40;\r\n\r\n    return pointTags.map((tag) => {\r\n      let dateIndex = tag.dateIndex;\r\n      if (dateIndex === undefined || dateIndex < 0 || dateIndex >= chartData.length) {\r\n        dateIndex = chartData.findIndex(d => d.date === tag.date);\r\n      }\r\n\r\n      if (dateIndex === -1 || dateIndex >= chartData.length) return null;\r\n\r\n      const xPos = getXPositionForIndex(dateIndex);\r\n      if (xPos === 0 && dateIndex !== 0) return null;\r\n\r\n      const isEditing = editingTagId === tag.id;\r\n      const yearLabel = tag.yearLabel || (displayMode === 'ly' ? 'LY' : 'TY');\r\n\r\n      return (\r\n        <div\r\n          key={tag.id}\r\n          className={`placed-tag-container ${isEditing ? 'editing' : ''}`}\r\n          style={{ left: `${xPos}px` }}\r\n        >\r\n          <div\r\n            className=\"tag-label clickable\"\r\n            style={{ background: tag.color }}\r\n            onClick={(e) => handleTagLabelClick(e, tag.id, tag)}\r\n            onMouseDown={(e) => { e.preventDefault(); e.stopPropagation(); }}\r\n          >\r\n            <span className=\"tag-label-text\">{tag.name} ({yearLabel})</span>\r\n            <button\r\n              className=\"tag-label-remove\"\r\n              onClick={(e) => handleRemoveTag(tag.id, e)}\r\n              title=\"Remove tag\"\r\n            >\r\n              x\r\n            </button>\r\n          </div>\r\n\r\n          {isEditing && renderCompactEditPopover(tag, false)}\r\n\r\n          <div\r\n            className=\"tag-pole\"\r\n            style={{\r\n              background: tag.color,\r\n              height: poleHeight\r\n            }}\r\n          ></div>\r\n          <div className=\"tag-date\" style={{ color: tag.color }}>\r\n            {formatAxisDate(tag.date)}\r\n          </div>\r\n        </div>\r\n      );\r\n    });\r\n  };\r\n\r\n  const renderDragPreview = () => {\r\n    if (!dragPreview || dragPreview.x === 0) return null;\r\n\r\n    const poleHeight = CHART_HEIGHT - CHART_MARGINS.bottom - 40;\r\n\r\n    return (\r\n      <div\r\n        className=\"drag-preview-container\"\r\n        style={{ left: `${dragPreview.x}px` }}\r\n      >\r\n        <div className=\"tag-label preview\" style={{ background: dragPreview.tag.color }}>\r\n          <span className=\"tag-label-text\">{dragPreview.tag.name}</span>\r\n        </div>\r\n        <div\r\n          className=\"tag-pole preview\"\r\n          style={{\r\n            borderColor: dragPreview.tag.color,\r\n            height: poleHeight\r\n          }}\r\n        ></div>\r\n        <div className=\"tag-date preview\" style={{ color: dragPreview.tag.color }}>\r\n          {dragPreview.formattedDate}\r\n        </div>\r\n      </div>\r\n    );\r\n  };\r\n\r\n  const renderChart = () => {\r\n    switch (chartType) {\r\n      case 'area':\r\n        return (\r\n          <AreaChart {...commonProps}>\r\n            <defs>\r\n              <linearGradient id=\"areaGradientTY\" x1=\"0\" y1=\"0\" x2=\"0\" y2=\"1\">\r\n                <stop offset=\"0%\" stopColor=\"#F96302\" stopOpacity={0.25}/>\r\n                <stop offset=\"100%\" stopColor=\"#F96302\" stopOpacity={0}/>\r\n              </linearGradient>\r\n              <linearGradient id=\"areaGradientLY\" x1=\"0\" y1=\"0\" x2=\"0\" y2=\"1\">\r\n                <stop offset=\"0%\" stopColor=\"#86868b\" stopOpacity={0.15}/>\r\n                <stop offset=\"100%\" stopColor=\"#86868b\" stopOpacity={0}/>\r\n              </linearGradient>\r\n            </defs>\r\n            <CartesianGrid strokeDasharray=\"3 3\" stroke=\"rgba(0,0,0,0.04)\" vertical={false} />\r\n            <XAxis\r\n              dataKey=\"displayDate\"\r\n              tick={axisStyle}\r\n              tickLine={false}\r\n              axisLine={{ stroke: 'rgba(0,0,0,0.08)' }}\r\n              tickFormatter={formatAxisDate}\r\n              interval={tickInterval}\r\n            />\r\n            <YAxis\r\n              tick={axisStyle}\r\n              tickLine={false}\r\n              axisLine={false}\r\n              tickFormatter={formatValue}\r\n              width={Y_AXIS_WIDTH}\r\n            />\r\n            <Tooltip content={<CustomTooltip />} />\r\n            {hasComparison && <Legend />}\r\n            {launchDate && showTY && (\r\n              <ReferenceLine\r\n                x={launchDate}\r\n                stroke=\"#F96302\"\r\n                strokeDasharray=\"4 4\"\r\n                strokeWidth={2}\r\n                label={{\r\n                  value: 'Launch',\r\n                  position: 'top',\r\n                  fill: '#F96302',\r\n                  fontSize: 11,\r\n                  fontWeight: 600\r\n                }}\r\n              />\r\n            )}\r\n            {hasComparison && lyDataKey && showLY && (\r\n              <Area\r\n                type=\"monotone\"\r\n                dataKey={lyDataKey}\r\n                name=\"Last Year\"\r\n                stroke=\"#86868b\"\r\n                strokeWidth={1.5}\r\n                strokeDasharray=\"4 4\"\r\n                fill=\"url(#areaGradientLY)\"\r\n                dot={false}\r\n                activeDot={{ r: 4, fill: '#86868b', stroke: '#fff', strokeWidth: 2 }}\r\n              />\r\n            )}\r\n            {showTY && (\r\n              <Area\r\n                type=\"monotone\"\r\n                dataKey={tyDataKey}\r\n                name={hasComparison ? \"This Year\" : kpi}\r\n                stroke=\"#F96302\"\r\n                strokeWidth={2}\r\n                fill=\"url(#areaGradientTY)\"\r\n                dot={false}\r\n                activeDot={{ r: 5, fill: '#F96302', stroke: '#fff', strokeWidth: 2 }}\r\n              />\r\n            )}\r\n          </AreaChart>\r\n        );\r\n\r\n      case 'bar':\r\n        return (\r\n          <BarChart {...commonProps}>\r\n            <CartesianGrid strokeDasharray=\"3 3\" stroke=\"rgba(0,0,0,0.04)\" vertical={false} />\r\n            <XAxis\r\n              dataKey=\"displayDate\"\r\n              tick={axisStyle}\r\n              tickLine={false}\r\n              axisLine={{ stroke: 'rgba(0,0,0,0.08)' }}\r\n              tickFormatter={formatAxisDate}\r\n              interval={tickInterval}\r\n            />\r\n            <YAxis\r\n              tick={axisStyle}\r\n              tickLine={false}\r\n              axisLine={false}\r\n              tickFormatter={formatValue}\r\n              width={Y_AXIS_WIDTH}\r\n            />\r\n            <Tooltip content={<CustomTooltip />} />\r\n            {hasComparison && <Legend />}\r\n            {launchDate && showTY && (\r\n              <ReferenceLine\r\n                x={launchDate}\r\n                stroke=\"#F96302\"\r\n                strokeDasharray=\"4 4\"\r\n                strokeWidth={2}\r\n              />\r\n            )}\r\n            {hasComparison && lyDataKey && showLY && (\r\n              <Bar\r\n                dataKey={lyDataKey}\r\n                name=\"Last Year\"\r\n                fill=\"#d1d1d6\"\r\n                radius={[4, 4, 0, 0]}\r\n                maxBarSize={20}\r\n              />\r\n            )}\r\n            {showTY && (\r\n              <Bar\r\n                dataKey={tyDataKey}\r\n                name={hasComparison ? \"This Year\" : kpi}\r\n                fill=\"#F96302\"\r\n                radius={[4, 4, 0, 0]}\r\n                maxBarSize={hasComparison ? 20 : 40}\r\n              />\r\n            )}\r\n          </BarChart>\r\n        );\r\n\r\n      default:\r\n        return (\r\n          <LineChart {...commonProps}>\r\n            <CartesianGrid strokeDasharray=\"3 3\" stroke=\"rgba(0,0,0,0.04)\" vertical={false} />\r\n            <XAxis\r\n              dataKey=\"displayDate\"\r\n              tick={axisStyle}\r\n              tickLine={false}\r\n              axisLine={{ stroke: 'rgba(0,0,0,0.08)' }}\r\n              tickFormatter={formatAxisDate}\r\n              interval={tickInterval}\r\n            />\r\n            <YAxis\r\n              tick={axisStyle}\r\n              tickLine={false}\r\n              axisLine={false}\r\n              tickFormatter={formatValue}\r\n              width={Y_AXIS_WIDTH}\r\n            />\r\n            <Tooltip content={<CustomTooltip />} />\r\n            {hasComparison && <Legend />}\r\n            {launchDate && showTY && (\r\n              <ReferenceLine\r\n                x={launchDate}\r\n                stroke=\"#F96302\"\r\n                strokeDasharray=\"4 4\"\r\n                strokeWidth={2}\r\n                label={{\r\n                  value: 'Launch',\r\n                  position: 'top',\r\n                  fill: '#F96302',\r\n                  fontSize: 11,\r\n                  fontWeight: 600\r\n                }}\r\n              />\r\n            )}\r\n            {hasComparison && lyDataKey && showLY && (\r\n              <Line\r\n                type=\"monotone\"\r\n                dataKey={lyDataKey}\r\n                name=\"Last Year\"\r\n                stroke=\"#86868b\"\r\n                strokeWidth={1.5}\r\n                strokeDasharray=\"4 4\"\r\n                dot={false}\r\n                activeDot={{ r: 4, fill: '#86868b', stroke: '#fff', strokeWidth: 2 }}\r\n              />\r\n            )}\r\n            {showTY && (\r\n              <Line\r\n                type=\"monotone\"\r\n                dataKey={tyDataKey}\r\n                name={hasComparison ? \"This Year\" : kpi}\r\n                stroke=\"#F96302\"\r\n                strokeWidth={2}\r\n                dot={false}\r\n                activeDot={{ r: 5, fill: '#F96302', stroke: '#fff', strokeWidth: 2 }}\r\n              />\r\n            )}\r\n          </LineChart>\r\n        );\r\n    }\r\n  };\r\n\r\n  if (!chartData || chartData.length === 0) {\r\n    return (\r\n      <div className=\"chart-empty\">\r\n        <p>No data available for the selected period</p>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  if (isBeta) {\r\n    return (\r\n      <div className=\"kpi-chart beta-restricted\">\r\n        <div className=\"chart-blur-wrapper\">\r\n          <ResponsiveContainer width=\"100%\" height={320}>\r\n            {renderChart()}\r\n          </ResponsiveContainer>\r\n        </div>\r\n        <div className=\"beta-overlay\">\r\n          <div className=\"beta-overlay-content\">\r\n            <h3>Place holder</h3>\r\n            <p>Chart visualization</p>\r\n          </div>\r\n        </div>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  const isEditingActive = editingTagId || editingEvent;\r\n\r\n  return (\r\n    <div className=\"kpi-chart-wrapper\">\r\n      <div\r\n        className={`kpi-chart ${draggedTag ? 'drop-active' : ''} ${isEditingActive ? 'editing-active' : ''}`}\r\n        ref={chartContainerRef}\r\n        onDragOver={handleDragOver}\r\n        onDragLeave={handleDragLeave}\r\n        onDrop={handleDrop}\r\n      >\r\n        <div className=\"tag-area\">\r\n          {renderPlacedTags()}\r\n          {dragPreview && renderDragPreview()}\r\n        </div>\r\n\r\n        <div\r\n          className={`event-spans-layer ${isEditingActive ? 'has-editing' : ''}`}\r\n          style={{ height: `${PLOT_AREA_HEIGHT}px` }}\r\n        >\r\n          {renderEventSpans()}\r\n        </div>\r\n\r\n        {isEditingActive && (\r\n          <div\r\n            className=\"chart-interaction-blocker\"\r\n            onClick={(e) => { e.stopPropagation(); }}\r\n            onMouseMove={(e) => { e.stopPropagation(); }}\r\n          />\r\n        )}\r\n\r\n        <ResponsiveContainer width=\"100%\" height={320}>\r\n          {renderChart()}\r\n        </ResponsiveContainer>\r\n      </div>\r\n\r\n      <div className=\"chart-tag-controls\">\r\n        <button\r\n          className={`tag-panel-toggle ${showTagPanel ? 'active' : ''}`}\r\n          onClick={() => setShowTagPanel(!showTagPanel)}\r\n        >\r\n          <svg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" strokeWidth=\"2\" strokeLinecap=\"round\" strokeLinejoin=\"round\">\r\n            <path d=\"M20.59 13.41l-7.17 7.17a2 2 0 0 1-2.83 0L2 12V2h10l8.59 8.59a2 2 0 0 1 0 2.82z\"></path>\r\n            <line x1=\"7\" y1=\"7\" x2=\"7.01\" y2=\"7\"></line>\r\n          </svg>\r\n          <span>Add Tag</span>\r\n        </button>\r\n\r\n        {chartTags && chartTags.length > 0 && (() => {\r\n          const pinnedEvents = chartTags.filter(tag => tag.source === 'suggested');\r\n          const manualTags = chartTags.filter(tag => tag.source !== 'suggested');\r\n\r\n          const renderPill = (tag) => (\r\n            <span\r\n              key={tag.id}\r\n              className={`active-tag-pill ${editingTagId === tag.id ? 'editing' : ''}`}\r\n              style={{ '--tag-color': tag.color }}\r\n              onClick={(e) => {\r\n                e.preventDefault();\r\n                e.stopPropagation();\r\n                openTagEditor(tag.id, tag);\r\n              }}\r\n            >\r\n              <span className=\"pill-dot\" style={{ background: tag.color }}></span>\r\n              <span className=\"pill-name\">{tag.name}</span>\r\n              {tag.isSpan && (\r\n                <span className=\"pill-range\">\r\n                  {formatShortDate(tag.startDate)}-{formatShortDate(tag.endDate)}\r\n                </span>\r\n              )}\r\n              {!tag.isSpan && (\r\n                <span className=\"pill-date\">{formatShortDate(tag.date)}</span>\r\n              )}\r\n              <button\r\n                className=\"pill-remove\"\r\n                onClick={(e) => handleRemoveTag(tag.id, e)}\r\n              >\r\n                <svg width=\"10\" height=\"10\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" strokeWidth=\"3\">\r\n                  <line x1=\"18\" y1=\"6\" x2=\"6\" y2=\"18\"></line>\r\n                  <line x1=\"6\" y1=\"6\" x2=\"18\" y2=\"18\"></line>\r\n                </svg>\r\n              </button>\r\n            </span>\r\n          );\r\n\r\n          return (\r\n            <div className=\"active-tags-list\">\r\n              {pinnedEvents.length > 0 && (\r\n                <>\r\n                  <span className=\"tags-section-label pinned\">Suggested Events</span>\r\n                  {pinnedEvents.map(renderPill)}\r\n                </>\r\n              )}\r\n              {pinnedEvents.length > 0 && manualTags.length > 0 && (\r\n                <span className=\"tags-separator\"></span>\r\n              )}\r\n              {manualTags.length > 0 && (\r\n                <>\r\n                  <span className=\"tags-section-label manual\">User Added</span>\r\n                  {manualTags.map(renderPill)}\r\n                </>\r\n              )}\r\n            </div>\r\n          );\r\n        })()}\r\n      </div>\r\n\r\n      {showTagPanel && (\r\n        <div className=\"tag-panel\">\r\n          <div className=\"tag-panel-header\">\r\n            <h4>Add Event Tag</h4>\r\n            <button className=\"tag-panel-close\" onClick={() => setShowTagPanel(false)}>\r\n              <svg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" strokeWidth=\"2\">\r\n                <line x1=\"18\" y1=\"6\" x2=\"6\" y2=\"18\"></line>\r\n                <line x1=\"6\" y1=\"6\" x2=\"18\" y2=\"18\"></line>\r\n              </svg>\r\n            </button>\r\n          </div>\r\n\r\n          <p className=\"tag-panel-hint\">\r\n            Drag a tag onto the chart. Click to edit dates and convert to a span.\r\n          </p>\r\n\r\n          {dismissedEvents.length > 0 && (\r\n            <button className=\"reset-dismissed-btn\" onClick={handleResetDismissed}>\r\n              Restore {dismissedEvents.length} dismissed\r\n            </button>\r\n          )}\r\n\r\n          <div className=\"preset-tags\">\r\n            {PRESET_TAGS.map(tag => (\r\n              <div\r\n                key={tag.id}\r\n                className=\"draggable-tag\"\r\n                draggable\r\n                onDragStart={(e) => handleDragStart(e, tag)}\r\n                onDragEnd={handleDragEnd}\r\n                style={{ borderColor: tag.color }}\r\n              >\r\n                <span className=\"tag-marker\" style={{ background: tag.color }}></span>\r\n                {tag.name}\r\n              </div>\r\n            ))}\r\n          </div>\r\n\r\n          <div className=\"custom-tag-section\">\r\n            {!showCustomForm ? (\r\n              <button\r\n                className=\"add-custom-tag-btn\"\r\n                onClick={() => setShowCustomForm(true)}\r\n              >\r\n                <svg width=\"14\" height=\"14\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" strokeWidth=\"2\">\r\n                  <line x1=\"12\" y1=\"5\" x2=\"12\" y2=\"19\"></line>\r\n                  <line x1=\"5\" y1=\"12\" x2=\"19\" y2=\"12\"></line>\r\n                </svg>\r\n                Custom Tag\r\n              </button>\r\n            ) : (\r\n              <div className=\"custom-tag-form\">\r\n                <div className=\"custom-form-row\">\r\n                  <input\r\n                    type=\"text\"\r\n                    placeholder=\"Tag name\"\r\n                    value={customTagName}\r\n                    onChange={(e) => setCustomTagName(e.target.value)}\r\n                    className=\"custom-tag-input\"\r\n                  />\r\n                  <input\r\n                    type=\"text\"\r\n                    placeholder=\"Owner\"\r\n                    value={customTagOwner}\r\n                    onChange={(e) => setCustomTagOwner(e.target.value)}\r\n                    className=\"custom-tag-input\"\r\n                  />\r\n                </div>\r\n                <input\r\n                  type=\"text\"\r\n                  placeholder=\"Description (optional)\"\r\n                  value={customTagDescription}\r\n                  onChange={(e) => setCustomTagDescription(e.target.value)}\r\n                  className=\"custom-tag-input full\"\r\n                />\r\n                <div className=\"custom-tag-actions\">\r\n                  <button\r\n                    className=\"custom-tag-cancel\"\r\n                    onClick={() => {\r\n                      setShowCustomForm(false);\r\n                      setCustomTagName('');\r\n                      setCustomTagOwner('');\r\n                      setCustomTagDescription('');\r\n                    }}\r\n                  >\r\n                    Cancel\r\n                  </button>\r\n                  <button\r\n                    className=\"custom-tag-create\"\r\n                    onClick={handleAddCustomTag}\r\n                    disabled={!customTagName.trim() || !customTagOwner.trim()}\r\n                  >\r\n                    Create\r\n                  </button>\r\n                </div>\r\n              </div>\r\n            )}\r\n          </div>\r\n\r\n          {draggedTag && draggedTag.isCustom && (\r\n            <div className=\"drag-instruction\">\r\n              <p>Drag \"{draggedTag.name}\" onto the chart:</p>\r\n              <div\r\n                className=\"draggable-tag custom\"\r\n                draggable\r\n                onDragStart={(e) => handleDragStart(e, draggedTag)}\r\n                onDragEnd={handleDragEnd}\r\n              >\r\n                <span className=\"tag-marker\" style={{ background: draggedTag.color }}></span>\r\n                {draggedTag.name}\r\n              </div>\r\n            </div>\r\n          )}\r\n        </div>\r\n      )}\r\n    </div>\r\n  );\r\n}\r\n\r\nexport default KPIChart;\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}