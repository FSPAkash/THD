{"ast":null,"code":"import _objectSpread from\"C:/Users/AkashPatil/THD-Dashboard/frontend/node_modules/@babel/runtime/helpers/esm/objectSpread2.js\";import{useState,useRef,useCallback,useEffect}from'react';import{LineChart,Line,AreaChart,Area,BarChart,Bar,XAxis,YAxis,CartesianGrid,Tooltip,ResponsiveContainer,ReferenceLine,Legend}from'recharts';import{useAuth}from'../context/AuthContext';import'./KPIChart.css';// Preset event tags - these are for manual tagging of events NOT in the Event Tracker\n// Events like Black Friday, Labor Day, etc. come from the Event Tracker automatically\nimport{jsx as _jsx,jsxs as _jsxs,Fragment as _Fragment}from\"react/jsx-runtime\";const PRESET_TAGS=[{id:'thanksgiving',name:'Thanksgiving',color:'#F96302'},{id:'july4th',name:'4th of July',color:'#FF3B30'},{id:'tier1',name:'Tier 1 Event',color:'#5856D6'},{id:'promo',name:'Promo',color:'#34C759'},{id:'outage',name:'Outage/Issue',color:'#FF2D55'}];// Chart margins matching Recharts config\nconst CHART_MARGINS={top:20,right:20,left:10,bottom:20};const Y_AXIS_WIDTH=60;const CHART_HEIGHT=320;// Height of the actual plot area (excluding X-axis labels ~30px and Legend ~24px)\nconst PLOT_AREA_HEIGHT=CHART_HEIGHT-CHART_MARGINS.top-CHART_MARGINS.bottom-54;// Convert hex color string to rgba with given alpha\nfunction hexToRgba(hex,alpha){const r=parseInt(hex.slice(1,3),16);const g=parseInt(hex.slice(3,5),16);const b=parseInt(hex.slice(5,7),16);return\"rgba(\".concat(r,\",\").concat(g,\",\").concat(b,\",\").concat(alpha,\")\");}function KPIChart(_ref){let{data,kpi,chartType,format,launchDate,comparisonData,chartTags,onTagsChange,displayMode='both',events=[]}=_ref;const{isBetaMode}=useAuth();const isBeta=isBetaMode();const chartContainerRef=useRef(null);const[showTagPanel,setShowTagPanel]=useState(false);const[customTagName,setCustomTagName]=useState('');const[customTagOwner,setCustomTagOwner]=useState('');const[customTagDescription,setCustomTagDescription]=useState('');const[draggedTag,setDraggedTag]=useState(null);const[showCustomForm,setShowCustomForm]=useState(false);const[dragPreview,setDragPreview]=useState(null);const[containerWidth,setContainerWidth]=useState(0);const[expandedTagId,setExpandedTagId]=useState(null);const[showSuggestedEvents,setShowSuggestedEvents]=useState(false);const[dismissedEvents,setDismissedEvents]=useState(()=>{try{const stored=sessionStorage.getItem('dismissedEvents');return stored?JSON.parse(stored):[];}catch(_unused){return[];}});const[editingEvent,setEditingEvent]=useState(null);// Use comparison data if available, otherwise fall back to regular data\nconst rawChartData=comparisonData&&comparisonData.length>0?comparisonData:data;const hasComparison=comparisonData&&comparisonData.length>0;// Add displayDate field based on displayMode\n// When showing LY only, use date_ly for X-axis; otherwise use date (TY)\nconst chartData=(rawChartData===null||rawChartData===void 0?void 0:rawChartData.map(d=>_objectSpread(_objectSpread({},d),{},{displayDate:displayMode==='ly'&&d.date_ly?d.date_ly:d.date})))||[];// Track container width for tag positioning\nuseEffect(()=>{const updateWidth=()=>{if(chartContainerRef.current){const width=chartContainerRef.current.offsetWidth;if(width>0){setContainerWidth(width);}}};// Initial update with a slight delay to ensure DOM is ready\nupdateWidth();const initialTimeout=setTimeout(updateWidth,100);const secondTimeout=setTimeout(updateWidth,300);window.addEventListener('resize',updateWidth);// Also observe size changes\nconst resizeObserver=new ResizeObserver(()=>{// Use requestAnimationFrame to avoid layout thrashing\nrequestAnimationFrame(()=>{updateWidth();});});if(chartContainerRef.current){resizeObserver.observe(chartContainerRef.current);}return()=>{clearTimeout(initialTimeout);clearTimeout(secondTimeout);window.removeEventListener('resize',updateWidth);resizeObserver.disconnect();};},[]);// Force width recalculation when chartTags change (ensures tags render properly)\nuseEffect(()=>{if(chartTags&&chartTags.length>0&&chartContainerRef.current){const width=chartContainerRef.current.offsetWidth;if(width>0&&containerWidth!==width){setContainerWidth(width);}}},[chartTags,containerWidth]);const formatValue=val=>{if(val===null||val===undefined||isNaN(val))return'-';if(format==='currency'){if(Math.abs(val)>=1000000){return\"$\".concat((val/1000000).toFixed(1),\"M\");}if(Math.abs(val)>=1000){return\"$\".concat((val/1000).toFixed(0),\"K\");}return\"$\".concat(val.toFixed(2));}if(format==='percentage'){return\"\".concat((val*100).toFixed(2),\"%\");}if(Math.abs(val)>=1000000){return\"\".concat((val/1000000).toFixed(1),\"M\");}if(Math.abs(val)>=1000){return\"\".concat((val/1000).toFixed(0),\"K\");}return val.toLocaleString();};const formatAxisDate=dateStr=>{const date=new Date(dateStr);return date.toLocaleDateString('en-US',{month:'short',day:'numeric'});};const formatFullDate=dateStr=>{const date=new Date(dateStr);return date.toLocaleDateString('en-US',{weekday:'short',month:'short',day:'numeric',year:'numeric'});};// Get container rect - always fresh to handle dynamic sizing\nconst getContainerRect=useCallback(()=>{if(!chartContainerRef.current)return null;return chartContainerRef.current.getBoundingClientRect();},[]);// Calculate date index from clientX position\nconst getDateIndexFromX=useCallback(clientX=>{if(!chartData||chartData.length===0)return-1;const rect=getContainerRect();if(!rect)return-1;const chartAreaLeft=Y_AXIS_WIDTH+CHART_MARGINS.left;const chartAreaWidth=rect.width-chartAreaLeft-CHART_MARGINS.right;const relativeX=clientX-rect.left-chartAreaLeft;const percentage=Math.max(0,Math.min(1,relativeX/chartAreaWidth));const dataIndex=Math.round(percentage*(chartData.length-1));return Math.max(0,Math.min(dataIndex,chartData.length-1));},[chartData,getContainerRect]);// Get x position (relative to container) for a data index\nconst getXPositionForIndex=useCallback(index=>{var _chartContainerRef$cu;if(!chartData||chartData.length===0||index<0)return 0;// Use containerWidth state for reliable positioning\nconst width=containerWidth||((_chartContainerRef$cu=chartContainerRef.current)===null||_chartContainerRef$cu===void 0?void 0:_chartContainerRef$cu.offsetWidth)||0;if(width===0)return 0;const chartAreaLeft=Y_AXIS_WIDTH+CHART_MARGINS.left;const chartAreaWidth=width-chartAreaLeft-CHART_MARGINS.right;// Handle single data point\nif(chartData.length===1){return chartAreaLeft+chartAreaWidth/2;}const percentage=index/(chartData.length-1);return chartAreaLeft+percentage*chartAreaWidth;},[chartData,containerWidth]);const CustomTooltip=_ref2=>{let{active,payload,label}=_ref2;if(active&&payload&&payload.length){// Find the data point to access both TY and LY dates\nconst dataPoint=chartData===null||chartData===void 0?void 0:chartData.find(d=>d.displayDate===label);// Format dates based on what's being shown\nconst formatDate=dateStr=>new Date(dateStr).toLocaleDateString('en-US',{weekday:'short',month:'short',day:'numeric',year:'numeric'});// Check if there's a tag for this date\nconst dateTag=chartTags===null||chartTags===void 0?void 0:chartTags.find(t=>t.date===label||t.date===(dataPoint===null||dataPoint===void 0?void 0:dataPoint.date));return/*#__PURE__*/_jsxs(\"div\",{className:\"chart-tooltip\",children:[displayMode==='ly'?/*#__PURE__*/_jsx(\"p\",{className:\"tooltip-date\",children:formatDate((dataPoint===null||dataPoint===void 0?void 0:dataPoint.date_ly)||label)}):displayMode==='both'&&dataPoint!==null&&dataPoint!==void 0&&dataPoint.date&&dataPoint!==null&&dataPoint!==void 0&&dataPoint.date_ly?/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsxs(\"p\",{className:\"tooltip-date\",children:[\"TY: \",formatDate(dataPoint.date)]}),/*#__PURE__*/_jsxs(\"p\",{className:\"tooltip-date tooltip-date-ly\",children:[\"LY: \",formatDate(dataPoint.date_ly)]})]}):/*#__PURE__*/_jsx(\"p\",{className:\"tooltip-date\",children:formatDate((dataPoint===null||dataPoint===void 0?void 0:dataPoint.date)||label)}),dateTag&&/*#__PURE__*/_jsxs(\"p\",{className:\"tooltip-tag\",children:[/*#__PURE__*/_jsx(\"span\",{className:\"tooltip-tag-marker\",style:{background:dateTag.color}}),dateTag.name]}),payload.map((entry,index)=>/*#__PURE__*/_jsxs(\"p\",{className:\"tooltip-value\",style:{color:entry.color},children:[/*#__PURE__*/_jsxs(\"span\",{className:\"tooltip-label\",children:[entry.name,\": \"]}),formatValue(entry.value)]},index))]});}return null;};const handleDragStart=(e,tag)=>{setDraggedTag(tag);e.dataTransfer.effectAllowed='copy';// Set a transparent drag image\nconst img=new Image();img.src='data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7';e.dataTransfer.setDragImage(img,0,0);};const handleDragOver=e=>{var _chartData$dateIndex;e.preventDefault();e.dataTransfer.dropEffect='copy';if(!draggedTag||!chartData||chartData.length===0)return;const rect=getContainerRect();if(!rect)return;const dateIndex=getDateIndexFromX(e.clientX);const targetDate=(_chartData$dateIndex=chartData[dateIndex])===null||_chartData$dateIndex===void 0?void 0:_chartData$dateIndex.date;// Calculate position relative to container for display\nconst xPosition=getXPositionForIndex(dateIndex);if(targetDate&&dateIndex>=0){setDragPreview({date:targetDate,formattedDate:formatFullDate(targetDate),x:xPosition,index:dateIndex,tag:draggedTag});}};const handleDragLeave=e=>{var _chartContainerRef$cu2;// Only clear preview if we're actually leaving the chart area\nconst rect=(_chartContainerRef$cu2=chartContainerRef.current)===null||_chartContainerRef$cu2===void 0?void 0:_chartContainerRef$cu2.getBoundingClientRect();if(rect){const{clientX,clientY}=e;if(clientX<rect.left||clientX>rect.right||clientY<rect.top||clientY>rect.bottom){setDragPreview(null);}}};const handleDrop=e=>{var _chartData$dateIndex2;e.preventDefault();if(!draggedTag||!chartData||chartData.length===0)return;const dateIndex=getDateIndexFromX(e.clientX);const targetDate=(_chartData$dateIndex2=chartData[dateIndex])===null||_chartData$dateIndex2===void 0?void 0:_chartData$dateIndex2.date;if(targetDate){const newTag=_objectSpread(_objectSpread({},draggedTag),{},{id:\"\".concat(draggedTag.id,\"-\").concat(Date.now()),date:targetDate,dateIndex:dateIndex});if(onTagsChange){onTagsChange([...(chartTags||[]),newTag]);}}setDraggedTag(null);setDragPreview(null);};const handleDragEnd=()=>{setDragPreview(null);};const handleAddCustomTag=()=>{if(!customTagName.trim()||!customTagOwner.trim())return;const newTag={id:\"custom-\".concat(Date.now()),name:customTagName.trim(),owner:customTagOwner.trim(),description:customTagDescription.trim()||'',color:'#6e6e73',isCustom:true};setDraggedTag(newTag);setCustomTagName('');setCustomTagOwner('');setCustomTagDescription('');setShowCustomForm(false);};const handleTagClick=tagId=>{setExpandedTagId(expandedTagId===tagId?null:tagId);};const handleRemoveTag=tagId=>{if(onTagsChange){onTagsChange((chartTags||[]).filter(t=>t.id!==tagId));}};// Persist dismissedEvents to sessionStorage whenever they change\nuseEffect(()=>{try{sessionStorage.setItem('dismissedEvents',JSON.stringify(dismissedEvents));}catch(_unused2){/* ignore */}},[dismissedEvents]);// Dismiss a suggested event (session-scoped)\nconst handleDismissEvent=eventId=>{setDismissedEvents(prev=>[...prev,eventId]);};// Reset all dismissed events\nconst handleResetDismissed=()=>{setDismissedEvents([]);};// Get list of pinned event IDs from chartTags\nconst pinnedEventIds=(chartTags||[]).filter(tag=>tag.sourceEventId).map(tag=>tag.sourceEventId);// Year-aware event filtering: returns events adjusted to the visible chart date range\n// Excludes dismissed and pinned events\nconst getFilteredEvents=useCallback(()=>{var _chartData$,_chartData;if(!events||events.length===0||!chartData||chartData.length===0)return[];const chartStartDate=(_chartData$=chartData[0])===null||_chartData$===void 0?void 0:_chartData$.date;const chartEndDate=(_chartData=chartData[chartData.length-1])===null||_chartData===void 0?void 0:_chartData.date;if(!chartStartDate||!chartEndDate)return[];const chartStart=new Date(chartStartDate+'T00:00:00');const chartEnd=new Date(chartEndDate+'T00:00:00');// Determine year label suffix based on displayMode\nconst yearLabel=displayMode==='ly'?'LY':'TY';return events.filter(ev=>!dismissedEvents.includes(ev.id)).filter(ev=>!pinnedEventIds.includes(ev.id))// Exclude pinned events\n.map(ev=>{let evStart=new Date(ev.startDate+'T00:00:00');let evEnd=new Date(ev.endDate+'T00:00:00');// When showing LY only, shift event dates back 365 days\nif(displayMode==='ly'){evStart=new Date(evStart.getTime()-365*24*60*60*1000);evEnd=new Date(evEnd.getTime()-365*24*60*60*1000);}return _objectSpread(_objectSpread({},ev),{},{adjustedStart:evStart,adjustedEnd:evEnd,yearLabel});}).filter(ev=>{// Keep only events that overlap with the visible chart range\nreturn ev.adjustedStart<=chartEnd&&ev.adjustedEnd>=chartStart;});},[events,chartData,displayMode,dismissedEvents,pinnedEventIds]);// Convert a date to the nearest data index in chartData\nconst getIndexForDate=useCallback(targetDate=>{if(!chartData||chartData.length===0)return-1;let bestIdx=0;let bestDiff=Infinity;for(let i=0;i<chartData.length;i++){const d=new Date(chartData[i].date+'T00:00:00');const diff=Math.abs(d.getTime()-targetDate.getTime());if(diff<bestDiff){bestDiff=diff;bestIdx=i;}}return bestIdx;},[chartData]);// Helper to render a single event span (used for both suggestions and pinned)\nconst renderSingleSpan=function(ev){var _chartContainerRef$cu3;let isPinned=arguments.length>1&&arguments[1]!==undefined?arguments[1]:false;const currentWidth=containerWidth||((_chartContainerRef$cu3=chartContainerRef.current)===null||_chartContainerRef$cu3===void 0?void 0:_chartContainerRef$cu3.offsetWidth)||0;if(currentWidth===0)return null;const chartAreaLeft=Y_AXIS_WIDTH+CHART_MARGINS.left;const chartAreaWidth=currentWidth-chartAreaLeft-CHART_MARGINS.right;// For pinned spans, adjustedStart/End are stored as ISO strings\nconst evStart=isPinned?new Date(ev.adjustedStart):ev.adjustedStart;const evEnd=isPinned?new Date(ev.adjustedEnd):ev.adjustedEnd;const startIdx=getIndexForDate(evStart);const endIdx=getIndexForDate(evEnd);// Clamp indices to chart bounds\nconst clampedStart=Math.max(0,startIdx);const clampedEnd=Math.min(chartData.length-1,endIdx);// Calculate pixel positions\nconst startPct=chartData.length===1?0.5:clampedStart/(chartData.length-1);const endPct=chartData.length===1?0.5:clampedEnd/(chartData.length-1);const leftPx=chartAreaLeft+startPct*chartAreaWidth;const rightPx=chartAreaLeft+endPct*chartAreaWidth;const widthPx=Math.max(rightPx-leftPx,4);// minimum 4px width\nconst centerPx=leftPx+widthPx/2;// Solid fill with edge borders - cleaner than gradient\nconst fillColor=hexToRgba(ev.color,0.12);const borderColor=hexToRgba(ev.color,0.5);return/*#__PURE__*/_jsxs(\"div\",{className:\"event-span \".concat(isPinned?'pinned':''),style:{left:\"\".concat(leftPx,\"px\"),width:\"\".concat(widthPx,\"px\"),background:fillColor,borderLeft:\"2px solid \".concat(borderColor),borderRight:\"2px solid \".concat(borderColor)},children:[/*#__PURE__*/_jsxs(\"div\",{className:\"event-span-label\",style:{left:\"\".concat(centerPx-leftPx,\"px\"),background:ev.color},onClick:()=>!isPinned&&setEditingEvent((editingEvent===null||editingEvent===void 0?void 0:editingEvent.id)===ev.id?null:ev),children:[/*#__PURE__*/_jsxs(\"span\",{className:\"event-span-label-text\",children:[ev.name||ev.label,\" (\",ev.yearLabel,\")\"]}),isPinned?/*#__PURE__*/_jsx(\"button\",{className:\"event-span-dismiss\",onClick:e=>{e.stopPropagation();handleRemoveTag(ev.id);},title:\"Remove\",children:\"x\"}):/*#__PURE__*/_jsx(\"button\",{className:\"event-span-dismiss\",onClick:e=>{e.stopPropagation();handleDismissEvent(ev.id);},title:\"Dismiss\",children:\"x\"})]}),!isPinned&&(editingEvent===null||editingEvent===void 0?void 0:editingEvent.id)===ev.id&&/*#__PURE__*/_jsxs(\"div\",{className:\"event-span-edit\",style:{left:\"\".concat(centerPx-leftPx,\"px\")},children:[/*#__PURE__*/_jsxs(\"div\",{className:\"event-span-edit-header\",children:[/*#__PURE__*/_jsx(\"strong\",{children:ev.label}),/*#__PURE__*/_jsx(\"button\",{className:\"event-span-edit-close\",onClick:()=>setEditingEvent(null),children:\"x\"})]}),/*#__PURE__*/_jsxs(\"p\",{className:\"event-span-edit-dates\",children:[new Date(ev.adjustedStart).toLocaleDateString('en-US',{month:'short',day:'numeric'}),' - ',new Date(ev.adjustedEnd).toLocaleDateString('en-US',{month:'short',day:'numeric'})]}),/*#__PURE__*/_jsx(\"p\",{className:\"event-span-edit-tier\",children:ev.tier?'Tier 1 Event':'Tracked Event'}),/*#__PURE__*/_jsx(\"button\",{className:\"event-span-pin-btn\",onClick:()=>{// Pin as a permanent span (not point marker) with full event data\nif(onTagsChange){onTagsChange([...(chartTags||[]),{id:\"pinned-\".concat(ev.id,\"-\").concat(Date.now()),name:ev.label,color:ev.color,// Store the original event ID to track which event was pinned\nsourceEventId:ev.id,// Store span data for rendering as a span\nisSpan:true,startDate:ev.startDate,endDate:ev.endDate,adjustedStart:ev.adjustedStart.toISOString(),adjustedEnd:ev.adjustedEnd.toISOString(),yearLabel:ev.yearLabel,tier:ev.tier,source:'suggested'}]);}setEditingEvent(null);},children:\"Pin to chart\"})]})]},ev.id);};// Get pinned span tags that overlap with current chart range\nconst getPinnedSpans=useCallback(()=>{var _chartData$2,_chartData2;if(!chartTags||!chartData||chartData.length===0)return[];const chartStartDate=(_chartData$2=chartData[0])===null||_chartData$2===void 0?void 0:_chartData$2.date;const chartEndDate=(_chartData2=chartData[chartData.length-1])===null||_chartData2===void 0?void 0:_chartData2.date;if(!chartStartDate||!chartEndDate)return[];const chartStart=new Date(chartStartDate+'T00:00:00');const chartEnd=new Date(chartEndDate+'T00:00:00');return chartTags.filter(tag=>tag.isSpan).filter(tag=>{const tagStart=new Date(tag.adjustedStart);const tagEnd=new Date(tag.adjustedEnd);return tagStart<=chartEnd&&tagEnd>=chartStart;});},[chartTags,chartData]);// Render gradient event spans behind the chart (both suggestions and pinned)\nconst renderEventSpans=()=>{var _chartContainerRef$cu4;const currentWidth=containerWidth||((_chartContainerRef$cu4=chartContainerRef.current)===null||_chartContainerRef$cu4===void 0?void 0:_chartContainerRef$cu4.offsetWidth)||0;if(currentWidth===0)return null;// Get pinned spans (always show)\nconst pinnedSpans=getPinnedSpans();// Get suggested events (only when toggle is on)\nconst suggestedEvents=showSuggestedEvents?getFilteredEvents():[];// If nothing to render, return null\nif(pinnedSpans.length===0&&suggestedEvents.length===0)return null;return/*#__PURE__*/_jsxs(_Fragment,{children:[pinnedSpans.map(span=>renderSingleSpan(span,true)),suggestedEvents.map(ev=>renderSingleSpan(ev,false))]});};const commonProps={data:chartData,margin:CHART_MARGINS};const axisStyle={fontSize:11,fill:'#86868b',fontWeight:500};// Calculate tick interval for evenly spaced X-axis labels\n// Target ~6-8 ticks for readability, ensuring even spacing\nconst calculateTickInterval=()=>{if(!chartData||chartData.length<=1)return 0;const dataPoints=chartData.length;const targetTicks=7;// Aim for 7 evenly spaced ticks\nconst interval=Math.max(0,Math.floor((dataPoints-1)/(targetTicks-1))-1);return interval;};const tickInterval=calculateTickInterval();// Get the correct data keys based on comparison mode\nconst tyDataKey=hasComparison?\"\".concat(kpi,\"_ty\"):kpi;const lyDataKey=hasComparison?\"\".concat(kpi,\"_ly\"):null;// Determine which lines to show based on displayMode\nconst showTY=displayMode==='both'||displayMode==='ty';const showLY=displayMode==='both'||displayMode==='ly';// Render placed tags as overlay elements (point tags only, not span tags)\nconst renderPlacedTags=()=>{var _chartContainerRef$cu5;if(!chartTags||chartTags.length===0||!chartData||chartData.length===0)return null;// Filter out span tags - they're rendered in renderEventSpans\nconst pointTags=chartTags.filter(t=>!t.isSpan);if(pointTags.length===0)return null;// Get current width - fallback to ref if state is 0\nconst currentWidth=containerWidth||((_chartContainerRef$cu5=chartContainerRef.current)===null||_chartContainerRef$cu5===void 0?void 0:_chartContainerRef$cu5.offsetWidth)||0;if(currentWidth===0)return null;// Pole extends from tag area into chart\nconst poleHeight=CHART_HEIGHT-CHART_MARGINS.bottom-40;return pointTags.map(tag=>{// Find the date index - use stored index first, then lookup by date\nlet dateIndex=tag.dateIndex;if(dateIndex===undefined||dateIndex<0||dateIndex>=chartData.length){dateIndex=chartData.findIndex(d=>d.date===tag.date);}if(dateIndex===-1||dateIndex>=chartData.length)return null;const xPos=getXPositionForIndex(dateIndex);if(xPos===0&&dateIndex!==0)return null;// Position calculation failed\nconst isExpanded=expandedTagId===tag.id;const hasDetails=tag.owner||tag.description;return/*#__PURE__*/_jsxs(\"div\",{className:\"placed-tag-container \".concat(isExpanded?'expanded':''),style:{left:\"\".concat(xPos,\"px\")},children:[/*#__PURE__*/_jsxs(\"div\",{className:\"tag-label \".concat(hasDetails?'clickable':''),style:{background:tag.color},onClick:hasDetails?()=>handleTagClick(tag.id):undefined,children:[/*#__PURE__*/_jsx(\"span\",{className:\"tag-label-text\",children:tag.name}),hasDetails&&/*#__PURE__*/_jsx(\"span\",{className:\"tag-expand-icon\",children:isExpanded?'âˆ’':'+'}),/*#__PURE__*/_jsx(\"button\",{className:\"tag-label-remove\",onClick:e=>{e.stopPropagation();handleRemoveTag(tag.id);},title:\"Remove tag\",children:\"\\xD7\"})]}),isExpanded&&hasDetails&&/*#__PURE__*/_jsxs(\"div\",{className:\"tag-details\",style:{borderColor:tag.color},children:[tag.description&&/*#__PURE__*/_jsx(\"p\",{className:\"tag-description\",children:tag.description}),tag.owner&&/*#__PURE__*/_jsxs(\"p\",{className:\"tag-owner-info\",children:[/*#__PURE__*/_jsx(\"span\",{className:\"tag-owner-label\",children:\"Owner:\"}),\" \",tag.owner]})]}),/*#__PURE__*/_jsx(\"div\",{className:\"tag-pole\",style:{background:tag.color,height:poleHeight}}),/*#__PURE__*/_jsx(\"div\",{className:\"tag-date\",style:{color:tag.color},children:formatAxisDate(tag.date)})]},tag.id);});};// Render drag preview\nconst renderDragPreview=()=>{if(!dragPreview||dragPreview.x===0)return null;const poleHeight=CHART_HEIGHT-CHART_MARGINS.bottom-40;return/*#__PURE__*/_jsxs(\"div\",{className:\"drag-preview-container\",style:{left:\"\".concat(dragPreview.x,\"px\")},children:[/*#__PURE__*/_jsx(\"div\",{className:\"tag-label preview\",style:{background:dragPreview.tag.color},children:/*#__PURE__*/_jsx(\"span\",{className:\"tag-label-text\",children:dragPreview.tag.name})}),/*#__PURE__*/_jsx(\"div\",{className:\"tag-pole preview\",style:{borderColor:dragPreview.tag.color,height:poleHeight}}),/*#__PURE__*/_jsx(\"div\",{className:\"tag-date preview\",style:{color:dragPreview.tag.color},children:dragPreview.formattedDate})]});};const renderChart=()=>{switch(chartType){case'area':return/*#__PURE__*/_jsxs(AreaChart,_objectSpread(_objectSpread({},commonProps),{},{children:[/*#__PURE__*/_jsxs(\"defs\",{children:[/*#__PURE__*/_jsxs(\"linearGradient\",{id:\"areaGradientTY\",x1:\"0\",y1:\"0\",x2:\"0\",y2:\"1\",children:[/*#__PURE__*/_jsx(\"stop\",{offset:\"0%\",stopColor:\"#F96302\",stopOpacity:0.25}),/*#__PURE__*/_jsx(\"stop\",{offset:\"100%\",stopColor:\"#F96302\",stopOpacity:0})]}),/*#__PURE__*/_jsxs(\"linearGradient\",{id:\"areaGradientLY\",x1:\"0\",y1:\"0\",x2:\"0\",y2:\"1\",children:[/*#__PURE__*/_jsx(\"stop\",{offset:\"0%\",stopColor:\"#86868b\",stopOpacity:0.15}),/*#__PURE__*/_jsx(\"stop\",{offset:\"100%\",stopColor:\"#86868b\",stopOpacity:0})]})]}),/*#__PURE__*/_jsx(CartesianGrid,{strokeDasharray:\"3 3\",stroke:\"rgba(0,0,0,0.04)\",vertical:false}),/*#__PURE__*/_jsx(XAxis,{dataKey:\"displayDate\",tick:axisStyle,tickLine:false,axisLine:{stroke:'rgba(0,0,0,0.08)'},tickFormatter:formatAxisDate,interval:tickInterval}),/*#__PURE__*/_jsx(YAxis,{tick:axisStyle,tickLine:false,axisLine:false,tickFormatter:formatValue,width:Y_AXIS_WIDTH}),/*#__PURE__*/_jsx(Tooltip,{content:/*#__PURE__*/_jsx(CustomTooltip,{})}),hasComparison&&/*#__PURE__*/_jsx(Legend,{}),launchDate&&showTY&&/*#__PURE__*/_jsx(ReferenceLine,{x:launchDate,stroke:\"#F96302\",strokeDasharray:\"4 4\",strokeWidth:2,label:{value:'Launch',position:'top',fill:'#F96302',fontSize:11,fontWeight:600}}),hasComparison&&lyDataKey&&showLY&&/*#__PURE__*/_jsx(Area,{type:\"monotone\",dataKey:lyDataKey,name:\"Last Year\",stroke:\"#86868b\",strokeWidth:1.5,strokeDasharray:\"4 4\",fill:\"url(#areaGradientLY)\",dot:false,activeDot:{r:4,fill:'#86868b',stroke:'#fff',strokeWidth:2}}),showTY&&/*#__PURE__*/_jsx(Area,{type:\"monotone\",dataKey:tyDataKey,name:hasComparison?\"This Year\":kpi,stroke:\"#F96302\",strokeWidth:2,fill:\"url(#areaGradientTY)\",dot:false,activeDot:{r:5,fill:'#F96302',stroke:'#fff',strokeWidth:2}})]}));case'bar':return/*#__PURE__*/_jsxs(BarChart,_objectSpread(_objectSpread({},commonProps),{},{children:[/*#__PURE__*/_jsx(CartesianGrid,{strokeDasharray:\"3 3\",stroke:\"rgba(0,0,0,0.04)\",vertical:false}),/*#__PURE__*/_jsx(XAxis,{dataKey:\"displayDate\",tick:axisStyle,tickLine:false,axisLine:{stroke:'rgba(0,0,0,0.08)'},tickFormatter:formatAxisDate,interval:tickInterval}),/*#__PURE__*/_jsx(YAxis,{tick:axisStyle,tickLine:false,axisLine:false,tickFormatter:formatValue,width:Y_AXIS_WIDTH}),/*#__PURE__*/_jsx(Tooltip,{content:/*#__PURE__*/_jsx(CustomTooltip,{})}),hasComparison&&/*#__PURE__*/_jsx(Legend,{}),launchDate&&showTY&&/*#__PURE__*/_jsx(ReferenceLine,{x:launchDate,stroke:\"#F96302\",strokeDasharray:\"4 4\",strokeWidth:2}),hasComparison&&lyDataKey&&showLY&&/*#__PURE__*/_jsx(Bar,{dataKey:lyDataKey,name:\"Last Year\",fill:\"#d1d1d6\",radius:[4,4,0,0],maxBarSize:20}),showTY&&/*#__PURE__*/_jsx(Bar,{dataKey:tyDataKey,name:hasComparison?\"This Year\":kpi,fill:\"#F96302\",radius:[4,4,0,0],maxBarSize:hasComparison?20:40})]}));default:return/*#__PURE__*/_jsxs(LineChart,_objectSpread(_objectSpread({},commonProps),{},{children:[/*#__PURE__*/_jsx(CartesianGrid,{strokeDasharray:\"3 3\",stroke:\"rgba(0,0,0,0.04)\",vertical:false}),/*#__PURE__*/_jsx(XAxis,{dataKey:\"displayDate\",tick:axisStyle,tickLine:false,axisLine:{stroke:'rgba(0,0,0,0.08)'},tickFormatter:formatAxisDate,interval:tickInterval}),/*#__PURE__*/_jsx(YAxis,{tick:axisStyle,tickLine:false,axisLine:false,tickFormatter:formatValue,width:Y_AXIS_WIDTH}),/*#__PURE__*/_jsx(Tooltip,{content:/*#__PURE__*/_jsx(CustomTooltip,{})}),hasComparison&&/*#__PURE__*/_jsx(Legend,{}),launchDate&&showTY&&/*#__PURE__*/_jsx(ReferenceLine,{x:launchDate,stroke:\"#F96302\",strokeDasharray:\"4 4\",strokeWidth:2,label:{value:'Launch',position:'top',fill:'#F96302',fontSize:11,fontWeight:600}}),hasComparison&&lyDataKey&&showLY&&/*#__PURE__*/_jsx(Line,{type:\"monotone\",dataKey:lyDataKey,name:\"Last Year\",stroke:\"#86868b\",strokeWidth:1.5,strokeDasharray:\"4 4\",dot:false,activeDot:{r:4,fill:'#86868b',stroke:'#fff',strokeWidth:2}}),showTY&&/*#__PURE__*/_jsx(Line,{type:\"monotone\",dataKey:tyDataKey,name:hasComparison?\"This Year\":kpi,stroke:\"#F96302\",strokeWidth:2,dot:false,activeDot:{r:5,fill:'#F96302',stroke:'#fff',strokeWidth:2}})]}));}};if(!chartData||chartData.length===0){return/*#__PURE__*/_jsx(\"div\",{className:\"chart-empty\",children:/*#__PURE__*/_jsx(\"p\",{children:\"No data available for the selected period\"})});}if(isBeta){return/*#__PURE__*/_jsxs(\"div\",{className:\"kpi-chart beta-restricted\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"chart-blur-wrapper\",children:/*#__PURE__*/_jsx(ResponsiveContainer,{width:\"100%\",height:320,children:renderChart()})}),/*#__PURE__*/_jsx(\"div\",{className:\"beta-overlay\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"beta-overlay-content\",children:[/*#__PURE__*/_jsx(\"h3\",{children:\"Place holder\"}),/*#__PURE__*/_jsx(\"p\",{children:\"Chart visualization\"})]})})]});}return/*#__PURE__*/_jsxs(\"div\",{className:\"kpi-chart-wrapper\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"kpi-chart \".concat(draggedTag?'drop-active':''),ref:chartContainerRef,onDragOver:handleDragOver,onDragLeave:handleDragLeave,onDrop:handleDrop,children:[/*#__PURE__*/_jsxs(\"div\",{className:\"tag-area\",children:[renderPlacedTags(),dragPreview&&renderDragPreview()]}),/*#__PURE__*/_jsx(\"div\",{className:\"event-spans-layer\",style:{height:\"\".concat(PLOT_AREA_HEIGHT,\"px\")},children:renderEventSpans()}),/*#__PURE__*/_jsx(ResponsiveContainer,{width:\"100%\",height:320,children:renderChart()})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"chart-tag-controls\",children:[/*#__PURE__*/_jsxs(\"button\",{className:\"tag-panel-toggle \".concat(showTagPanel?'active':''),onClick:()=>setShowTagPanel(!showTagPanel),children:[/*#__PURE__*/_jsxs(\"svg\",{width:\"16\",height:\"16\",viewBox:\"0 0 24 24\",fill:\"none\",stroke:\"currentColor\",strokeWidth:\"2\",strokeLinecap:\"round\",strokeLinejoin:\"round\",children:[/*#__PURE__*/_jsx(\"path\",{d:\"M20.59 13.41l-7.17 7.17a2 2 0 0 1-2.83 0L2 12V2h10l8.59 8.59a2 2 0 0 1 0 2.82z\"}),/*#__PURE__*/_jsx(\"line\",{x1:\"7\",y1:\"7\",x2:\"7.01\",y2:\"7\"})]}),/*#__PURE__*/_jsx(\"span\",{children:\"Add Info Tag\"})]}),/*#__PURE__*/_jsxs(\"button\",{className:\"suggested-events-toggle \".concat(showSuggestedEvents?'active':''),onClick:()=>setShowSuggestedEvents(!showSuggestedEvents),children:[/*#__PURE__*/_jsx(\"span\",{className:\"suggested-events-dot \".concat(showSuggestedEvents?'on':'off')}),/*#__PURE__*/_jsx(\"span\",{children:\"Suggested Events\"})]}),chartTags&&chartTags.filter(t=>!t.isSpan).length>0&&/*#__PURE__*/_jsx(\"div\",{className:\"active-tags\",children:chartTags.filter(t=>!t.isSpan).map(tag=>/*#__PURE__*/_jsxs(\"span\",{className:\"active-tag\",style:{borderColor:tag.color,color:tag.color},children:[/*#__PURE__*/_jsx(\"span\",{className:\"tag-marker\",style:{background:tag.color}}),tag.name,/*#__PURE__*/_jsx(\"span\",{className:\"tag-date\",children:formatAxisDate(tag.date)}),/*#__PURE__*/_jsx(\"button\",{onClick:()=>handleRemoveTag(tag.id),className:\"tag-remove\",children:/*#__PURE__*/_jsxs(\"svg\",{width:\"12\",height:\"12\",viewBox:\"0 0 24 24\",fill:\"none\",stroke:\"currentColor\",strokeWidth:\"2\",children:[/*#__PURE__*/_jsx(\"line\",{x1:\"18\",y1:\"6\",x2:\"6\",y2:\"18\"}),/*#__PURE__*/_jsx(\"line\",{x1:\"6\",y1:\"6\",x2:\"18\",y2:\"18\"})]})})]},tag.id))})]}),showTagPanel&&/*#__PURE__*/_jsxs(\"div\",{className:\"tag-panel\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"tag-panel-header\",children:[/*#__PURE__*/_jsx(\"h4\",{children:\"Drag tags onto the chart\"}),/*#__PURE__*/_jsx(\"button\",{className:\"tag-panel-close\",onClick:()=>setShowTagPanel(false),children:/*#__PURE__*/_jsxs(\"svg\",{width:\"16\",height:\"16\",viewBox:\"0 0 24 24\",fill:\"none\",stroke:\"currentColor\",strokeWidth:\"2\",children:[/*#__PURE__*/_jsx(\"line\",{x1:\"18\",y1:\"6\",x2:\"6\",y2:\"18\"}),/*#__PURE__*/_jsx(\"line\",{x1:\"6\",y1:\"6\",x2:\"18\",y2:\"18\"})]})})]}),dismissedEvents.length>0&&/*#__PURE__*/_jsxs(\"button\",{className:\"reset-dismissed-btn\",onClick:handleResetDismissed,children:[\"Reset \",dismissedEvents.length,\" dismissed event\",dismissedEvents.length!==1?'s':'']}),/*#__PURE__*/_jsx(\"div\",{className:\"preset-tags\",children:PRESET_TAGS// Filter out preset tags that match pinned events by name\n.filter(tag=>{const tagNameLower=tag.name.toLowerCase();// Check if this tag name matches any pinned event\nconst isPinnedAlready=(chartTags||[]).some(ct=>ct.isSpan&&ct.name.toLowerCase()===tagNameLower);return!isPinnedAlready;}).map(tag=>/*#__PURE__*/_jsxs(\"div\",{className:\"draggable-tag\",draggable:true,onDragStart:e=>handleDragStart(e,tag),onDragEnd:handleDragEnd,style:{borderColor:tag.color},children:[/*#__PURE__*/_jsx(\"span\",{className:\"tag-marker\",style:{background:tag.color}}),tag.name]},tag.id))}),/*#__PURE__*/_jsx(\"div\",{className:\"custom-tag-section\",children:!showCustomForm?/*#__PURE__*/_jsxs(\"button\",{className:\"add-custom-tag-btn\",onClick:()=>setShowCustomForm(true),children:[/*#__PURE__*/_jsxs(\"svg\",{width:\"14\",height:\"14\",viewBox:\"0 0 24 24\",fill:\"none\",stroke:\"currentColor\",strokeWidth:\"2\",children:[/*#__PURE__*/_jsx(\"line\",{x1:\"12\",y1:\"5\",x2:\"12\",y2:\"19\"}),/*#__PURE__*/_jsx(\"line\",{x1:\"5\",y1:\"12\",x2:\"19\",y2:\"12\"})]}),\"Create Custom Tag\"]}):/*#__PURE__*/_jsxs(\"div\",{className:\"custom-tag-form\",children:[/*#__PURE__*/_jsx(\"input\",{type:\"text\",placeholder:\"Tag name\",value:customTagName,onChange:e=>setCustomTagName(e.target.value),className:\"custom-tag-input\"}),/*#__PURE__*/_jsx(\"input\",{type:\"text\",placeholder:\"Your name (owner)\",value:customTagOwner,onChange:e=>setCustomTagOwner(e.target.value),className:\"custom-tag-input\"}),/*#__PURE__*/_jsx(\"textarea\",{placeholder:\"Short description (optional)\",value:customTagDescription,onChange:e=>setCustomTagDescription(e.target.value),className:\"custom-tag-textarea\",rows:2}),/*#__PURE__*/_jsxs(\"div\",{className:\"custom-tag-actions\",children:[/*#__PURE__*/_jsx(\"button\",{className:\"custom-tag-cancel\",onClick:()=>{setShowCustomForm(false);setCustomTagName('');setCustomTagOwner('');setCustomTagDescription('');},children:\"Cancel\"}),/*#__PURE__*/_jsx(\"button\",{className:\"custom-tag-create\",onClick:handleAddCustomTag,disabled:!customTagName.trim()||!customTagOwner.trim(),children:\"Create & Drag\"})]})]})}),draggedTag&&draggedTag.isCustom&&/*#__PURE__*/_jsxs(\"div\",{className:\"drag-instruction\",children:[/*#__PURE__*/_jsxs(\"p\",{children:[\"Now drag your custom tag \\\"\",draggedTag.name,\"\\\" onto the chart\"]}),/*#__PURE__*/_jsxs(\"div\",{className:\"draggable-tag custom\",draggable:true,onDragStart:e=>handleDragStart(e,draggedTag),onDragEnd:handleDragEnd,children:[/*#__PURE__*/_jsx(\"span\",{className:\"tag-marker\",style:{background:draggedTag.color}}),draggedTag.name,/*#__PURE__*/_jsxs(\"span\",{className:\"tag-owner\",children:[\"by \",draggedTag.owner]})]})]})]})]});}export default KPIChart;","map":{"version":3,"names":["useState","useRef","useCallback","useEffect","LineChart","Line","AreaChart","Area","BarChart","Bar","XAxis","YAxis","CartesianGrid","Tooltip","ResponsiveContainer","ReferenceLine","Legend","useAuth","jsx","_jsx","jsxs","_jsxs","Fragment","_Fragment","PRESET_TAGS","id","name","color","CHART_MARGINS","top","right","left","bottom","Y_AXIS_WIDTH","CHART_HEIGHT","PLOT_AREA_HEIGHT","hexToRgba","hex","alpha","r","parseInt","slice","g","b","concat","KPIChart","_ref","data","kpi","chartType","format","launchDate","comparisonData","chartTags","onTagsChange","displayMode","events","isBetaMode","isBeta","chartContainerRef","showTagPanel","setShowTagPanel","customTagName","setCustomTagName","customTagOwner","setCustomTagOwner","customTagDescription","setCustomTagDescription","draggedTag","setDraggedTag","showCustomForm","setShowCustomForm","dragPreview","setDragPreview","containerWidth","setContainerWidth","expandedTagId","setExpandedTagId","showSuggestedEvents","setShowSuggestedEvents","dismissedEvents","setDismissedEvents","stored","sessionStorage","getItem","JSON","parse","_unused","editingEvent","setEditingEvent","rawChartData","length","hasComparison","chartData","map","d","_objectSpread","displayDate","date_ly","date","updateWidth","current","width","offsetWidth","initialTimeout","setTimeout","secondTimeout","window","addEventListener","resizeObserver","ResizeObserver","requestAnimationFrame","observe","clearTimeout","removeEventListener","disconnect","formatValue","val","undefined","isNaN","Math","abs","toFixed","toLocaleString","formatAxisDate","dateStr","Date","toLocaleDateString","month","day","formatFullDate","weekday","year","getContainerRect","getBoundingClientRect","getDateIndexFromX","clientX","rect","chartAreaLeft","chartAreaWidth","relativeX","percentage","max","min","dataIndex","round","getXPositionForIndex","index","_chartContainerRef$cu","CustomTooltip","_ref2","active","payload","label","dataPoint","find","formatDate","dateTag","t","className","children","style","background","entry","value","handleDragStart","e","tag","dataTransfer","effectAllowed","img","Image","src","setDragImage","handleDragOver","_chartData$dateIndex","preventDefault","dropEffect","dateIndex","targetDate","xPosition","formattedDate","x","handleDragLeave","_chartContainerRef$cu2","clientY","handleDrop","_chartData$dateIndex2","newTag","now","handleDragEnd","handleAddCustomTag","trim","owner","description","isCustom","handleTagClick","tagId","handleRemoveTag","filter","setItem","stringify","_unused2","handleDismissEvent","eventId","prev","handleResetDismissed","pinnedEventIds","sourceEventId","getFilteredEvents","_chartData$","_chartData","chartStartDate","chartEndDate","chartStart","chartEnd","yearLabel","ev","includes","evStart","startDate","evEnd","endDate","getTime","adjustedStart","adjustedEnd","getIndexForDate","bestIdx","bestDiff","Infinity","i","diff","renderSingleSpan","_chartContainerRef$cu3","isPinned","arguments","currentWidth","startIdx","endIdx","clampedStart","clampedEnd","startPct","endPct","leftPx","rightPx","widthPx","centerPx","fillColor","borderColor","borderLeft","borderRight","onClick","stopPropagation","title","tier","isSpan","toISOString","source","getPinnedSpans","_chartData$2","_chartData2","tagStart","tagEnd","renderEventSpans","_chartContainerRef$cu4","pinnedSpans","suggestedEvents","span","commonProps","margin","axisStyle","fontSize","fill","fontWeight","calculateTickInterval","dataPoints","targetTicks","interval","floor","tickInterval","tyDataKey","lyDataKey","showTY","showLY","renderPlacedTags","_chartContainerRef$cu5","pointTags","poleHeight","findIndex","xPos","isExpanded","hasDetails","height","renderDragPreview","renderChart","x1","y1","x2","y2","offset","stopColor","stopOpacity","strokeDasharray","stroke","vertical","dataKey","tick","tickLine","axisLine","tickFormatter","content","strokeWidth","position","type","dot","activeDot","radius","maxBarSize","ref","onDragOver","onDragLeave","onDrop","viewBox","strokeLinecap","strokeLinejoin","tagNameLower","toLowerCase","isPinnedAlready","some","ct","draggable","onDragStart","onDragEnd","placeholder","onChange","target","rows","disabled"],"sources":["C:/Users/AkashPatil/THD-Dashboard/frontend/src/components/KPIChart.js"],"sourcesContent":["import { useState, useRef, useCallback, useEffect } from 'react';\r\nimport {\r\n  LineChart, Line, AreaChart, Area, BarChart, Bar,\r\n  XAxis, YAxis, CartesianGrid, Tooltip, ResponsiveContainer,\r\n  ReferenceLine, Legend\r\n} from 'recharts';\r\nimport { useAuth } from '../context/AuthContext';\r\nimport './KPIChart.css';\r\n\r\n// Preset event tags - these are for manual tagging of events NOT in the Event Tracker\r\n// Events like Black Friday, Labor Day, etc. come from the Event Tracker automatically\r\nconst PRESET_TAGS = [\r\n  { id: 'thanksgiving', name: 'Thanksgiving', color: '#F96302' },\r\n  { id: 'july4th', name: '4th of July', color: '#FF3B30' },\r\n  { id: 'tier1', name: 'Tier 1 Event', color: '#5856D6' },\r\n  { id: 'promo', name: 'Promo', color: '#34C759' },\r\n  { id: 'outage', name: 'Outage/Issue', color: '#FF2D55' }\r\n];\r\n\r\n// Chart margins matching Recharts config\r\nconst CHART_MARGINS = { top: 20, right: 20, left: 10, bottom: 20 };\r\nconst Y_AXIS_WIDTH = 60;\r\nconst CHART_HEIGHT = 320;\r\n// Height of the actual plot area (excluding X-axis labels ~30px and Legend ~24px)\r\nconst PLOT_AREA_HEIGHT = CHART_HEIGHT - CHART_MARGINS.top - CHART_MARGINS.bottom - 54;\r\n\r\n// Convert hex color string to rgba with given alpha\r\nfunction hexToRgba(hex, alpha) {\r\n  const r = parseInt(hex.slice(1, 3), 16);\r\n  const g = parseInt(hex.slice(3, 5), 16);\r\n  const b = parseInt(hex.slice(5, 7), 16);\r\n  return `rgba(${r},${g},${b},${alpha})`;\r\n}\r\n\r\nfunction KPIChart({ data, kpi, chartType, format, launchDate, comparisonData, chartTags, onTagsChange, displayMode = 'both', events = [] }) {\r\n  const { isBetaMode } = useAuth();\r\n  const isBeta = isBetaMode();\r\n  const chartContainerRef = useRef(null);\r\n  const [showTagPanel, setShowTagPanel] = useState(false);\r\n  const [customTagName, setCustomTagName] = useState('');\r\n  const [customTagOwner, setCustomTagOwner] = useState('');\r\n  const [customTagDescription, setCustomTagDescription] = useState('');\r\n  const [draggedTag, setDraggedTag] = useState(null);\r\n  const [showCustomForm, setShowCustomForm] = useState(false);\r\n  const [dragPreview, setDragPreview] = useState(null);\r\n  const [containerWidth, setContainerWidth] = useState(0);\r\n  const [expandedTagId, setExpandedTagId] = useState(null);\r\n  const [showSuggestedEvents, setShowSuggestedEvents] = useState(false);\r\n  const [dismissedEvents, setDismissedEvents] = useState(() => {\r\n    try {\r\n      const stored = sessionStorage.getItem('dismissedEvents');\r\n      return stored ? JSON.parse(stored) : [];\r\n    } catch { return []; }\r\n  });\r\n  const [editingEvent, setEditingEvent] = useState(null);\r\n\r\n  // Use comparison data if available, otherwise fall back to regular data\r\n  const rawChartData = comparisonData && comparisonData.length > 0 ? comparisonData : data;\r\n  const hasComparison = comparisonData && comparisonData.length > 0;\r\n\r\n  // Add displayDate field based on displayMode\r\n  // When showing LY only, use date_ly for X-axis; otherwise use date (TY)\r\n  const chartData = rawChartData?.map(d => ({\r\n    ...d,\r\n    displayDate: displayMode === 'ly' && d.date_ly ? d.date_ly : d.date\r\n  })) || [];\r\n\r\n  // Track container width for tag positioning\r\n  useEffect(() => {\r\n    const updateWidth = () => {\r\n      if (chartContainerRef.current) {\r\n        const width = chartContainerRef.current.offsetWidth;\r\n        if (width > 0) {\r\n          setContainerWidth(width);\r\n        }\r\n      }\r\n    };\r\n\r\n    // Initial update with a slight delay to ensure DOM is ready\r\n    updateWidth();\r\n    const initialTimeout = setTimeout(updateWidth, 100);\r\n    const secondTimeout = setTimeout(updateWidth, 300);\r\n\r\n    window.addEventListener('resize', updateWidth);\r\n\r\n    // Also observe size changes\r\n    const resizeObserver = new ResizeObserver(() => {\r\n      // Use requestAnimationFrame to avoid layout thrashing\r\n      requestAnimationFrame(() => {\r\n        updateWidth();\r\n      });\r\n    });\r\n    if (chartContainerRef.current) {\r\n      resizeObserver.observe(chartContainerRef.current);\r\n    }\r\n\r\n    return () => {\r\n      clearTimeout(initialTimeout);\r\n      clearTimeout(secondTimeout);\r\n      window.removeEventListener('resize', updateWidth);\r\n      resizeObserver.disconnect();\r\n    };\r\n  }, []);\r\n\r\n  // Force width recalculation when chartTags change (ensures tags render properly)\r\n  useEffect(() => {\r\n    if (chartTags && chartTags.length > 0 && chartContainerRef.current) {\r\n      const width = chartContainerRef.current.offsetWidth;\r\n      if (width > 0 && containerWidth !== width) {\r\n        setContainerWidth(width);\r\n      }\r\n    }\r\n  }, [chartTags, containerWidth]);\r\n\r\n  const formatValue = (val) => {\r\n    if (val === null || val === undefined || isNaN(val)) return '-';\r\n\r\n    if (format === 'currency') {\r\n      if (Math.abs(val) >= 1000000) {\r\n        return `$${(val / 1000000).toFixed(1)}M`;\r\n      }\r\n      if (Math.abs(val) >= 1000) {\r\n        return `$${(val / 1000).toFixed(0)}K`;\r\n      }\r\n      return `$${val.toFixed(2)}`;\r\n    }\r\n    if (format === 'percentage') {\r\n      return `${(val * 100).toFixed(2)}%`;\r\n    }\r\n    if (Math.abs(val) >= 1000000) {\r\n      return `${(val / 1000000).toFixed(1)}M`;\r\n    }\r\n    if (Math.abs(val) >= 1000) {\r\n      return `${(val / 1000).toFixed(0)}K`;\r\n    }\r\n    return val.toLocaleString();\r\n  };\r\n\r\n  const formatAxisDate = (dateStr) => {\r\n    const date = new Date(dateStr);\r\n    return date.toLocaleDateString('en-US', { month: 'short', day: 'numeric' });\r\n  };\r\n\r\n  const formatFullDate = (dateStr) => {\r\n    const date = new Date(dateStr);\r\n    return date.toLocaleDateString('en-US', {\r\n      weekday: 'short',\r\n      month: 'short',\r\n      day: 'numeric',\r\n      year: 'numeric'\r\n    });\r\n  };\r\n\r\n  // Get container rect - always fresh to handle dynamic sizing\r\n  const getContainerRect = useCallback(() => {\r\n    if (!chartContainerRef.current) return null;\r\n    return chartContainerRef.current.getBoundingClientRect();\r\n  }, []);\r\n\r\n  // Calculate date index from clientX position\r\n  const getDateIndexFromX = useCallback((clientX) => {\r\n    if (!chartData || chartData.length === 0) return -1;\r\n    const rect = getContainerRect();\r\n    if (!rect) return -1;\r\n\r\n    const chartAreaLeft = Y_AXIS_WIDTH + CHART_MARGINS.left;\r\n    const chartAreaWidth = rect.width - chartAreaLeft - CHART_MARGINS.right;\r\n\r\n    const relativeX = clientX - rect.left - chartAreaLeft;\r\n    const percentage = Math.max(0, Math.min(1, relativeX / chartAreaWidth));\r\n\r\n    const dataIndex = Math.round(percentage * (chartData.length - 1));\r\n    return Math.max(0, Math.min(dataIndex, chartData.length - 1));\r\n  }, [chartData, getContainerRect]);\r\n\r\n  // Get x position (relative to container) for a data index\r\n  const getXPositionForIndex = useCallback((index) => {\r\n    if (!chartData || chartData.length === 0 || index < 0) return 0;\r\n\r\n    // Use containerWidth state for reliable positioning\r\n    const width = containerWidth || (chartContainerRef.current?.offsetWidth || 0);\r\n    if (width === 0) return 0;\r\n\r\n    const chartAreaLeft = Y_AXIS_WIDTH + CHART_MARGINS.left;\r\n    const chartAreaWidth = width - chartAreaLeft - CHART_MARGINS.right;\r\n\r\n    // Handle single data point\r\n    if (chartData.length === 1) {\r\n      return chartAreaLeft + chartAreaWidth / 2;\r\n    }\r\n\r\n    const percentage = index / (chartData.length - 1);\r\n    return chartAreaLeft + (percentage * chartAreaWidth);\r\n  }, [chartData, containerWidth]);\r\n\r\n  const CustomTooltip = ({ active, payload, label }) => {\r\n    if (active && payload && payload.length) {\r\n      // Find the data point to access both TY and LY dates\r\n      const dataPoint = chartData?.find(d => d.displayDate === label);\r\n\r\n      // Format dates based on what's being shown\r\n      const formatDate = (dateStr) => new Date(dateStr).toLocaleDateString('en-US', {\r\n        weekday: 'short',\r\n        month: 'short',\r\n        day: 'numeric',\r\n        year: 'numeric'\r\n      });\r\n\r\n      // Check if there's a tag for this date\r\n      const dateTag = chartTags?.find(t => t.date === label || t.date === dataPoint?.date);\r\n\r\n      return (\r\n        <div className=\"chart-tooltip\">\r\n          {/* Show appropriate date header based on displayMode */}\r\n          {displayMode === 'ly' ? (\r\n            <p className=\"tooltip-date\">{formatDate(dataPoint?.date_ly || label)}</p>\r\n          ) : displayMode === 'both' && dataPoint?.date && dataPoint?.date_ly ? (\r\n            <>\r\n              <p className=\"tooltip-date\">TY: {formatDate(dataPoint.date)}</p>\r\n              <p className=\"tooltip-date tooltip-date-ly\">LY: {formatDate(dataPoint.date_ly)}</p>\r\n            </>\r\n          ) : (\r\n            <p className=\"tooltip-date\">{formatDate(dataPoint?.date || label)}</p>\r\n          )}\r\n          {dateTag && (\r\n            <p className=\"tooltip-tag\">\r\n              <span className=\"tooltip-tag-marker\" style={{ background: dateTag.color }}></span>\r\n              {dateTag.name}\r\n            </p>\r\n          )}\r\n          {payload.map((entry, index) => (\r\n            <p key={index} className=\"tooltip-value\" style={{ color: entry.color }}>\r\n              <span className=\"tooltip-label\">{entry.name}: </span>\r\n              {formatValue(entry.value)}\r\n            </p>\r\n          ))}\r\n        </div>\r\n      );\r\n    }\r\n    return null;\r\n  };\r\n\r\n  const handleDragStart = (e, tag) => {\r\n    setDraggedTag(tag);\r\n    e.dataTransfer.effectAllowed = 'copy';\r\n    // Set a transparent drag image\r\n    const img = new Image();\r\n    img.src = 'data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7';\r\n    e.dataTransfer.setDragImage(img, 0, 0);\r\n  };\r\n\r\n  const handleDragOver = (e) => {\r\n    e.preventDefault();\r\n    e.dataTransfer.dropEffect = 'copy';\r\n\r\n    if (!draggedTag || !chartData || chartData.length === 0) return;\r\n\r\n    const rect = getContainerRect();\r\n    if (!rect) return;\r\n\r\n    const dateIndex = getDateIndexFromX(e.clientX);\r\n    const targetDate = chartData[dateIndex]?.date;\r\n\r\n    // Calculate position relative to container for display\r\n    const xPosition = getXPositionForIndex(dateIndex);\r\n\r\n    if (targetDate && dateIndex >= 0) {\r\n      setDragPreview({\r\n        date: targetDate,\r\n        formattedDate: formatFullDate(targetDate),\r\n        x: xPosition,\r\n        index: dateIndex,\r\n        tag: draggedTag\r\n      });\r\n    }\r\n  };\r\n\r\n  const handleDragLeave = (e) => {\r\n    // Only clear preview if we're actually leaving the chart area\r\n    const rect = chartContainerRef.current?.getBoundingClientRect();\r\n    if (rect) {\r\n      const { clientX, clientY } = e;\r\n      if (clientX < rect.left || clientX > rect.right ||\r\n          clientY < rect.top || clientY > rect.bottom) {\r\n        setDragPreview(null);\r\n      }\r\n    }\r\n  };\r\n\r\n  const handleDrop = (e) => {\r\n    e.preventDefault();\r\n    if (!draggedTag || !chartData || chartData.length === 0) return;\r\n\r\n    const dateIndex = getDateIndexFromX(e.clientX);\r\n    const targetDate = chartData[dateIndex]?.date;\r\n\r\n    if (targetDate) {\r\n      const newTag = {\r\n        ...draggedTag,\r\n        id: `${draggedTag.id}-${Date.now()}`,\r\n        date: targetDate,\r\n        dateIndex: dateIndex\r\n      };\r\n\r\n      if (onTagsChange) {\r\n        onTagsChange([...(chartTags || []), newTag]);\r\n      }\r\n    }\r\n\r\n    setDraggedTag(null);\r\n    setDragPreview(null);\r\n  };\r\n\r\n  const handleDragEnd = () => {\r\n    setDragPreview(null);\r\n  };\r\n\r\n  const handleAddCustomTag = () => {\r\n    if (!customTagName.trim() || !customTagOwner.trim()) return;\r\n\r\n    const newTag = {\r\n      id: `custom-${Date.now()}`,\r\n      name: customTagName.trim(),\r\n      owner: customTagOwner.trim(),\r\n      description: customTagDescription.trim() || '',\r\n      color: '#6e6e73',\r\n      isCustom: true\r\n    };\r\n\r\n    setDraggedTag(newTag);\r\n    setCustomTagName('');\r\n    setCustomTagOwner('');\r\n    setCustomTagDescription('');\r\n    setShowCustomForm(false);\r\n  };\r\n\r\n  const handleTagClick = (tagId) => {\r\n    setExpandedTagId(expandedTagId === tagId ? null : tagId);\r\n  };\r\n\r\n  const handleRemoveTag = (tagId) => {\r\n    if (onTagsChange) {\r\n      onTagsChange((chartTags || []).filter(t => t.id !== tagId));\r\n    }\r\n  };\r\n\r\n  // Persist dismissedEvents to sessionStorage whenever they change\r\n  useEffect(() => {\r\n    try {\r\n      sessionStorage.setItem('dismissedEvents', JSON.stringify(dismissedEvents));\r\n    } catch { /* ignore */ }\r\n  }, [dismissedEvents]);\r\n\r\n  // Dismiss a suggested event (session-scoped)\r\n  const handleDismissEvent = (eventId) => {\r\n    setDismissedEvents(prev => [...prev, eventId]);\r\n  };\r\n\r\n  // Reset all dismissed events\r\n  const handleResetDismissed = () => {\r\n    setDismissedEvents([]);\r\n  };\r\n\r\n  // Get list of pinned event IDs from chartTags\r\n  const pinnedEventIds = (chartTags || [])\r\n    .filter(tag => tag.sourceEventId)\r\n    .map(tag => tag.sourceEventId);\r\n\r\n  // Year-aware event filtering: returns events adjusted to the visible chart date range\r\n  // Excludes dismissed and pinned events\r\n  const getFilteredEvents = useCallback(() => {\r\n    if (!events || events.length === 0 || !chartData || chartData.length === 0) return [];\r\n\r\n    const chartStartDate = chartData[0]?.date;\r\n    const chartEndDate = chartData[chartData.length - 1]?.date;\r\n    if (!chartStartDate || !chartEndDate) return [];\r\n\r\n    const chartStart = new Date(chartStartDate + 'T00:00:00');\r\n    const chartEnd = new Date(chartEndDate + 'T00:00:00');\r\n\r\n    // Determine year label suffix based on displayMode\r\n    const yearLabel = displayMode === 'ly' ? 'LY' : 'TY';\r\n\r\n    return events\r\n      .filter(ev => !dismissedEvents.includes(ev.id))\r\n      .filter(ev => !pinnedEventIds.includes(ev.id)) // Exclude pinned events\r\n      .map(ev => {\r\n        let evStart = new Date(ev.startDate + 'T00:00:00');\r\n        let evEnd = new Date(ev.endDate + 'T00:00:00');\r\n\r\n        // When showing LY only, shift event dates back 365 days\r\n        if (displayMode === 'ly') {\r\n          evStart = new Date(evStart.getTime() - 365 * 24 * 60 * 60 * 1000);\r\n          evEnd = new Date(evEnd.getTime() - 365 * 24 * 60 * 60 * 1000);\r\n        }\r\n\r\n        return { ...ev, adjustedStart: evStart, adjustedEnd: evEnd, yearLabel };\r\n      })\r\n      .filter(ev => {\r\n        // Keep only events that overlap with the visible chart range\r\n        return ev.adjustedStart <= chartEnd && ev.adjustedEnd >= chartStart;\r\n      });\r\n  }, [events, chartData, displayMode, dismissedEvents, pinnedEventIds]);\r\n\r\n  // Convert a date to the nearest data index in chartData\r\n  const getIndexForDate = useCallback((targetDate) => {\r\n    if (!chartData || chartData.length === 0) return -1;\r\n    let bestIdx = 0;\r\n    let bestDiff = Infinity;\r\n    for (let i = 0; i < chartData.length; i++) {\r\n      const d = new Date(chartData[i].date + 'T00:00:00');\r\n      const diff = Math.abs(d.getTime() - targetDate.getTime());\r\n      if (diff < bestDiff) {\r\n        bestDiff = diff;\r\n        bestIdx = i;\r\n      }\r\n    }\r\n    return bestIdx;\r\n  }, [chartData]);\r\n\r\n  // Helper to render a single event span (used for both suggestions and pinned)\r\n  const renderSingleSpan = (ev, isPinned = false) => {\r\n    const currentWidth = containerWidth || (chartContainerRef.current?.offsetWidth || 0);\r\n    if (currentWidth === 0) return null;\r\n\r\n    const chartAreaLeft = Y_AXIS_WIDTH + CHART_MARGINS.left;\r\n    const chartAreaWidth = currentWidth - chartAreaLeft - CHART_MARGINS.right;\r\n\r\n    // For pinned spans, adjustedStart/End are stored as ISO strings\r\n    const evStart = isPinned ? new Date(ev.adjustedStart) : ev.adjustedStart;\r\n    const evEnd = isPinned ? new Date(ev.adjustedEnd) : ev.adjustedEnd;\r\n\r\n    const startIdx = getIndexForDate(evStart);\r\n    const endIdx = getIndexForDate(evEnd);\r\n\r\n    // Clamp indices to chart bounds\r\n    const clampedStart = Math.max(0, startIdx);\r\n    const clampedEnd = Math.min(chartData.length - 1, endIdx);\r\n\r\n    // Calculate pixel positions\r\n    const startPct = chartData.length === 1 ? 0.5 : clampedStart / (chartData.length - 1);\r\n    const endPct = chartData.length === 1 ? 0.5 : clampedEnd / (chartData.length - 1);\r\n\r\n    const leftPx = chartAreaLeft + startPct * chartAreaWidth;\r\n    const rightPx = chartAreaLeft + endPct * chartAreaWidth;\r\n    const widthPx = Math.max(rightPx - leftPx, 4); // minimum 4px width\r\n\r\n    const centerPx = leftPx + widthPx / 2;\r\n\r\n    // Solid fill with edge borders - cleaner than gradient\r\n    const fillColor = hexToRgba(ev.color, 0.12);\r\n    const borderColor = hexToRgba(ev.color, 0.5);\r\n\r\n    return (\r\n      <div\r\n        key={ev.id}\r\n        className={`event-span ${isPinned ? 'pinned' : ''}`}\r\n        style={{\r\n          left: `${leftPx}px`,\r\n          width: `${widthPx}px`,\r\n          background: fillColor,\r\n          borderLeft: `2px solid ${borderColor}`,\r\n          borderRight: `2px solid ${borderColor}`,\r\n        }}\r\n      >\r\n        {/* Pill label at center */}\r\n        <div\r\n          className=\"event-span-label\"\r\n          style={{ left: `${centerPx - leftPx}px`, background: ev.color }}\r\n          onClick={() => !isPinned && setEditingEvent(editingEvent?.id === ev.id ? null : ev)}\r\n        >\r\n          <span className=\"event-span-label-text\">\r\n            {ev.name || ev.label} ({ev.yearLabel})\r\n          </span>\r\n          {isPinned ? (\r\n            <button\r\n              className=\"event-span-dismiss\"\r\n              onClick={(e) => { e.stopPropagation(); handleRemoveTag(ev.id); }}\r\n              title=\"Remove\"\r\n            >\r\n              x\r\n            </button>\r\n          ) : (\r\n            <button\r\n              className=\"event-span-dismiss\"\r\n              onClick={(e) => { e.stopPropagation(); handleDismissEvent(ev.id); }}\r\n              title=\"Dismiss\"\r\n            >\r\n              x\r\n            </button>\r\n          )}\r\n        </div>\r\n\r\n        {/* Edit popover - only for suggestions, not pinned */}\r\n        {!isPinned && editingEvent?.id === ev.id && (\r\n          <div className=\"event-span-edit\" style={{ left: `${centerPx - leftPx}px` }}>\r\n            <div className=\"event-span-edit-header\">\r\n              <strong>{ev.label}</strong>\r\n              <button className=\"event-span-edit-close\" onClick={() => setEditingEvent(null)}>x</button>\r\n            </div>\r\n            <p className=\"event-span-edit-dates\">\r\n              {new Date(ev.adjustedStart).toLocaleDateString('en-US', { month: 'short', day: 'numeric' })}\r\n              {' - '}\r\n              {new Date(ev.adjustedEnd).toLocaleDateString('en-US', { month: 'short', day: 'numeric' })}\r\n            </p>\r\n            <p className=\"event-span-edit-tier\">\r\n              {ev.tier ? 'Tier 1 Event' : 'Tracked Event'}\r\n            </p>\r\n            <button\r\n              className=\"event-span-pin-btn\"\r\n              onClick={() => {\r\n                // Pin as a permanent span (not point marker) with full event data\r\n                if (onTagsChange) {\r\n                  onTagsChange([...(chartTags || []), {\r\n                    id: `pinned-${ev.id}-${Date.now()}`,\r\n                    name: ev.label,\r\n                    color: ev.color,\r\n                    // Store the original event ID to track which event was pinned\r\n                    sourceEventId: ev.id,\r\n                    // Store span data for rendering as a span\r\n                    isSpan: true,\r\n                    startDate: ev.startDate,\r\n                    endDate: ev.endDate,\r\n                    adjustedStart: ev.adjustedStart.toISOString(),\r\n                    adjustedEnd: ev.adjustedEnd.toISOString(),\r\n                    yearLabel: ev.yearLabel,\r\n                    tier: ev.tier,\r\n                    source: 'suggested'\r\n                  }]);\r\n                }\r\n                setEditingEvent(null);\r\n              }}\r\n            >\r\n              Pin to chart\r\n            </button>\r\n          </div>\r\n        )}\r\n      </div>\r\n    );\r\n  };\r\n\r\n  // Get pinned span tags that overlap with current chart range\r\n  const getPinnedSpans = useCallback(() => {\r\n    if (!chartTags || !chartData || chartData.length === 0) return [];\r\n\r\n    const chartStartDate = chartData[0]?.date;\r\n    const chartEndDate = chartData[chartData.length - 1]?.date;\r\n    if (!chartStartDate || !chartEndDate) return [];\r\n\r\n    const chartStart = new Date(chartStartDate + 'T00:00:00');\r\n    const chartEnd = new Date(chartEndDate + 'T00:00:00');\r\n\r\n    return chartTags\r\n      .filter(tag => tag.isSpan)\r\n      .filter(tag => {\r\n        const tagStart = new Date(tag.adjustedStart);\r\n        const tagEnd = new Date(tag.adjustedEnd);\r\n        return tagStart <= chartEnd && tagEnd >= chartStart;\r\n      });\r\n  }, [chartTags, chartData]);\r\n\r\n  // Render gradient event spans behind the chart (both suggestions and pinned)\r\n  const renderEventSpans = () => {\r\n    const currentWidth = containerWidth || (chartContainerRef.current?.offsetWidth || 0);\r\n    if (currentWidth === 0) return null;\r\n\r\n    // Get pinned spans (always show)\r\n    const pinnedSpans = getPinnedSpans();\r\n\r\n    // Get suggested events (only when toggle is on)\r\n    const suggestedEvents = showSuggestedEvents ? getFilteredEvents() : [];\r\n\r\n    // If nothing to render, return null\r\n    if (pinnedSpans.length === 0 && suggestedEvents.length === 0) return null;\r\n\r\n    return (\r\n      <>\r\n        {/* Render pinned spans first (always visible) */}\r\n        {pinnedSpans.map(span => renderSingleSpan(span, true))}\r\n        {/* Render suggested events (when toggle is on) */}\r\n        {suggestedEvents.map(ev => renderSingleSpan(ev, false))}\r\n      </>\r\n    );\r\n  };\r\n\r\n  const commonProps = {\r\n    data: chartData,\r\n    margin: CHART_MARGINS\r\n  };\r\n\r\n  const axisStyle = {\r\n    fontSize: 11,\r\n    fill: '#86868b',\r\n    fontWeight: 500\r\n  };\r\n\r\n  // Calculate tick interval for evenly spaced X-axis labels\r\n  // Target ~6-8 ticks for readability, ensuring even spacing\r\n  const calculateTickInterval = () => {\r\n    if (!chartData || chartData.length <= 1) return 0;\r\n    const dataPoints = chartData.length;\r\n    const targetTicks = 7; // Aim for 7 evenly spaced ticks\r\n    const interval = Math.max(0, Math.floor((dataPoints - 1) / (targetTicks - 1)) - 1);\r\n    return interval;\r\n  };\r\n\r\n  const tickInterval = calculateTickInterval();\r\n\r\n  // Get the correct data keys based on comparison mode\r\n  const tyDataKey = hasComparison ? `${kpi}_ty` : kpi;\r\n  const lyDataKey = hasComparison ? `${kpi}_ly` : null;\r\n\r\n  // Determine which lines to show based on displayMode\r\n  const showTY = displayMode === 'both' || displayMode === 'ty';\r\n  const showLY = displayMode === 'both' || displayMode === 'ly';\r\n\r\n  // Render placed tags as overlay elements (point tags only, not span tags)\r\n  const renderPlacedTags = () => {\r\n    if (!chartTags || chartTags.length === 0 || !chartData || chartData.length === 0) return null;\r\n\r\n    // Filter out span tags - they're rendered in renderEventSpans\r\n    const pointTags = chartTags.filter(t => !t.isSpan);\r\n    if (pointTags.length === 0) return null;\r\n\r\n    // Get current width - fallback to ref if state is 0\r\n    const currentWidth = containerWidth || (chartContainerRef.current?.offsetWidth || 0);\r\n    if (currentWidth === 0) return null;\r\n\r\n    // Pole extends from tag area into chart\r\n    const poleHeight = CHART_HEIGHT - CHART_MARGINS.bottom - 40;\r\n\r\n    return pointTags.map((tag) => {\r\n      // Find the date index - use stored index first, then lookup by date\r\n      let dateIndex = tag.dateIndex;\r\n      if (dateIndex === undefined || dateIndex < 0 || dateIndex >= chartData.length) {\r\n        dateIndex = chartData.findIndex(d => d.date === tag.date);\r\n      }\r\n\r\n      if (dateIndex === -1 || dateIndex >= chartData.length) return null;\r\n\r\n      const xPos = getXPositionForIndex(dateIndex);\r\n      if (xPos === 0 && dateIndex !== 0) return null; // Position calculation failed\r\n\r\n      const isExpanded = expandedTagId === tag.id;\r\n      const hasDetails = tag.owner || tag.description;\r\n\r\n      return (\r\n        <div\r\n          key={tag.id}\r\n          className={`placed-tag-container ${isExpanded ? 'expanded' : ''}`}\r\n          style={{ left: `${xPos}px` }}\r\n        >\r\n          {/* Tag label - compact pill design, clickable if has details */}\r\n          <div\r\n            className={`tag-label ${hasDetails ? 'clickable' : ''}`}\r\n            style={{ background: tag.color }}\r\n            onClick={hasDetails ? () => handleTagClick(tag.id) : undefined}\r\n          >\r\n            <span className=\"tag-label-text\">{tag.name}</span>\r\n            {hasDetails && (\r\n              <span className=\"tag-expand-icon\">\r\n                {isExpanded ? 'âˆ’' : '+'}\r\n              </span>\r\n            )}\r\n            <button\r\n              className=\"tag-label-remove\"\r\n              onClick={(e) => {\r\n                e.stopPropagation();\r\n                handleRemoveTag(tag.id);\r\n              }}\r\n              title=\"Remove tag\"\r\n            >\r\n              Ã—\r\n            </button>\r\n          </div>\r\n\r\n          {/* Expanded details panel */}\r\n          {isExpanded && hasDetails && (\r\n            <div className=\"tag-details\" style={{ borderColor: tag.color }}>\r\n              {tag.description && (\r\n                <p className=\"tag-description\">{tag.description}</p>\r\n              )}\r\n              {tag.owner && (\r\n                <p className=\"tag-owner-info\">\r\n                  <span className=\"tag-owner-label\">Owner:</span> {tag.owner}\r\n                </p>\r\n              )}\r\n            </div>\r\n          )}\r\n\r\n          {/* Vertical pole extending down */}\r\n          <div\r\n            className=\"tag-pole\"\r\n            style={{\r\n              background: tag.color,\r\n              height: poleHeight\r\n            }}\r\n          ></div>\r\n          {/* Date at bottom */}\r\n          <div className=\"tag-date\" style={{ color: tag.color }}>\r\n            {formatAxisDate(tag.date)}\r\n          </div>\r\n        </div>\r\n      );\r\n    });\r\n  };\r\n\r\n  // Render drag preview\r\n  const renderDragPreview = () => {\r\n    if (!dragPreview || dragPreview.x === 0) return null;\r\n\r\n    const poleHeight = CHART_HEIGHT - CHART_MARGINS.bottom - 40;\r\n\r\n    return (\r\n      <div\r\n        className=\"drag-preview-container\"\r\n        style={{ left: `${dragPreview.x}px` }}\r\n      >\r\n        {/* Preview tag label */}\r\n        <div className=\"tag-label preview\" style={{ background: dragPreview.tag.color }}>\r\n          <span className=\"tag-label-text\">{dragPreview.tag.name}</span>\r\n        </div>\r\n        {/* Preview pole - dashed */}\r\n        <div\r\n          className=\"tag-pole preview\"\r\n          style={{\r\n            borderColor: dragPreview.tag.color,\r\n            height: poleHeight\r\n          }}\r\n        ></div>\r\n        {/* Date display */}\r\n        <div className=\"tag-date preview\" style={{ color: dragPreview.tag.color }}>\r\n          {dragPreview.formattedDate}\r\n        </div>\r\n      </div>\r\n    );\r\n  };\r\n\r\n  const renderChart = () => {\r\n    switch (chartType) {\r\n      case 'area':\r\n        return (\r\n          <AreaChart {...commonProps}>\r\n            <defs>\r\n              <linearGradient id=\"areaGradientTY\" x1=\"0\" y1=\"0\" x2=\"0\" y2=\"1\">\r\n                <stop offset=\"0%\" stopColor=\"#F96302\" stopOpacity={0.25}/>\r\n                <stop offset=\"100%\" stopColor=\"#F96302\" stopOpacity={0}/>\r\n              </linearGradient>\r\n              <linearGradient id=\"areaGradientLY\" x1=\"0\" y1=\"0\" x2=\"0\" y2=\"1\">\r\n                <stop offset=\"0%\" stopColor=\"#86868b\" stopOpacity={0.15}/>\r\n                <stop offset=\"100%\" stopColor=\"#86868b\" stopOpacity={0}/>\r\n              </linearGradient>\r\n            </defs>\r\n            <CartesianGrid strokeDasharray=\"3 3\" stroke=\"rgba(0,0,0,0.04)\" vertical={false} />\r\n            <XAxis\r\n              dataKey=\"displayDate\"\r\n              tick={axisStyle}\r\n              tickLine={false}\r\n              axisLine={{ stroke: 'rgba(0,0,0,0.08)' }}\r\n              tickFormatter={formatAxisDate}\r\n              interval={tickInterval}\r\n            />\r\n            <YAxis\r\n              tick={axisStyle}\r\n              tickLine={false}\r\n              axisLine={false}\r\n              tickFormatter={formatValue}\r\n              width={Y_AXIS_WIDTH}\r\n            />\r\n            <Tooltip content={<CustomTooltip />} />\r\n            {hasComparison && <Legend />}\r\n            {launchDate && showTY && (\r\n              <ReferenceLine\r\n                x={launchDate}\r\n                stroke=\"#F96302\"\r\n                strokeDasharray=\"4 4\"\r\n                strokeWidth={2}\r\n                label={{\r\n                  value: 'Launch',\r\n                  position: 'top',\r\n                  fill: '#F96302',\r\n                  fontSize: 11,\r\n                  fontWeight: 600\r\n                }}\r\n              />\r\n            )}\r\n            {hasComparison && lyDataKey && showLY && (\r\n              <Area\r\n                type=\"monotone\"\r\n                dataKey={lyDataKey}\r\n                name=\"Last Year\"\r\n                stroke=\"#86868b\"\r\n                strokeWidth={1.5}\r\n                strokeDasharray=\"4 4\"\r\n                fill=\"url(#areaGradientLY)\"\r\n                dot={false}\r\n                activeDot={{ r: 4, fill: '#86868b', stroke: '#fff', strokeWidth: 2 }}\r\n              />\r\n            )}\r\n            {showTY && (\r\n              <Area\r\n                type=\"monotone\"\r\n                dataKey={tyDataKey}\r\n                name={hasComparison ? \"This Year\" : kpi}\r\n                stroke=\"#F96302\"\r\n                strokeWidth={2}\r\n                fill=\"url(#areaGradientTY)\"\r\n                dot={false}\r\n                activeDot={{ r: 5, fill: '#F96302', stroke: '#fff', strokeWidth: 2 }}\r\n              />\r\n            )}\r\n          </AreaChart>\r\n        );\r\n\r\n      case 'bar':\r\n        return (\r\n          <BarChart {...commonProps}>\r\n            <CartesianGrid strokeDasharray=\"3 3\" stroke=\"rgba(0,0,0,0.04)\" vertical={false} />\r\n            <XAxis\r\n              dataKey=\"displayDate\"\r\n              tick={axisStyle}\r\n              tickLine={false}\r\n              axisLine={{ stroke: 'rgba(0,0,0,0.08)' }}\r\n              tickFormatter={formatAxisDate}\r\n              interval={tickInterval}\r\n            />\r\n            <YAxis\r\n              tick={axisStyle}\r\n              tickLine={false}\r\n              axisLine={false}\r\n              tickFormatter={formatValue}\r\n              width={Y_AXIS_WIDTH}\r\n            />\r\n            <Tooltip content={<CustomTooltip />} />\r\n            {hasComparison && <Legend />}\r\n            {launchDate && showTY && (\r\n              <ReferenceLine\r\n                x={launchDate}\r\n                stroke=\"#F96302\"\r\n                strokeDasharray=\"4 4\"\r\n                strokeWidth={2}\r\n              />\r\n            )}\r\n            {hasComparison && lyDataKey && showLY && (\r\n              <Bar\r\n                dataKey={lyDataKey}\r\n                name=\"Last Year\"\r\n                fill=\"#d1d1d6\"\r\n                radius={[4, 4, 0, 0]}\r\n                maxBarSize={20}\r\n              />\r\n            )}\r\n            {showTY && (\r\n              <Bar\r\n                dataKey={tyDataKey}\r\n                name={hasComparison ? \"This Year\" : kpi}\r\n                fill=\"#F96302\"\r\n                radius={[4, 4, 0, 0]}\r\n                maxBarSize={hasComparison ? 20 : 40}\r\n              />\r\n            )}\r\n          </BarChart>\r\n        );\r\n\r\n      default:\r\n        return (\r\n          <LineChart {...commonProps}>\r\n            <CartesianGrid strokeDasharray=\"3 3\" stroke=\"rgba(0,0,0,0.04)\" vertical={false} />\r\n            <XAxis\r\n              dataKey=\"displayDate\"\r\n              tick={axisStyle}\r\n              tickLine={false}\r\n              axisLine={{ stroke: 'rgba(0,0,0,0.08)' }}\r\n              tickFormatter={formatAxisDate}\r\n              interval={tickInterval}\r\n            />\r\n            <YAxis\r\n              tick={axisStyle}\r\n              tickLine={false}\r\n              axisLine={false}\r\n              tickFormatter={formatValue}\r\n              width={Y_AXIS_WIDTH}\r\n            />\r\n            <Tooltip content={<CustomTooltip />} />\r\n            {hasComparison && <Legend />}\r\n            {launchDate && showTY && (\r\n              <ReferenceLine\r\n                x={launchDate}\r\n                stroke=\"#F96302\"\r\n                strokeDasharray=\"4 4\"\r\n                strokeWidth={2}\r\n                label={{\r\n                  value: 'Launch',\r\n                  position: 'top',\r\n                  fill: '#F96302',\r\n                  fontSize: 11,\r\n                  fontWeight: 600\r\n                }}\r\n              />\r\n            )}\r\n            {hasComparison && lyDataKey && showLY && (\r\n              <Line\r\n                type=\"monotone\"\r\n                dataKey={lyDataKey}\r\n                name=\"Last Year\"\r\n                stroke=\"#86868b\"\r\n                strokeWidth={1.5}\r\n                strokeDasharray=\"4 4\"\r\n                dot={false}\r\n                activeDot={{ r: 4, fill: '#86868b', stroke: '#fff', strokeWidth: 2 }}\r\n              />\r\n            )}\r\n            {showTY && (\r\n              <Line\r\n                type=\"monotone\"\r\n                dataKey={tyDataKey}\r\n                name={hasComparison ? \"This Year\" : kpi}\r\n                stroke=\"#F96302\"\r\n                strokeWidth={2}\r\n                dot={false}\r\n                activeDot={{ r: 5, fill: '#F96302', stroke: '#fff', strokeWidth: 2 }}\r\n              />\r\n            )}\r\n          </LineChart>\r\n        );\r\n    }\r\n  };\r\n\r\n  if (!chartData || chartData.length === 0) {\r\n    return (\r\n      <div className=\"chart-empty\">\r\n        <p>No data available for the selected period</p>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  if (isBeta) {\r\n    return (\r\n      <div className=\"kpi-chart beta-restricted\">\r\n        <div className=\"chart-blur-wrapper\">\r\n          <ResponsiveContainer width=\"100%\" height={320}>\r\n            {renderChart()}\r\n          </ResponsiveContainer>\r\n        </div>\r\n        <div className=\"beta-overlay\">\r\n          <div className=\"beta-overlay-content\">\r\n            <h3>Place holder</h3>\r\n            <p>Chart visualization</p>\r\n          </div>\r\n        </div>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  return (\r\n    <div className=\"kpi-chart-wrapper\">\r\n      <div\r\n        className={`kpi-chart ${draggedTag ? 'drop-active' : ''}`}\r\n        ref={chartContainerRef}\r\n        onDragOver={handleDragOver}\r\n        onDragLeave={handleDragLeave}\r\n        onDrop={handleDrop}\r\n      >\r\n        {/* Tag area - space above chart for tag labels */}\r\n        <div className=\"tag-area\">\r\n          {renderPlacedTags()}\r\n          {dragPreview && renderDragPreview()}\r\n        </div>\r\n\r\n        {/* Suggested event spans - rendered behind the chart */}\r\n        <div className=\"event-spans-layer\" style={{ height: `${PLOT_AREA_HEIGHT}px` }}>\r\n          {renderEventSpans()}\r\n        </div>\r\n\r\n        {/* Chart */}\r\n        <ResponsiveContainer width=\"100%\" height={320}>\r\n          {renderChart()}\r\n        </ResponsiveContainer>\r\n      </div>\r\n\r\n      {/* Tag Panel Toggle */}\r\n      <div className=\"chart-tag-controls\">\r\n        <button\r\n          className={`tag-panel-toggle ${showTagPanel ? 'active' : ''}`}\r\n          onClick={() => setShowTagPanel(!showTagPanel)}\r\n        >\r\n          <svg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" strokeWidth=\"2\" strokeLinecap=\"round\" strokeLinejoin=\"round\">\r\n            <path d=\"M20.59 13.41l-7.17 7.17a2 2 0 0 1-2.83 0L2 12V2h10l8.59 8.59a2 2 0 0 1 0 2.82z\"></path>\r\n            <line x1=\"7\" y1=\"7\" x2=\"7.01\" y2=\"7\"></line>\r\n          </svg>\r\n          <span>Add Info Tag</span>\r\n        </button>\r\n\r\n        {/* Suggested Events Toggle */}\r\n        <button\r\n          className={`suggested-events-toggle ${showSuggestedEvents ? 'active' : ''}`}\r\n          onClick={() => setShowSuggestedEvents(!showSuggestedEvents)}\r\n        >\r\n          <span className={`suggested-events-dot ${showSuggestedEvents ? 'on' : 'off'}`}></span>\r\n          <span>Suggested Events</span>\r\n        </button>\r\n\r\n        {/* Active Tags Display - only show point tags, not span tags */}\r\n        {chartTags && chartTags.filter(t => !t.isSpan).length > 0 && (\r\n          <div className=\"active-tags\">\r\n            {chartTags.filter(t => !t.isSpan).map(tag => (\r\n              <span\r\n                key={tag.id}\r\n                className=\"active-tag\"\r\n                style={{ borderColor: tag.color, color: tag.color }}\r\n              >\r\n                <span className=\"tag-marker\" style={{ background: tag.color }}></span>\r\n                {tag.name}\r\n                <span className=\"tag-date\">{formatAxisDate(tag.date)}</span>\r\n                <button onClick={() => handleRemoveTag(tag.id)} className=\"tag-remove\">\r\n                  <svg width=\"12\" height=\"12\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" strokeWidth=\"2\">\r\n                    <line x1=\"18\" y1=\"6\" x2=\"6\" y2=\"18\"></line>\r\n                    <line x1=\"6\" y1=\"6\" x2=\"18\" y2=\"18\"></line>\r\n                  </svg>\r\n                </button>\r\n              </span>\r\n            ))}\r\n          </div>\r\n        )}\r\n      </div>\r\n\r\n      {/* Tag Panel */}\r\n      {showTagPanel && (\r\n        <div className=\"tag-panel\">\r\n          <div className=\"tag-panel-header\">\r\n            <h4>Drag tags onto the chart</h4>\r\n            <button className=\"tag-panel-close\" onClick={() => setShowTagPanel(false)}>\r\n              <svg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" strokeWidth=\"2\">\r\n                <line x1=\"18\" y1=\"6\" x2=\"6\" y2=\"18\"></line>\r\n                <line x1=\"6\" y1=\"6\" x2=\"18\" y2=\"18\"></line>\r\n              </svg>\r\n            </button>\r\n          </div>\r\n\r\n          {dismissedEvents.length > 0 && (\r\n            <button className=\"reset-dismissed-btn\" onClick={handleResetDismissed}>\r\n              Reset {dismissedEvents.length} dismissed event{dismissedEvents.length !== 1 ? 's' : ''}\r\n            </button>\r\n          )}\r\n\r\n          <div className=\"preset-tags\">\r\n            {PRESET_TAGS\r\n              // Filter out preset tags that match pinned events by name\r\n              .filter(tag => {\r\n                const tagNameLower = tag.name.toLowerCase();\r\n                // Check if this tag name matches any pinned event\r\n                const isPinnedAlready = (chartTags || []).some(ct =>\r\n                  ct.isSpan && ct.name.toLowerCase() === tagNameLower\r\n                );\r\n                return !isPinnedAlready;\r\n              })\r\n              .map(tag => (\r\n              <div\r\n                key={tag.id}\r\n                className=\"draggable-tag\"\r\n                draggable\r\n                onDragStart={(e) => handleDragStart(e, tag)}\r\n                onDragEnd={handleDragEnd}\r\n                style={{ borderColor: tag.color }}\r\n              >\r\n                <span className=\"tag-marker\" style={{ background: tag.color }}></span>\r\n                {tag.name}\r\n              </div>\r\n            ))}\r\n          </div>\r\n\r\n          <div className=\"custom-tag-section\">\r\n            {!showCustomForm ? (\r\n              <button\r\n                className=\"add-custom-tag-btn\"\r\n                onClick={() => setShowCustomForm(true)}\r\n              >\r\n                <svg width=\"14\" height=\"14\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" strokeWidth=\"2\">\r\n                  <line x1=\"12\" y1=\"5\" x2=\"12\" y2=\"19\"></line>\r\n                  <line x1=\"5\" y1=\"12\" x2=\"19\" y2=\"12\"></line>\r\n                </svg>\r\n                Create Custom Tag\r\n              </button>\r\n            ) : (\r\n              <div className=\"custom-tag-form\">\r\n                <input\r\n                  type=\"text\"\r\n                  placeholder=\"Tag name\"\r\n                  value={customTagName}\r\n                  onChange={(e) => setCustomTagName(e.target.value)}\r\n                  className=\"custom-tag-input\"\r\n                />\r\n                <input\r\n                  type=\"text\"\r\n                  placeholder=\"Your name (owner)\"\r\n                  value={customTagOwner}\r\n                  onChange={(e) => setCustomTagOwner(e.target.value)}\r\n                  className=\"custom-tag-input\"\r\n                />\r\n                <textarea\r\n                  placeholder=\"Short description (optional)\"\r\n                  value={customTagDescription}\r\n                  onChange={(e) => setCustomTagDescription(e.target.value)}\r\n                  className=\"custom-tag-textarea\"\r\n                  rows={2}\r\n                />\r\n                <div className=\"custom-tag-actions\">\r\n                  <button\r\n                    className=\"custom-tag-cancel\"\r\n                    onClick={() => {\r\n                      setShowCustomForm(false);\r\n                      setCustomTagName('');\r\n                      setCustomTagOwner('');\r\n                      setCustomTagDescription('');\r\n                    }}\r\n                  >\r\n                    Cancel\r\n                  </button>\r\n                  <button\r\n                    className=\"custom-tag-create\"\r\n                    onClick={handleAddCustomTag}\r\n                    disabled={!customTagName.trim() || !customTagOwner.trim()}\r\n                  >\r\n                    Create & Drag\r\n                  </button>\r\n                </div>\r\n              </div>\r\n            )}\r\n          </div>\r\n\r\n          {draggedTag && draggedTag.isCustom && (\r\n            <div className=\"drag-instruction\">\r\n              <p>Now drag your custom tag \"{draggedTag.name}\" onto the chart</p>\r\n              <div\r\n                className=\"draggable-tag custom\"\r\n                draggable\r\n                onDragStart={(e) => handleDragStart(e, draggedTag)}\r\n                onDragEnd={handleDragEnd}\r\n              >\r\n                <span className=\"tag-marker\" style={{ background: draggedTag.color }}></span>\r\n                {draggedTag.name}\r\n                <span className=\"tag-owner\">by {draggedTag.owner}</span>\r\n              </div>\r\n            </div>\r\n          )}\r\n        </div>\r\n      )}\r\n    </div>\r\n  );\r\n}\r\n\r\nexport default KPIChart;\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}